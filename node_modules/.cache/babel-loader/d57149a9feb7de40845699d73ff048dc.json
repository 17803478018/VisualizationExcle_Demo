{"remainingRequest":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js!D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\代码\\del_demo\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\component\\sheet.js","dependencies":[{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\component\\sheet.js","mtime":1614915429342},{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1596536485880},{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1606828682259},{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js","mtime":1603719226989}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJEOi9cdTRFRTNcdTc4MDEvZGVsX2RlbW8vVmlzdWFsaXphdGlvbkV4Y2xlX0RlbW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJEOi9cdTRFRTNcdTc4MDEvZGVsX2RlbW8vVmlzdWFsaXphdGlvbkV4Y2xlX0RlbW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkQ6L1x1NEVFM1x1NzgwMS9kZWxfZGVtby9WaXN1YWxpemF0aW9uRXhjbGVfRGVtby9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgeyBoIH0gZnJvbSAnLi9lbGVtZW50JzsKaW1wb3J0IHsgYmluZCwgbW91c2VNb3ZlVXAsIGJpbmRUb3VjaCB9IGZyb20gJy4vZXZlbnQnOwppbXBvcnQgUmVzaXplciBmcm9tICcuL3Jlc2l6ZXInOwppbXBvcnQgU2Nyb2xsYmFyIGZyb20gJy4vc2Nyb2xsYmFyJzsKaW1wb3J0IFNlbGVjdG9yIGZyb20gJy4vc2VsZWN0b3InOwppbXBvcnQgRWRpdG9yIGZyb20gJy4vZWRpdG9yJzsKaW1wb3J0IFByaW50IGZyb20gJy4vcHJpbnQnOwppbXBvcnQgQ29udGV4dE1lbnUgZnJvbSAnLi9jb250ZXh0bWVudSc7CmltcG9ydCBUYWJsZSBmcm9tICcuL3RhYmxlJzsKaW1wb3J0IFRvb2xiYXIgZnJvbSAnLi90b29sYmFyL2luZGV4JzsKaW1wb3J0IE1vZGFsVmFsaWRhdGlvbiBmcm9tICcuL21vZGFsX3ZhbGlkYXRpb24nOwppbXBvcnQgU29ydEZpbHRlciBmcm9tICcuL3NvcnRfZmlsdGVyJzsKaW1wb3J0IHsgeHRvYXN0IH0gZnJvbSAnLi9tZXNzYWdlJzsKaW1wb3J0IHsgY3NzUHJlZml4IH0gZnJvbSAnLi4vY29uZmlnJzsKaW1wb3J0IHsgZm9ybXVsYXMgfSBmcm9tICcuLi9jb3JlL2Zvcm11bGEnOwovKioNCiAqIEBkZXNjIHRocm90dGxlIGZuDQogKiBAcGFyYW0gZnVuYyBmdW5jdGlvbg0KICogQHBhcmFtIHdhaXQgRGVsYXkgaW4gbWlsbGlzZWNvbmRzDQogKi8KCmZ1bmN0aW9uIHRocm90dGxlKGZ1bmMsIHdhaXQpIHsKICB2YXIgX3RoaXMgPSB0aGlzOwoKICB2YXIgdGltZW91dDsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHRoYXQgPSBfdGhpczsKCiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJnID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBhcmdbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgdmFyIGFyZ3MgPSBhcmc7CgogICAgaWYgKCF0aW1lb3V0KSB7CiAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBmdW5jLmFwcGx5KHRoYXQsIGFyZ3MpOwogICAgICB9LCB3YWl0KTsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBzY3JvbGxiYXJNb3ZlKCkgewogIHZhciBkYXRhID0gdGhpcy5kYXRhLAogICAgICB2ZXJ0aWNhbFNjcm9sbGJhciA9IHRoaXMudmVydGljYWxTY3JvbGxiYXIsCiAgICAgIGhvcml6b250YWxTY3JvbGxiYXIgPSB0aGlzLmhvcml6b250YWxTY3JvbGxiYXI7CgogIHZhciBfZGF0YSRnZXRTZWxlY3RlZFJlY3QgPSBkYXRhLmdldFNlbGVjdGVkUmVjdCgpLAogICAgICBsID0gX2RhdGEkZ2V0U2VsZWN0ZWRSZWN0LmwsCiAgICAgIHQgPSBfZGF0YSRnZXRTZWxlY3RlZFJlY3QudCwKICAgICAgbGVmdCA9IF9kYXRhJGdldFNlbGVjdGVkUmVjdC5sZWZ0LAogICAgICB0b3AgPSBfZGF0YSRnZXRTZWxlY3RlZFJlY3QudG9wLAogICAgICB3aWR0aCA9IF9kYXRhJGdldFNlbGVjdGVkUmVjdC53aWR0aCwKICAgICAgaGVpZ2h0ID0gX2RhdGEkZ2V0U2VsZWN0ZWRSZWN0LmhlaWdodDsKCiAgdmFyIHRhYmxlT2Zmc2V0ID0gdGhpcy5nZXRUYWJsZU9mZnNldCgpOyAvLyBjb25zb2xlLmxvZygnLGw6JywgbCwgJywgbGVmdDonLCBsZWZ0LCAnLCB0T2Zmc2V0LmxlZnQ6JywgdGFibGVPZmZzZXQud2lkdGgpOwoKICBpZiAoTWF0aC5hYnMobGVmdCkgKyB3aWR0aCA+IHRhYmxlT2Zmc2V0LndpZHRoKSB7CiAgICBob3Jpem9udGFsU2Nyb2xsYmFyLm1vdmUoewogICAgICBsZWZ0OiBsICsgd2lkdGggLSB0YWJsZU9mZnNldC53aWR0aAogICAgfSk7CiAgfSBlbHNlIHsKICAgIHZhciBmc3cgPSBkYXRhLmZyZWV6ZVRvdGFsV2lkdGgoKTsKCiAgICBpZiAobGVmdCA8IGZzdykgewogICAgICBob3Jpem9udGFsU2Nyb2xsYmFyLm1vdmUoewogICAgICAgIGxlZnQ6IGwgLSAxIC0gZnN3CiAgICAgIH0pOwogICAgfQogIH0gLy8gY29uc29sZS5sb2coJ3RvcDonLCB0b3AsICcsIGhlaWdodDonLCBoZWlnaHQsICcsIHRvZi5oZWlnaHQ6JywgdGFibGVPZmZzZXQuaGVpZ2h0KTsKCgogIGlmIChNYXRoLmFicyh0b3ApICsgaGVpZ2h0ID4gdGFibGVPZmZzZXQuaGVpZ2h0KSB7CiAgICB2ZXJ0aWNhbFNjcm9sbGJhci5tb3ZlKHsKICAgICAgdG9wOiB0ICsgaGVpZ2h0IC0gdGFibGVPZmZzZXQuaGVpZ2h0IC0gMQogICAgfSk7CiAgfSBlbHNlIHsKICAgIHZhciBmc2ggPSBkYXRhLmZyZWV6ZVRvdGFsSGVpZ2h0KCk7CgogICAgaWYgKHRvcCA8IGZzaCkgewogICAgICB2ZXJ0aWNhbFNjcm9sbGJhci5tb3ZlKHsKICAgICAgICB0b3A6IHQgLSAxIC0gZnNoCiAgICAgIH0pOwogICAgfQogIH0KfQoKZnVuY3Rpb24gc2VsZWN0b3JTZXQobXVsdGlwbGUsIHJpLCBjaSkgewogIHZhciBpbmRleGVzVXBkYXRlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogdHJ1ZTsKICB2YXIgbW92aW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiBmYWxzZTsKICBpZiAocmkgPT09IC0xICYmIGNpID09PSAtMSkgcmV0dXJuOwogIHZhciB0YWJsZSA9IHRoaXMudGFibGUsCiAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciwKICAgICAgdG9vbGJhciA9IHRoaXMudG9vbGJhciwKICAgICAgZGF0YSA9IHRoaXMuZGF0YSwKICAgICAgY29udGV4dE1lbnUgPSB0aGlzLmNvbnRleHRNZW51OwogIGNvbnRleHRNZW51LnNldE1vZGUocmkgPT09IC0xIHx8IGNpID09PSAtMSA/ICdyb3ctY29sJyA6ICdyYW5nZScpOwogIHZhciBjZWxsID0gZGF0YS5nZXRDZWxsKHJpLCBjaSk7CgogIGlmIChtdWx0aXBsZSkgewogICAgc2VsZWN0b3Iuc2V0RW5kKHJpLCBjaSwgbW92aW5nKTsKICAgIHRoaXMudHJpZ2dlcignY2VsbHMtc2VsZWN0ZWQnLCBjZWxsLCBzZWxlY3Rvci5yYW5nZSk7CiAgfSBlbHNlIHsKICAgIC8vIHRyaWdnZXIgY2xpY2sgZXZlbnQKICAgIHNlbGVjdG9yLnNldChyaSwgY2ksIGluZGV4ZXNVcGRhdGVkKTsKICAgIHRoaXMudHJpZ2dlcignY2VsbC1zZWxlY3RlZCcsIGNlbGwsIHJpLCBjaSk7CiAgfQoKICB0b29sYmFyLnJlc2V0KCk7CiAgdGFibGUucmVuZGVyKCk7Cn0gLy8gbXVsdGlwbGU6IGJvb2xlYW4KLy8gZGlyZWN0aW9uOiBsZWZ0IHwgcmlnaHQgfCB1cCB8IGRvd24gfCByb3ctZmlyc3QgfCByb3ctbGFzdCB8IGNvbC1maXJzdCB8IGNvbC1sYXN0CgoKZnVuY3Rpb24gc2VsZWN0b3JNb3ZlKG11bHRpcGxlLCBkaXJlY3Rpb24pIHsKICB2YXIgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yLAogICAgICBkYXRhID0gdGhpcy5kYXRhOwogIHZhciByb3dzID0gZGF0YS5yb3dzLAogICAgICBjb2xzID0gZGF0YS5jb2xzOwoKICB2YXIgX3NlbGVjdG9yJGluZGV4ZXMgPSBfc2xpY2VkVG9BcnJheShzZWxlY3Rvci5pbmRleGVzLCAyKSwKICAgICAgcmkgPSBfc2VsZWN0b3IkaW5kZXhlc1swXSwKICAgICAgY2kgPSBfc2VsZWN0b3IkaW5kZXhlc1sxXTsKCiAgdmFyIF9zZWxlY3RvciRyYW5nZSA9IHNlbGVjdG9yLnJhbmdlLAogICAgICBlcmkgPSBfc2VsZWN0b3IkcmFuZ2UuZXJpLAogICAgICBlY2kgPSBfc2VsZWN0b3IkcmFuZ2UuZWNpOwoKICBpZiAobXVsdGlwbGUpIHsKICAgIHZhciBfc2VsZWN0b3IkbW92ZUluZGV4ZXMgPSBfc2xpY2VkVG9BcnJheShzZWxlY3Rvci5tb3ZlSW5kZXhlcywgMik7CgogICAgcmkgPSBfc2VsZWN0b3IkbW92ZUluZGV4ZXNbMF07CiAgICBjaSA9IF9zZWxlY3RvciRtb3ZlSW5kZXhlc1sxXTsKICB9IC8vIGNvbnNvbGUubG9nKCdzZWxlY3Rvci5tb3ZlOicsIHJpLCBjaSk7CgoKICBpZiAoZGlyZWN0aW9uID09PSAnbGVmdCcpIHsKICAgIGlmIChjaSA+IDApIGNpIC09IDE7CiAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcpIHsKICAgIGlmIChlY2kgIT09IGNpKSBjaSA9IGVjaTsKICAgIGlmIChjaSA8IGNvbHMubGVuIC0gMSkgY2kgKz0gMTsKICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ3VwJykgewogICAgaWYgKHJpID4gMCkgcmkgLT0gMTsKICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7CiAgICBpZiAoZXJpICE9PSByaSkgcmkgPSBlcmk7CiAgICBpZiAocmkgPCByb3dzLmxlbiAtIDEpIHJpICs9IDE7CiAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyb3ctZmlyc3QnKSB7CiAgICBjaSA9IDA7CiAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyb3ctbGFzdCcpIHsKICAgIGNpID0gY29scy5sZW4gLSAxOwogIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnY29sLWZpcnN0JykgewogICAgcmkgPSAwOwogIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnY29sLWxhc3QnKSB7CiAgICByaSA9IHJvd3MubGVuIC0gMTsKICB9CgogIGlmIChtdWx0aXBsZSkgewogICAgc2VsZWN0b3IubW92ZUluZGV4ZXMgPSBbcmksIGNpXTsKICB9CgogIHNlbGVjdG9yU2V0LmNhbGwodGhpcywgbXVsdGlwbGUsIHJpLCBjaSk7CiAgc2Nyb2xsYmFyTW92ZS5jYWxsKHRoaXMpOwp9IC8vIHByaXZhdGUgbWV0aG9kcwoKCmZ1bmN0aW9uIG92ZXJsYXllck1vdXNlbW92ZShldnQpIHsKICAvLyBjb25zb2xlLmxvZygneDonLCBldnQub2Zmc2V0WCwgJywgeTonLCBldnQub2Zmc2V0WSk7CiAgaWYgKGV2dC5idXR0b25zICE9PSAwKSByZXR1cm47CiAgaWYgKGV2dC50YXJnZXQuY2xhc3NOYW1lID09PSAiIi5jb25jYXQoY3NzUHJlZml4LCAiLXJlc2l6ZXItaG92ZXIiKSkgcmV0dXJuOwogIHZhciBvZmZzZXRYID0gZXZ0Lm9mZnNldFgsCiAgICAgIG9mZnNldFkgPSBldnQub2Zmc2V0WTsKICB2YXIgcm93UmVzaXplciA9IHRoaXMucm93UmVzaXplciwKICAgICAgY29sUmVzaXplciA9IHRoaXMuY29sUmVzaXplciwKICAgICAgdGFibGVFbCA9IHRoaXMudGFibGVFbCwKICAgICAgZGF0YSA9IHRoaXMuZGF0YTsKICB2YXIgcm93cyA9IGRhdGEucm93cywKICAgICAgY29scyA9IGRhdGEuY29sczsKCiAgaWYgKG9mZnNldFggPiBjb2xzLmluZGV4V2lkdGggJiYgb2Zmc2V0WSA+IHJvd3MuaGVpZ2h0KSB7CiAgICByb3dSZXNpemVyLmhpZGUoKTsKICAgIGNvbFJlc2l6ZXIuaGlkZSgpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIHRSZWN0ID0gdGFibGVFbC5ib3goKTsKICB2YXIgY1JlY3QgPSBkYXRhLmdldENlbGxSZWN0QnlYWShldnQub2Zmc2V0WCwgZXZ0Lm9mZnNldFkpOwoKICBpZiAoY1JlY3QucmkgPj0gMCAmJiBjUmVjdC5jaSA9PT0gLTEpIHsKICAgIGNSZWN0LndpZHRoID0gY29scy5pbmRleFdpZHRoOwogICAgcm93UmVzaXplci5zaG93KGNSZWN0LCB7CiAgICAgIHdpZHRoOiB0UmVjdC53aWR0aAogICAgfSk7CgogICAgaWYgKHJvd3MuaXNIaWRlKGNSZWN0LnJpIC0gMSkpIHsKICAgICAgcm93UmVzaXplci5zaG93VW5oaWRlKGNSZWN0LnJpKTsKICAgIH0gZWxzZSB7CiAgICAgIHJvd1Jlc2l6ZXIuaGlkZVVuaGlkZSgpOwogICAgfQogIH0gZWxzZSB7CiAgICByb3dSZXNpemVyLmhpZGUoKTsKICB9CgogIGlmIChjUmVjdC5yaSA9PT0gLTEgJiYgY1JlY3QuY2kgPj0gMCkgewogICAgY1JlY3QuaGVpZ2h0ID0gcm93cy5oZWlnaHQ7CiAgICBjb2xSZXNpemVyLnNob3coY1JlY3QsIHsKICAgICAgaGVpZ2h0OiB0UmVjdC5oZWlnaHQKICAgIH0pOwoKICAgIGlmIChjb2xzLmlzSGlkZShjUmVjdC5jaSAtIDEpKSB7CiAgICAgIGNvbFJlc2l6ZXIuc2hvd1VuaGlkZShjUmVjdC5jaSk7CiAgICB9IGVsc2UgewogICAgICBjb2xSZXNpemVyLmhpZGVVbmhpZGUoKTsKICAgIH0KICB9IGVsc2UgewogICAgY29sUmVzaXplci5oaWRlKCk7CiAgfQp9IC8vIGxldCBzY3JvbGxUaHJlc2hvbGQgPSAxNTsKCgpmdW5jdGlvbiBvdmVybGF5ZXJNb3VzZXNjcm9sbChldnQpIHsKICAvLyBzY3JvbGxUaHJlc2hvbGQgLT0gMTsKICAvLyBpZiAoc2Nyb2xsVGhyZXNob2xkID4gMCkgcmV0dXJuOwogIC8vIHNjcm9sbFRocmVzaG9sZCA9IDE1OwogIHZhciB2ZXJ0aWNhbFNjcm9sbGJhciA9IHRoaXMudmVydGljYWxTY3JvbGxiYXIsCiAgICAgIGhvcml6b250YWxTY3JvbGxiYXIgPSB0aGlzLmhvcml6b250YWxTY3JvbGxiYXIsCiAgICAgIGRhdGEgPSB0aGlzLmRhdGE7CgogIHZhciBfdmVydGljYWxTY3JvbGxiYXIkc2MgPSB2ZXJ0aWNhbFNjcm9sbGJhci5zY3JvbGwoKSwKICAgICAgdG9wID0gX3ZlcnRpY2FsU2Nyb2xsYmFyJHNjLnRvcDsKCiAgdmFyIF9ob3Jpem9udGFsU2Nyb2xsYmFyJCA9IGhvcml6b250YWxTY3JvbGxiYXIuc2Nyb2xsKCksCiAgICAgIGxlZnQgPSBfaG9yaXpvbnRhbFNjcm9sbGJhciQubGVmdDsgLy8gY29uc29sZS5sb2coJ2V2dDo6OicsIGV2dC53aGVlbERlbHRhLCBldnQuZGV0YWlsICogNDApOwoKCiAgdmFyIHJvd3MgPSBkYXRhLnJvd3MsCiAgICAgIGNvbHMgPSBkYXRhLmNvbHM7IC8vIGRlbHRhWSBmb3IgdmVydGljYWwgZGVsdGEKCiAgdmFyIGRlbHRhWSA9IGV2dC5kZWx0YVksCiAgICAgIGRlbHRhWCA9IGV2dC5kZWx0YVg7CgogIHZhciBsb29wVmFsdWUgPSBmdW5jdGlvbiBsb29wVmFsdWUoaWksIHZGdW5jKSB7CiAgICB2YXIgaSA9IGlpOwogICAgdmFyIHYgPSAwOwoKICAgIGRvIHsKICAgICAgdiA9IHZGdW5jKGkpOwogICAgICBpICs9IDE7CiAgICB9IHdoaWxlICh2IDw9IDApOwoKICAgIHJldHVybiB2OwogIH07IC8vIGNvbnNvbGUubG9nKCdkZWx0YVgnLCBkZWx0YVgsICdldnQuZGV0YWlsJywgZXZ0LmRldGFpbCk7CiAgLy8gaWYgKGV2dC5kZXRhaWwpIGRlbHRhWSA9IGV2dC5kZXRhaWwgKiA0MDsKCgogIHZhciBtb3ZlWSA9IGZ1bmN0aW9uIG1vdmVZKHZlcnRpY2FsKSB7CiAgICBpZiAodmVydGljYWwgPiAwKSB7CiAgICAgIC8vIHVwCiAgICAgIHZhciByaSA9IGRhdGEuc2Nyb2xsLnJpICsgMTsKCiAgICAgIGlmIChyaSA8IHJvd3MubGVuKSB7CiAgICAgICAgdmFyIHJoID0gbG9vcFZhbHVlKHJpLCBmdW5jdGlvbiAoaSkgewogICAgICAgICAgcmV0dXJuIHJvd3MuZ2V0SGVpZ2h0KGkpOwogICAgICAgIH0pOwogICAgICAgIHZlcnRpY2FsU2Nyb2xsYmFyLm1vdmUoewogICAgICAgICAgdG9wOiB0b3AgKyByaCAtIDEKICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gZG93bgogICAgICB2YXIgX3JpID0gZGF0YS5zY3JvbGwucmkgLSAxOwoKICAgICAgaWYgKF9yaSA+PSAwKSB7CiAgICAgICAgdmFyIF9yaCA9IGxvb3BWYWx1ZShfcmksIGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICByZXR1cm4gcm93cy5nZXRIZWlnaHQoaSk7CiAgICAgICAgfSk7CgogICAgICAgIHZlcnRpY2FsU2Nyb2xsYmFyLm1vdmUoewogICAgICAgICAgdG9wOiBfcmkgPT09IDAgPyAwIDogdG9wIC0gX3JoCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9OyAvLyBkZWx0YVggZm9yIE1hYyBob3Jpem9udGFsIHNjcm9sbAoKCiAgdmFyIG1vdmVYID0gZnVuY3Rpb24gbW92ZVgoaG9yaXpvbnRhbCkgewogICAgaWYgKGhvcml6b250YWwgPiAwKSB7CiAgICAgIC8vIGxlZnQKICAgICAgdmFyIGNpID0gZGF0YS5zY3JvbGwuY2kgKyAxOwoKICAgICAgaWYgKGNpIDwgY29scy5sZW4pIHsKICAgICAgICB2YXIgY3cgPSBsb29wVmFsdWUoY2ksIGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICByZXR1cm4gY29scy5nZXRXaWR0aChpKTsKICAgICAgICB9KTsKICAgICAgICBob3Jpem9udGFsU2Nyb2xsYmFyLm1vdmUoewogICAgICAgICAgbGVmdDogbGVmdCArIGN3IC0gMQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyByaWdodAogICAgICB2YXIgX2NpID0gZGF0YS5zY3JvbGwuY2kgLSAxOwoKICAgICAgaWYgKF9jaSA+PSAwKSB7CiAgICAgICAgdmFyIF9jdyA9IGxvb3BWYWx1ZShfY2ksIGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICByZXR1cm4gY29scy5nZXRXaWR0aChpKTsKICAgICAgICB9KTsKCiAgICAgICAgaG9yaXpvbnRhbFNjcm9sbGJhci5tb3ZlKHsKICAgICAgICAgIGxlZnQ6IF9jaSA9PT0gMCA/IDAgOiBsZWZ0IC0gX2N3CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgdGVtcFkgPSBNYXRoLmFicyhkZWx0YVkpOwogIHZhciB0ZW1wWCA9IE1hdGguYWJzKGRlbHRhWCk7CiAgdmFyIHRlbXAgPSBNYXRoLm1heCh0ZW1wWSwgdGVtcFgpOyAvLyBjb25zb2xlLmxvZygnZXZlbnQ6JywgZXZ0KTsKICAvLyBkZXRhaWwgZm9yIHdpbmRvd3MvbWFjIGZpcmVmb3ggdmVydGljYWwgc2Nyb2xsCgogIGlmICgvRmlyZWZveC9pLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpKSB0aHJvdHRsZShtb3ZlWShldnQuZGV0YWlsKSwgNTApOwogIGlmICh0ZW1wID09PSB0ZW1wWCkgdGhyb3R0bGUobW92ZVgoZGVsdGFYKSwgNTApOwogIGlmICh0ZW1wID09PSB0ZW1wWSkgdGhyb3R0bGUobW92ZVkoZGVsdGFZKSwgNTApOwp9CgpmdW5jdGlvbiBvdmVybGF5ZXJUb3VjaChkaXJlY3Rpb24sIGRpc3RhbmNlKSB7CiAgdmFyIHZlcnRpY2FsU2Nyb2xsYmFyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbGJhciwKICAgICAgaG9yaXpvbnRhbFNjcm9sbGJhciA9IHRoaXMuaG9yaXpvbnRhbFNjcm9sbGJhcjsKCiAgdmFyIF92ZXJ0aWNhbFNjcm9sbGJhciRzYzIgPSB2ZXJ0aWNhbFNjcm9sbGJhci5zY3JvbGwoKSwKICAgICAgdG9wID0gX3ZlcnRpY2FsU2Nyb2xsYmFyJHNjMi50b3A7CgogIHZhciBfaG9yaXpvbnRhbFNjcm9sbGJhciQyID0gaG9yaXpvbnRhbFNjcm9sbGJhci5zY3JvbGwoKSwKICAgICAgbGVmdCA9IF9ob3Jpem9udGFsU2Nyb2xsYmFyJDIubGVmdDsKCiAgaWYgKGRpcmVjdGlvbiA9PT0gJ2xlZnQnIHx8IGRpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgewogICAgaG9yaXpvbnRhbFNjcm9sbGJhci5tb3ZlKHsKICAgICAgbGVmdDogbGVmdCAtIGRpc3RhbmNlCiAgICB9KTsKICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ3VwJyB8fCBkaXJlY3Rpb24gPT09ICdkb3duJykgewogICAgdmVydGljYWxTY3JvbGxiYXIubW92ZSh7CiAgICAgIHRvcDogdG9wIC0gZGlzdGFuY2UKICAgIH0pOwogIH0KfQoKZnVuY3Rpb24gdmVydGljYWxTY3JvbGxiYXJTZXQoKSB7CiAgdmFyIGRhdGEgPSB0aGlzLmRhdGEsCiAgICAgIHZlcnRpY2FsU2Nyb2xsYmFyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbGJhcjsKCiAgdmFyIF90aGlzJGdldFRhYmxlT2Zmc2V0ID0gdGhpcy5nZXRUYWJsZU9mZnNldCgpLAogICAgICBoZWlnaHQgPSBfdGhpcyRnZXRUYWJsZU9mZnNldC5oZWlnaHQ7CgogIHZhciBlcnRoID0gZGF0YS5leGNlcHRSb3dUb3RhbEhlaWdodCgwLCAtMSk7IC8vIGNvbnNvbGUubG9nKCdlcnRoOicsIGVydGgpOwoKICB2ZXJ0aWNhbFNjcm9sbGJhci5zZXQoaGVpZ2h0LCBkYXRhLnJvd3MudG90YWxIZWlnaHQoKSAtIGVydGgpOwp9CgpmdW5jdGlvbiBob3Jpem9udGFsU2Nyb2xsYmFyU2V0KCkgewogIHZhciBkYXRhID0gdGhpcy5kYXRhLAogICAgICBob3Jpem9udGFsU2Nyb2xsYmFyID0gdGhpcy5ob3Jpem9udGFsU2Nyb2xsYmFyOwoKICB2YXIgX3RoaXMkZ2V0VGFibGVPZmZzZXQyID0gdGhpcy5nZXRUYWJsZU9mZnNldCgpLAogICAgICB3aWR0aCA9IF90aGlzJGdldFRhYmxlT2Zmc2V0Mi53aWR0aDsKCiAgaWYgKGRhdGEpIHsKICAgIGhvcml6b250YWxTY3JvbGxiYXIuc2V0KHdpZHRoLCBkYXRhLmNvbHMudG90YWxXaWR0aCgpKTsKICB9Cn0KCmZ1bmN0aW9uIHNoZWV0RnJlZXplKCkgewogIHZhciBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IsCiAgICAgIGRhdGEgPSB0aGlzLmRhdGEsCiAgICAgIGVkaXRvciA9IHRoaXMuZWRpdG9yOwoKICB2YXIgX2RhdGEkZnJlZXplID0gX3NsaWNlZFRvQXJyYXkoZGF0YS5mcmVlemUsIDIpLAogICAgICByaSA9IF9kYXRhJGZyZWV6ZVswXSwKICAgICAgY2kgPSBfZGF0YSRmcmVlemVbMV07CgogIGlmIChyaSA+IDAgfHwgY2kgPiAwKSB7CiAgICB2YXIgZndpZHRoID0gZGF0YS5mcmVlemVUb3RhbFdpZHRoKCk7CiAgICB2YXIgZmhlaWdodCA9IGRhdGEuZnJlZXplVG90YWxIZWlnaHQoKTsKICAgIGVkaXRvci5zZXRGcmVlemVMZW5ndGhzKGZ3aWR0aCwgZmhlaWdodCk7CiAgfQoKICBzZWxlY3Rvci5yZXNldEFyZWFPZmZzZXQoKTsKfQoKZnVuY3Rpb24gc2hlZXRSZXNldCgpIHsKICB2YXIgdGFibGVFbCA9IHRoaXMudGFibGVFbCwKICAgICAgb3ZlcmxheWVyRWwgPSB0aGlzLm92ZXJsYXllckVsLAogICAgICBvdmVybGF5ZXJDRWwgPSB0aGlzLm92ZXJsYXllckNFbCwKICAgICAgdGFibGUgPSB0aGlzLnRhYmxlLAogICAgICB0b29sYmFyID0gdGhpcy50b29sYmFyLAogICAgICBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IsCiAgICAgIGVsID0gdGhpcy5lbDsKICB2YXIgdE9mZnNldCA9IHRoaXMuZ2V0VGFibGVPZmZzZXQoKTsKICB2YXIgdlJlY3QgPSB0aGlzLmdldFJlY3QoKTsKICB0YWJsZUVsLmF0dHIodlJlY3QpOwogIG92ZXJsYXllckVsLm9mZnNldCh2UmVjdCk7CiAgb3ZlcmxheWVyQ0VsLm9mZnNldCh0T2Zmc2V0KTsKICBlbC5jc3MoJ3dpZHRoJywgIiIuY29uY2F0KHZSZWN0LndpZHRoLCAicHgiKSk7CiAgdmVydGljYWxTY3JvbGxiYXJTZXQuY2FsbCh0aGlzKTsKICBob3Jpem9udGFsU2Nyb2xsYmFyU2V0LmNhbGwodGhpcyk7CiAgc2hlZXRGcmVlemUuY2FsbCh0aGlzKTsKICB0YWJsZS5yZW5kZXIoKTsKICB0b29sYmFyLnJlc2V0KCk7CiAgc2VsZWN0b3IucmVzZXQoKTsKfQoKZnVuY3Rpb24gY2xlYXJDbGlwYm9hcmQoKSB7CiAgdmFyIGRhdGEgPSB0aGlzLmRhdGEsCiAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvcjsKICBkYXRhLmNsZWFyQ2xpcGJvYXJkKCk7CiAgc2VsZWN0b3IuaGlkZUNsaXBib2FyZCgpOwp9CgpmdW5jdGlvbiBjb3B5KCkgewogIHZhciBkYXRhID0gdGhpcy5kYXRhLAogICAgICBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3I7CiAgZGF0YS5jb3B5KCk7CiAgc2VsZWN0b3Iuc2hvd0NsaXBib2FyZCgpOwp9CgpmdW5jdGlvbiBjdXQoKSB7CiAgdmFyIGRhdGEgPSB0aGlzLmRhdGEsCiAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvcjsKICBkYXRhLmN1dCgpOwogIHNlbGVjdG9yLnNob3dDbGlwYm9hcmQoKTsKfQoKZnVuY3Rpb24gcGFzdGUod2hhdCwgZXZ0KSB7CiAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgaWYgKGRhdGEuc2V0dGluZ3MubW9kZSA9PT0gJ3JlYWQnKSByZXR1cm47CgogIGlmIChkYXRhLnBhc3RlKHdoYXQsIGZ1bmN0aW9uIChtc2cpIHsKICAgIHJldHVybiB4dG9hc3QoJ1RpcCcsIG1zZyk7CiAgfSkpIHsKICAgIHNoZWV0UmVzZXQuY2FsbCh0aGlzKTsKICB9IGVsc2UgaWYgKGV2dCkgewogICAgdmFyIGNkYXRhID0gZXZ0LmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpOwogICAgdGhpcy5kYXRhLnBhc3RlRnJvbVRleHQoY2RhdGEpOwogICAgc2hlZXRSZXNldC5jYWxsKHRoaXMpOwogIH0KfQoKZnVuY3Rpb24gaGlkZVJvd3NPckNvbHMoKSB7CiAgdGhpcy5kYXRhLmhpZGVSb3dzT3JDb2xzKCk7CiAgc2hlZXRSZXNldC5jYWxsKHRoaXMpOwp9CgpmdW5jdGlvbiB1bmhpZGVSb3dzT3JDb2xzKHR5cGUsIGluZGV4KSB7CiAgdGhpcy5kYXRhLnVuaGlkZVJvd3NPckNvbHModHlwZSwgaW5kZXgpOwogIHNoZWV0UmVzZXQuY2FsbCh0aGlzKTsKfQoKZnVuY3Rpb24gYXV0b2ZpbHRlcigpIHsKICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICBkYXRhLmF1dG9maWx0ZXIoKTsKICBzaGVldFJlc2V0LmNhbGwodGhpcyk7Cn0KCmZ1bmN0aW9uIHRvb2xiYXJDaGFuZ2VQYWludGZvcm1hdFBhc3RlKCkgewogIHZhciB0b29sYmFyID0gdGhpcy50b29sYmFyOwoKICBpZiAodG9vbGJhci5wYWludGZvcm1hdEFjdGl2ZSgpKSB7CiAgICBwYXN0ZS5jYWxsKHRoaXMsICdmb3JtYXQnKTsKICAgIGNsZWFyQ2xpcGJvYXJkLmNhbGwodGhpcyk7CiAgICB0b29sYmFyLnBhaW50Zm9ybWF0VG9nZ2xlKCk7CiAgfQp9CgpmdW5jdGlvbiBvdmVybGF5ZXJNb3VzZWRvd24oZXZ0KSB7CiAgdmFyIF90aGlzMiA9IHRoaXM7CgogIC8vIGNvbnNvbGUubG9nKCc6Ojo6Om92ZXJsYXllci5tb3VzZWRvd246JywgZXZ0LmRldGFpbCwgZXZ0LmJ1dHRvbiwgZXZ0LmJ1dHRvbnMsIGV2dC5zaGlmdEtleSk7CiAgLy8gY29uc29sZS5sb2coJ2V2dC50YXJnZXQuY2xhc3NOYW1lOicsIGV2dC50YXJnZXQuY2xhc3NOYW1lKTsKICB2YXIgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yLAogICAgICBkYXRhID0gdGhpcy5kYXRhLAogICAgICB0YWJsZSA9IHRoaXMudGFibGUsCiAgICAgIHNvcnRGaWx0ZXIgPSB0aGlzLnNvcnRGaWx0ZXI7CiAgdmFyIG9mZnNldFggPSBldnQub2Zmc2V0WCwKICAgICAgb2Zmc2V0WSA9IGV2dC5vZmZzZXRZOwogIHZhciBpc0F1dG9maWxsRWwgPSBldnQudGFyZ2V0LmNsYXNzTmFtZSA9PT0gIiIuY29uY2F0KGNzc1ByZWZpeCwgIi1zZWxlY3Rvci1jb3JuZXIiKTsKICB2YXIgY2VsbFJlY3QgPSBkYXRhLmdldENlbGxSZWN0QnlYWShvZmZzZXRYLCBvZmZzZXRZKTsKICB2YXIgbGVmdCA9IGNlbGxSZWN0LmxlZnQsCiAgICAgIHRvcCA9IGNlbGxSZWN0LnRvcCwKICAgICAgd2lkdGggPSBjZWxsUmVjdC53aWR0aCwKICAgICAgaGVpZ2h0ID0gY2VsbFJlY3QuaGVpZ2h0OwogIHZhciByaSA9IGNlbGxSZWN0LnJpLAogICAgICBjaSA9IGNlbGxSZWN0LmNpOyAvLyBzb3J0IG9yIGZpbHRlcgoKICB2YXIgYXV0b0ZpbHRlciA9IGRhdGEuYXV0b0ZpbHRlcjsKCiAgaWYgKGF1dG9GaWx0ZXIuaW5jbHVkZXMocmksIGNpKSkgewogICAgaWYgKGxlZnQgKyB3aWR0aCAtIDIwIDwgb2Zmc2V0WCAmJiB0b3AgKyBoZWlnaHQgLSAyMCA8IG9mZnNldFkpIHsKICAgICAgdmFyIGl0ZW1zID0gYXV0b0ZpbHRlci5pdGVtcyhjaSwgZnVuY3Rpb24gKHIsIGMpIHsKICAgICAgICByZXR1cm4gZGF0YS5yb3dzLmdldENlbGwociwgYyk7CiAgICAgIH0pOwogICAgICBzb3J0RmlsdGVyLmhpZGUoKTsKICAgICAgc29ydEZpbHRlci5zZXQoY2ksIGl0ZW1zLCBhdXRvRmlsdGVyLmdldEZpbHRlcihjaSksIGF1dG9GaWx0ZXIuZ2V0U29ydChjaSkpOwogICAgICBzb3J0RmlsdGVyLnNldE9mZnNldCh7CiAgICAgICAgbGVmdDogbGVmdCwKICAgICAgICB0b3A6IHRvcCArIGhlaWdodCArIDIKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICB9IC8vIGNvbnNvbGUubG9nKCdyaTonLCByaSwgJywgY2k6JywgY2kpOwoKCiAgaWYgKCFldnQuc2hpZnRLZXkpIHsKICAgIC8vIGNvbnNvbGUubG9nKCdzZWxlY3RvclNldFN0YXJ0Ojo6Jyk7CiAgICBpZiAoaXNBdXRvZmlsbEVsKSB7CiAgICAgIHNlbGVjdG9yLnNob3dBdXRvZmlsbChyaSwgY2kpOwogICAgfSBlbHNlIHsKICAgICAgc2VsZWN0b3JTZXQuY2FsbCh0aGlzLCBmYWxzZSwgcmksIGNpKTsKICAgIH0gLy8gbW91c2UgbW92ZSB1cAoKCiAgICBtb3VzZU1vdmVVcCh3aW5kb3csIGZ1bmN0aW9uIChlKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdtb3VzZU1vdmVVcDo6OjonKTsKICAgICAgdmFyIF9kYXRhJGdldENlbGxSZWN0QnlYWSA9IGRhdGEuZ2V0Q2VsbFJlY3RCeVhZKGUub2Zmc2V0WCwgZS5vZmZzZXRZKTsKCiAgICAgIHJpID0gX2RhdGEkZ2V0Q2VsbFJlY3RCeVhZLnJpOwogICAgICBjaSA9IF9kYXRhJGdldENlbGxSZWN0QnlYWS5jaTsKCiAgICAgIGlmIChpc0F1dG9maWxsRWwpIHsKICAgICAgICBzZWxlY3Rvci5zaG93QXV0b2ZpbGwocmksIGNpKTsKICAgICAgfSBlbHNlIGlmIChlLmJ1dHRvbnMgPT09IDEgJiYgIWUuc2hpZnRLZXkpIHsKICAgICAgICBzZWxlY3RvclNldC5jYWxsKF90aGlzMiwgdHJ1ZSwgcmksIGNpLCB0cnVlLCB0cnVlKTsKICAgICAgfQogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoaXNBdXRvZmlsbEVsICYmIHNlbGVjdG9yLmFyYW5nZSAmJiBkYXRhLnNldHRpbmdzLm1vZGUgIT09ICdyZWFkJykgewogICAgICAgIGlmIChkYXRhLmF1dG9maWxsKHNlbGVjdG9yLmFyYW5nZSwgJ2FsbCcsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgIHJldHVybiB4dG9hc3QoJ1RpcCcsIG1zZyk7CiAgICAgICAgfSkpIHsKICAgICAgICAgIHRhYmxlLnJlbmRlcigpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc2VsZWN0b3IuaGlkZUF1dG9maWxsKCk7CiAgICAgIHRvb2xiYXJDaGFuZ2VQYWludGZvcm1hdFBhc3RlLmNhbGwoX3RoaXMyKTsKICAgIH0pOwogIH0KCiAgaWYgKCFpc0F1dG9maWxsRWwgJiYgZXZ0LmJ1dHRvbnMgPT09IDEpIHsKICAgIGlmIChldnQuc2hpZnRLZXkpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ3NoaWZ0S2V5Ojo6OicpOwogICAgICBzZWxlY3RvclNldC5jYWxsKHRoaXMsIHRydWUsIHJpLCBjaSk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBlZGl0b3JTZXRPZmZzZXQoKSB7CiAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yLAogICAgICBkYXRhID0gdGhpcy5kYXRhOwogIHZhciBzT2Zmc2V0ID0gZGF0YS5nZXRTZWxlY3RlZFJlY3QoKTsKICB2YXIgdE9mZnNldCA9IHRoaXMuZ2V0VGFibGVPZmZzZXQoKTsKICB2YXIgc1Bvc2l0aW9uID0gJ3RvcCc7IC8vIGNvbnNvbGUubG9nKCdzT2Zmc2V0OicsIHNPZmZzZXQsICc6JywgdE9mZnNldCk7CgogIGlmIChzT2Zmc2V0LnRvcCA+IHRPZmZzZXQuaGVpZ2h0IC8gMikgewogICAgc1Bvc2l0aW9uID0gJ2JvdHRvbSc7CiAgfQoKICBlZGl0b3Iuc2V0T2Zmc2V0KHNPZmZzZXQsIHNQb3NpdGlvbik7Cn0KCmZ1bmN0aW9uIGVkaXRvclNldCgpIHsKICB2YXIgZWRpdG9yID0gdGhpcy5lZGl0b3IsCiAgICAgIGRhdGEgPSB0aGlzLmRhdGE7CiAgaWYgKGRhdGEuc2V0dGluZ3MubW9kZSA9PT0gJ3JlYWQnKSByZXR1cm47CiAgZWRpdG9yU2V0T2Zmc2V0LmNhbGwodGhpcyk7CiAgZWRpdG9yLnNldENlbGwoZGF0YS5nZXRTZWxlY3RlZENlbGwoKSwgZGF0YS5nZXRTZWxlY3RlZFZhbGlkYXRvcigpKTsKICBjbGVhckNsaXBib2FyZC5jYWxsKHRoaXMpOwp9CgpmdW5jdGlvbiB2ZXJ0aWNhbFNjcm9sbGJhck1vdmUoZGlzdGFuY2UpIHsKICB2YXIgX3RoaXMzID0gdGhpczsKCiAgdmFyIGRhdGEgPSB0aGlzLmRhdGEsCiAgICAgIHRhYmxlID0gdGhpcy50YWJsZSwKICAgICAgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yOwogIGRhdGEuc2Nyb2xseShkaXN0YW5jZSwgZnVuY3Rpb24gKCkgewogICAgc2VsZWN0b3IucmVzZXRCUkxBcmVhT2Zmc2V0KCk7CiAgICBlZGl0b3JTZXRPZmZzZXQuY2FsbChfdGhpczMpOwogICAgdGFibGUucmVuZGVyKCk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGhvcml6b250YWxTY3JvbGxiYXJNb3ZlKGRpc3RhbmNlKSB7CiAgdmFyIF90aGlzNCA9IHRoaXM7CgogIHZhciBkYXRhID0gdGhpcy5kYXRhLAogICAgICB0YWJsZSA9IHRoaXMudGFibGUsCiAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvcjsKICBkYXRhLnNjcm9sbHgoZGlzdGFuY2UsIGZ1bmN0aW9uICgpIHsKICAgIHNlbGVjdG9yLnJlc2V0QlJUQXJlYU9mZnNldCgpOwogICAgZWRpdG9yU2V0T2Zmc2V0LmNhbGwoX3RoaXM0KTsKICAgIHRhYmxlLnJlbmRlcigpOwogIH0pOwp9CgpmdW5jdGlvbiByb3dSZXNpemVyRmluaXNoZWQoY1JlY3QsIGRpc3RhbmNlKSB7CiAgdmFyIHJpID0gY1JlY3Qucmk7CiAgdmFyIHRhYmxlID0gdGhpcy50YWJsZSwKICAgICAgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yLAogICAgICBkYXRhID0gdGhpcy5kYXRhOwogIGRhdGEucm93cy5zZXRIZWlnaHQocmksIGRpc3RhbmNlKTsKICB0YWJsZS5yZW5kZXIoKTsKICBzZWxlY3Rvci5yZXNldEFyZWFPZmZzZXQoKTsKICB2ZXJ0aWNhbFNjcm9sbGJhclNldC5jYWxsKHRoaXMpOwogIGVkaXRvclNldE9mZnNldC5jYWxsKHRoaXMpOwp9CgpmdW5jdGlvbiBjb2xSZXNpemVyRmluaXNoZWQoY1JlY3QsIGRpc3RhbmNlKSB7CiAgdmFyIGNpID0gY1JlY3QuY2k7CiAgdmFyIHRhYmxlID0gdGhpcy50YWJsZSwKICAgICAgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yLAogICAgICBkYXRhID0gdGhpcy5kYXRhOwogIGRhdGEuY29scy5zZXRXaWR0aChjaSwgZGlzdGFuY2UpOyAvLyBjb25zb2xlLmxvZygnZGF0YTonLCBkYXRhKTsKCiAgdGFibGUucmVuZGVyKCk7CiAgc2VsZWN0b3IucmVzZXRBcmVhT2Zmc2V0KCk7CiAgaG9yaXpvbnRhbFNjcm9sbGJhclNldC5jYWxsKHRoaXMpOwogIGVkaXRvclNldE9mZnNldC5jYWxsKHRoaXMpOwp9CgpmdW5jdGlvbiBkYXRhU2V0Q2VsbFRleHQodGV4dCkgewogIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJ2ZpbmlzaGVkJzsKICB2YXIgZGF0YSA9IHRoaXMuZGF0YSwKICAgICAgdGFibGUgPSB0aGlzLnRhYmxlOyAvLyBjb25zdCBbcmksIGNpXSA9IHNlbGVjdG9yLmluZGV4ZXM7CgogIGlmIChkYXRhLnNldHRpbmdzLm1vZGUgPT09ICdyZWFkJykgcmV0dXJuOwogIGRhdGEuc2V0U2VsZWN0ZWRDZWxsVGV4dCh0ZXh0LCBzdGF0ZSk7CiAgdmFyIF9kYXRhJHNlbGVjdG9yID0gZGF0YS5zZWxlY3RvciwKICAgICAgcmkgPSBfZGF0YSRzZWxlY3Rvci5yaSwKICAgICAgY2kgPSBfZGF0YSRzZWxlY3Rvci5jaTsKCiAgaWYgKHN0YXRlID09PSAnZmluaXNoZWQnKSB7CiAgICB0YWJsZS5yZW5kZXIoKTsKICB9IGVsc2UgewogICAgdGhpcy50cmlnZ2VyKCdjZWxsLWVkaXRlZCcsIHRleHQsIHJpLCBjaSk7CiAgfQp9CgpmdW5jdGlvbiBpbnNlcnREZWxldGVSb3dDb2x1bW4odHlwZSkgewogIHZhciBkYXRhID0gdGhpcy5kYXRhOwogIGlmIChkYXRhLnNldHRpbmdzLm1vZGUgPT09ICdyZWFkJykgcmV0dXJuOwoKICBpZiAodHlwZSA9PT0gJ2luc2VydC1yb3cnKSB7CiAgICBkYXRhLmluc2VydCgncm93Jyk7CiAgfSBlbHNlIGlmICh0eXBlID09PSAnZGVsZXRlLXJvdycpIHsKICAgIGRhdGEuZGVsZXRlKCdyb3cnKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdpbnNlcnQtY29sdW1uJykgewogICAgZGF0YS5pbnNlcnQoJ2NvbHVtbicpOwogIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2RlbGV0ZS1jb2x1bW4nKSB7CiAgICBkYXRhLmRlbGV0ZSgnY29sdW1uJyk7CiAgfSBlbHNlIGlmICh0eXBlID09PSAnZGVsZXRlLWNlbGwnKSB7CiAgICBkYXRhLmRlbGV0ZUNlbGwoKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdkZWxldGUtY2VsbC1mb3JtYXQnKSB7CiAgICBkYXRhLmRlbGV0ZUNlbGwoJ2Zvcm1hdCcpOwogIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2RlbGV0ZS1jZWxsLXRleHQnKSB7CiAgICBkYXRhLmRlbGV0ZUNlbGwoJ3RleHQnKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjZWxsLXByaW50YWJsZScpIHsKICAgIGRhdGEuc2V0U2VsZWN0ZWRDZWxsQXR0cigncHJpbnRhYmxlJywgdHJ1ZSk7CiAgfSBlbHNlIGlmICh0eXBlID09PSAnY2VsbC1ub24tcHJpbnRhYmxlJykgewogICAgZGF0YS5zZXRTZWxlY3RlZENlbGxBdHRyKCdwcmludGFibGUnLCBmYWxzZSk7CiAgfSBlbHNlIGlmICh0eXBlID09PSAnY2VsbC1lZGl0YWJsZScpIHsKICAgIGRhdGEuc2V0U2VsZWN0ZWRDZWxsQXR0cignZWRpdGFibGUnLCB0cnVlKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjZWxsLW5vbi1lZGl0YWJsZScpIHsKICAgIGRhdGEuc2V0U2VsZWN0ZWRDZWxsQXR0cignZWRpdGFibGUnLCBmYWxzZSk7CiAgfQoKICBjbGVhckNsaXBib2FyZC5jYWxsKHRoaXMpOwogIHNoZWV0UmVzZXQuY2FsbCh0aGlzKTsKfQoKZnVuY3Rpb24gdG9vbGJhckNoYW5nZSh0eXBlLCB2YWx1ZSkgewogIHZhciBkYXRhID0gdGhpcy5kYXRhOwoKICBpZiAodHlwZSA9PT0gJ3VuZG8nKSB7CiAgICB0aGlzLnVuZG8oKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdyZWRvJykgewogICAgdGhpcy5yZWRvKCk7CiAgfSBlbHNlIGlmICh0eXBlID09PSAncHJpbnQnKSB7CiAgICB0aGlzLnByaW50LnByZXZpZXcoKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdwYWludGZvcm1hdCcpIHsKICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkgY29weS5jYWxsKHRoaXMpO2Vsc2UgY2xlYXJDbGlwYm9hcmQuY2FsbCh0aGlzKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjbGVhcmZvcm1hdCcpIHsKICAgIGluc2VydERlbGV0ZVJvd0NvbHVtbi5jYWxsKHRoaXMsICdkZWxldGUtY2VsbC1mb3JtYXQnKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdsaW5rJykgey8vIGxpbmsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjaGFydCcpIHsvLyBjaGFydAogIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2F1dG9maWx0ZXInKSB7CiAgICAvLyBmaWx0ZXIKICAgIGF1dG9maWx0ZXIuY2FsbCh0aGlzKTsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmcmVlemUnKSB7CiAgICBpZiAodmFsdWUpIHsKICAgICAgdmFyIF9kYXRhJHNlbGVjdG9yMiA9IGRhdGEuc2VsZWN0b3IsCiAgICAgICAgICByaSA9IF9kYXRhJHNlbGVjdG9yMi5yaSwKICAgICAgICAgIGNpID0gX2RhdGEkc2VsZWN0b3IyLmNpOwogICAgICB0aGlzLmZyZWV6ZShyaSwgY2kpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5mcmVlemUoMCwgMCk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGRhdGEuc2V0U2VsZWN0ZWRDZWxsQXR0cih0eXBlLCB2YWx1ZSk7CgogICAgaWYgKHR5cGUgPT09ICdmb3JtdWxhJyAmJiAhZGF0YS5zZWxlY3Rvci5tdWx0aXBsZSgpKSB7CiAgICAgIGVkaXRvclNldC5jYWxsKHRoaXMpOwogICAgfQoKICAgIHNoZWV0UmVzZXQuY2FsbCh0aGlzKTsKICB9Cn0KCmZ1bmN0aW9uIHNvcnRGaWx0ZXJDaGFuZ2UoY2ksIG9yZGVyLCBvcGVyYXRvciwgdmFsdWUpIHsKICAvLyBjb25zb2xlLmxvZygnc29ydDonLCBzb3J0RGVzYywgb3BlcmF0b3IsIHZhbHVlKTsKICB0aGlzLmRhdGEuc2V0QXV0b0ZpbHRlcihjaSwgb3JkZXIsIG9wZXJhdG9yLCB2YWx1ZSk7CiAgc2hlZXRSZXNldC5jYWxsKHRoaXMpOwp9CgpmdW5jdGlvbiBzaGVldEluaXRFdmVudHMoKSB7CiAgdmFyIF90aGlzNSA9IHRoaXM7CgogIHZhciBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IsCiAgICAgIG92ZXJsYXllckVsID0gdGhpcy5vdmVybGF5ZXJFbCwKICAgICAgcm93UmVzaXplciA9IHRoaXMucm93UmVzaXplciwKICAgICAgY29sUmVzaXplciA9IHRoaXMuY29sUmVzaXplciwKICAgICAgdmVydGljYWxTY3JvbGxiYXIgPSB0aGlzLnZlcnRpY2FsU2Nyb2xsYmFyLAogICAgICBob3Jpem9udGFsU2Nyb2xsYmFyID0gdGhpcy5ob3Jpem9udGFsU2Nyb2xsYmFyLAogICAgICBlZGl0b3IgPSB0aGlzLmVkaXRvciwKICAgICAgY29udGV4dE1lbnUgPSB0aGlzLmNvbnRleHRNZW51LAogICAgICB0b29sYmFyID0gdGhpcy50b29sYmFyLAogICAgICBtb2RhbFZhbGlkYXRpb24gPSB0aGlzLm1vZGFsVmFsaWRhdGlvbiwKICAgICAgc29ydEZpbHRlciA9IHRoaXMuc29ydEZpbHRlcjsgLy8gb3ZlcmxheWVyCgogIG92ZXJsYXllckVsLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICBvdmVybGF5ZXJNb3VzZW1vdmUuY2FsbChfdGhpczUsIGV2dCk7CiAgfSkub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldnQpIHsKICAgIGVkaXRvci5jbGVhcigpOwogICAgY29udGV4dE1lbnUuaGlkZSgpOyAvLyB0aGUgbGVmdCBtb3VzZSBidXR0b246IG1vdXNlZG93biDihpIgbW91c2V1cCDihpIgY2xpY2sKICAgIC8vIHRoZSByaWdodCBtb3VzZSBidXR0b246IG1vdXNlZG93biDihpIgY29udGVueHRtZW51IOKGkiBtb3VzZXVwCgogICAgaWYgKGV2dC5idXR0b25zID09PSAyKSB7CiAgICAgIGlmIChfdGhpczUuZGF0YS54eUluU2VsZWN0ZWRSZWN0KGV2dC5vZmZzZXRYLCBldnQub2Zmc2V0WSkpIHsKICAgICAgICBjb250ZXh0TWVudS5zZXRQb3NpdGlvbihldnQub2Zmc2V0WCwgZXZ0Lm9mZnNldFkpOwogICAgICB9IGVsc2UgewogICAgICAgIG92ZXJsYXllck1vdXNlZG93bi5jYWxsKF90aGlzNSwgZXZ0KTsKICAgICAgICBjb250ZXh0TWVudS5zZXRQb3NpdGlvbihldnQub2Zmc2V0WCwgZXZ0Lm9mZnNldFkpOwogICAgICB9CgogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9IGVsc2UgaWYgKGV2dC5kZXRhaWwgPT09IDIpIHsKICAgICAgZWRpdG9yU2V0LmNhbGwoX3RoaXM1KTsKICAgIH0gZWxzZSB7CiAgICAgIG92ZXJsYXllck1vdXNlZG93bi5jYWxsKF90aGlzNSwgZXZ0KTsKICAgIH0KICB9KS5vbignbW91c2V3aGVlbC5zdG9wJywgZnVuY3Rpb24gKGV2dCkgewogICAgb3ZlcmxheWVyTW91c2VzY3JvbGwuY2FsbChfdGhpczUsIGV2dCk7CiAgfSkub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIG9mZnNldFggPSBldnQub2Zmc2V0WCwKICAgICAgICBvZmZzZXRZID0gZXZ0Lm9mZnNldFk7CiAgICBpZiAob2Zmc2V0WSA8PSAwKSBjb2xSZXNpemVyLmhpZGUoKTsKICAgIGlmIChvZmZzZXRYIDw9IDApIHJvd1Jlc2l6ZXIuaGlkZSgpOwogIH0pOwoKICBzZWxlY3Rvci5pbnB1dENoYW5nZSA9IGZ1bmN0aW9uICh2KSB7CiAgICBkYXRhU2V0Q2VsbFRleHQuY2FsbChfdGhpczUsIHYsICdpbnB1dCcpOwogICAgZWRpdG9yU2V0LmNhbGwoX3RoaXM1KTsKICB9OyAvLyBzbGlkZSBvbiBtb2JpbGUKCgogIGJpbmRUb3VjaChvdmVybGF5ZXJFbC5lbCwgewogICAgbW92ZTogZnVuY3Rpb24gbW92ZShkaXJlY3Rpb24sIGQpIHsKICAgICAgb3ZlcmxheWVyVG91Y2guY2FsbChfdGhpczUsIGRpcmVjdGlvbiwgZCk7CiAgICB9CiAgfSk7IC8vIHRvb2xiYXIgY2hhbmdlCgogIHRvb2xiYXIuY2hhbmdlID0gZnVuY3Rpb24gKHR5cGUsIHZhbHVlKSB7CiAgICByZXR1cm4gdG9vbGJhckNoYW5nZS5jYWxsKF90aGlzNSwgdHlwZSwgdmFsdWUpOwogIH07IC8vIHNvcnQgZmlsdGVyIG9rCgoKICBzb3J0RmlsdGVyLm9rID0gZnVuY3Rpb24gKGNpLCBvcmRlciwgbywgdikgewogICAgcmV0dXJuIHNvcnRGaWx0ZXJDaGFuZ2UuY2FsbChfdGhpczUsIGNpLCBvcmRlciwgbywgdik7CiAgfTsgLy8gcmVzaXplciBmaW5pc2hlZCBjYWxsYmFjawoKCiAgcm93UmVzaXplci5maW5pc2hlZEZuID0gZnVuY3Rpb24gKGNSZWN0LCBkaXN0YW5jZSkgewogICAgcm93UmVzaXplckZpbmlzaGVkLmNhbGwoX3RoaXM1LCBjUmVjdCwgZGlzdGFuY2UpOwogIH07CgogIGNvbFJlc2l6ZXIuZmluaXNoZWRGbiA9IGZ1bmN0aW9uIChjUmVjdCwgZGlzdGFuY2UpIHsKICAgIGNvbFJlc2l6ZXJGaW5pc2hlZC5jYWxsKF90aGlzNSwgY1JlY3QsIGRpc3RhbmNlKTsKICB9OyAvLyByZXNpemVyIHVuaGlkZSBjYWxsYmFjawoKCiAgcm93UmVzaXplci51bmhpZGVGbiA9IGZ1bmN0aW9uIChpbmRleCkgewogICAgdW5oaWRlUm93c09yQ29scy5jYWxsKF90aGlzNSwgJ3JvdycsIGluZGV4KTsKICB9OwoKICBjb2xSZXNpemVyLnVuaGlkZUZuID0gZnVuY3Rpb24gKGluZGV4KSB7CiAgICB1bmhpZGVSb3dzT3JDb2xzLmNhbGwoX3RoaXM1LCAnY29sJywgaW5kZXgpOwogIH07IC8vIHNjcm9sbGJhciBtb3ZlIGNhbGxiYWNrCgoKICB2ZXJ0aWNhbFNjcm9sbGJhci5tb3ZlRm4gPSBmdW5jdGlvbiAoZGlzdGFuY2UsIGV2dCkgewogICAgdmVydGljYWxTY3JvbGxiYXJNb3ZlLmNhbGwoX3RoaXM1LCBkaXN0YW5jZSwgZXZ0KTsKICB9OwoKICBob3Jpem9udGFsU2Nyb2xsYmFyLm1vdmVGbiA9IGZ1bmN0aW9uIChkaXN0YW5jZSwgZXZ0KSB7CiAgICBob3Jpem9udGFsU2Nyb2xsYmFyTW92ZS5jYWxsKF90aGlzNSwgZGlzdGFuY2UsIGV2dCk7CiAgfTsgLy8gZWRpdG9yCgoKICBlZGl0b3IuY2hhbmdlID0gZnVuY3Rpb24gKHN0YXRlLCBpdGV4dCkgewogICAgZGF0YVNldENlbGxUZXh0LmNhbGwoX3RoaXM1LCBpdGV4dCwgc3RhdGUpOwogIH07IC8vIG1vZGFsIHZhbGlkYXRpb24KCgogIG1vZGFsVmFsaWRhdGlvbi5jaGFuZ2UgPSBmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICBpZiAoYWN0aW9uID09PSAnc2F2ZScpIHsKICAgICAgdmFyIF90aGlzNSRkYXRhOwoKICAgICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4yID4gMSA/IF9sZW4yIC0gMSA6IDApLCBfa2V5MiA9IDE7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHsKICAgICAgICBhcmdzW19rZXkyIC0gMV0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgICB9CgogICAgICAoX3RoaXM1JGRhdGEgPSBfdGhpczUuZGF0YSkuYWRkVmFsaWRhdGlvbi5hcHBseShfdGhpczUkZGF0YSwgYXJncyk7CiAgICB9IGVsc2UgewogICAgICBfdGhpczUuZGF0YS5yZW1vdmVWYWxpZGF0aW9uKCk7CiAgICB9CiAgfTsgLy8gY29udGV4dG1lbnUKCgogIGNvbnRleHRNZW51Lml0ZW1DbGljayA9IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAvLyBjb25zb2xlLmxvZygndHlwZTonLCB0eXBlKTsKICAgIGlmICh0eXBlID09PSAndmFsaWRhdGlvbicpIHsKICAgICAgbW9kYWxWYWxpZGF0aW9uLnNldFZhbHVlKF90aGlzNS5kYXRhLmdldFNlbGVjdGVkVmFsaWRhdGlvbigpKTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2NvcHknKSB7CiAgICAgIGNvcHkuY2FsbChfdGhpczUpOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAnY3V0JykgewogICAgICBjdXQuY2FsbChfdGhpczUpOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAncGFzdGUnKSB7CiAgICAgIHBhc3RlLmNhbGwoX3RoaXM1LCAnYWxsJyk7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdwYXN0ZS12YWx1ZScpIHsKICAgICAgcGFzdGUuY2FsbChfdGhpczUsICd0ZXh0Jyk7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdwYXN0ZS1mb3JtYXQnKSB7CiAgICAgIHBhc3RlLmNhbGwoX3RoaXM1LCAnZm9ybWF0Jyk7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdoaWRlJykgewogICAgICBoaWRlUm93c09yQ29scy5jYWxsKF90aGlzNSk7CiAgICB9IGVsc2UgewogICAgICBpbnNlcnREZWxldGVSb3dDb2x1bW4uY2FsbChfdGhpczUsIHR5cGUpOwogICAgfQogIH07CgogIGJpbmQod2luZG93LCAncmVzaXplJywgZnVuY3Rpb24gKCkgewogICAgX3RoaXM1LnJlbG9hZCgpOwogIH0pOwogIGJpbmQod2luZG93LCAnY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICBfdGhpczUuZm9jdXNpbmcgPSBvdmVybGF5ZXJFbC5jb250YWlucyhldnQudGFyZ2V0KTsKICB9KTsKICBiaW5kKHdpbmRvdywgJ3Bhc3RlJywgZnVuY3Rpb24gKGV2dCkgewogICAgaWYgKCFfdGhpczUuZm9jdXNpbmcpIHJldHVybjsKICAgIHBhc3RlLmNhbGwoX3RoaXM1LCAnYWxsJywgZXZ0KTsKICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogIH0pOyAvLyBmb3Igc2VsZWN0b3IKCiAgYmluZCh3aW5kb3csICdrZXlkb3duJywgZnVuY3Rpb24gKGV2dCkgewogICAgaWYgKCFfdGhpczUuZm9jdXNpbmcpIHJldHVybjsKICAgIHZhciBrZXlDb2RlID0gZXZ0LmtleUNvZGUgfHwgZXZ0LndoaWNoOwogICAgdmFyIGtleSA9IGV2dC5rZXksCiAgICAgICAgY3RybEtleSA9IGV2dC5jdHJsS2V5LAogICAgICAgIHNoaWZ0S2V5ID0gZXZ0LnNoaWZ0S2V5LAogICAgICAgIG1ldGFLZXkgPSBldnQubWV0YUtleTsgLy8gY29uc29sZS5sb2coJ2tleWRvd24uZXZ0OiAnLCBrZXlDb2RlKTsKCiAgICBpZiAoY3RybEtleSB8fCBtZXRhS2V5KSB7CiAgICAgIC8vIGNvbnN0IHsgc0luZGV4ZXMsIGVJbmRleGVzIH0gPSBzZWxlY3RvcjsKICAgICAgLy8gbGV0IHdoYXQgPSAnYWxsJzsKICAgICAgLy8gaWYgKHNoaWZ0S2V5KSB3aGF0ID0gJ3RleHQnOwogICAgICAvLyBpZiAoYWx0S2V5KSB3aGF0ID0gJ2Zvcm1hdCc7CiAgICAgIHN3aXRjaCAoa2V5Q29kZSkgewogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAvLyB1bmRvOiBjdHJsICsgegogICAgICAgICAgX3RoaXM1LnVuZG8oKTsKCiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDg5OgogICAgICAgICAgLy8gcmVkbzogY3RybCArIHkKICAgICAgICAgIF90aGlzNS5yZWRvKCk7CgogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSA2NzoKICAgICAgICAgIC8vIGN0cmwgKyBjCiAgICAgICAgICBjb3B5LmNhbGwoX3RoaXM1KTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgODg6CiAgICAgICAgICAvLyBjdHJsICsgeAogICAgICAgICAgY3V0LmNhbGwoX3RoaXM1KTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgODU6CiAgICAgICAgICAvLyBjdHJsICsgdQogICAgICAgICAgdG9vbGJhci50cmlnZ2VyKCd1bmRlcmxpbmUnKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgODY6CiAgICAgICAgICAvLyBjdHJsICsgdgogICAgICAgICAgLy8gPT4gcGFzdGUKICAgICAgICAgIC8vIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAvLyBjdHJsICsgbGVmdAogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBzaGlmdEtleSwgJ3Jvdy1maXJzdCcpOwogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAzODoKICAgICAgICAgIC8vIGN0cmwgKyB1cAogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBzaGlmdEtleSwgJ2NvbC1maXJzdCcpOwogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAzOToKICAgICAgICAgIC8vIGN0cmwgKyByaWdodAogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBzaGlmdEtleSwgJ3Jvdy1sYXN0Jyk7CiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDQwOgogICAgICAgICAgLy8gY3RybCArIGRvd24KICAgICAgICAgIHNlbGVjdG9yTW92ZS5jYWxsKF90aGlzNSwgc2hpZnRLZXksICdjb2wtbGFzdCcpOwogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAzMjoKICAgICAgICAgIC8vIGN0cmwgKyBzcGFjZSwgYWxsIGNlbGxzIGluIGNvbAogICAgICAgICAgc2VsZWN0b3JTZXQuY2FsbChfdGhpczUsIGZhbHNlLCAtMSwgX3RoaXM1LmRhdGEuc2VsZWN0b3IuY2ksIGZhbHNlKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgNjY6CiAgICAgICAgICAvLyBjdHJsICsgQgogICAgICAgICAgdG9vbGJhci50cmlnZ2VyKCdib2xkJyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSA3MzoKICAgICAgICAgIC8vIGN0cmwgKyBJCiAgICAgICAgICB0b29sYmFyLnRyaWdnZXIoJ2l0YWxpYycpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2V2dC5rZXlDb2RlOicsIGV2dC5rZXlDb2RlKTsKICAgICAgc3dpdGNoIChrZXlDb2RlKSB7CiAgICAgICAgY2FzZSAzMjoKICAgICAgICAgIGlmIChzaGlmdEtleSkgewogICAgICAgICAgICAvLyBzaGlmdCArIHNwYWNlLCBhbGwgY2VsbHMgaW4gcm93CiAgICAgICAgICAgIHNlbGVjdG9yU2V0LmNhbGwoX3RoaXM1LCBmYWxzZSwgX3RoaXM1LmRhdGEuc2VsZWN0b3IucmksIC0xLCBmYWxzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAvLyBlc2MKICAgICAgICAgIGNvbnRleHRNZW51LmhpZGUoKTsKICAgICAgICAgIGNsZWFyQ2xpcGJvYXJkLmNhbGwoX3RoaXM1KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDM3OgogICAgICAgICAgLy8gbGVmdAogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBzaGlmdEtleSwgJ2xlZnQnKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAvLyB1cAogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBzaGlmdEtleSwgJ3VwJyk7CiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDM5OgogICAgICAgICAgLy8gcmlnaHQKICAgICAgICAgIHNlbGVjdG9yTW92ZS5jYWxsKF90aGlzNSwgc2hpZnRLZXksICdyaWdodCcpOwogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSA0MDoKICAgICAgICAgIC8vIGRvd24KICAgICAgICAgIHNlbGVjdG9yTW92ZS5jYWxsKF90aGlzNSwgc2hpZnRLZXksICdkb3duJyk7CiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDk6CiAgICAgICAgICAvLyB0YWIKICAgICAgICAgIGVkaXRvci5jbGVhcigpOyAvLyBzaGlmdCArIHRhYiA9PiBtb3ZlIGxlZnQKICAgICAgICAgIC8vIHRhYiA9PiBtb3ZlIHJpZ2h0CgogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBmYWxzZSwgc2hpZnRLZXkgPyAnbGVmdCcgOiAncmlnaHQnKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAvLyBlbnRlcgogICAgICAgICAgZWRpdG9yLmNsZWFyKCk7IC8vIHNoaWZ0ICsgZW50ZXIgPT4gbW92ZSB1cAogICAgICAgICAgLy8gZW50ZXIgPT4gbW92ZSBkb3duCgogICAgICAgICAgc2VsZWN0b3JNb3ZlLmNhbGwoX3RoaXM1LCBmYWxzZSwgc2hpZnRLZXkgPyAndXAnIDogJ2Rvd24nKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgODoKICAgICAgICAgIC8vIGJhY2tzcGFjZQogICAgICAgICAgaW5zZXJ0RGVsZXRlUm93Q29sdW1uLmNhbGwoX3RoaXM1LCAnZGVsZXRlLWNlbGwtdGV4dCcpOwogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICBpZiAoa2V5ID09PSAnRGVsZXRlJykgewogICAgICAgIGluc2VydERlbGV0ZVJvd0NvbHVtbi5jYWxsKF90aGlzNSwgJ2RlbGV0ZS1jZWxsLXRleHQnKTsKICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID49IDY1ICYmIGtleUNvZGUgPD0gOTAgfHwga2V5Q29kZSA+PSA0OCAmJiBrZXlDb2RlIDw9IDU3IHx8IGtleUNvZGUgPj0gOTYgJiYga2V5Q29kZSA8PSAxMDUgfHwgZXZ0LmtleSA9PT0gJz0nKSB7CiAgICAgICAgZGF0YVNldENlbGxUZXh0LmNhbGwoX3RoaXM1LCBldnQua2V5LCAnaW5wdXQnKTsKICAgICAgICBlZGl0b3JTZXQuY2FsbChfdGhpczUpOwogICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT09IDExMykgewogICAgICAgIC8vIEYyCiAgICAgICAgZWRpdG9yU2V0LmNhbGwoX3RoaXM1KTsKICAgICAgfQogICAgfQogIH0pOwp9Cgp2YXIgU2hlZXQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFNoZWV0KHRhcmdldEVsLCBkYXRhKSB7CiAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2hlZXQpOwoKICAgIHRoaXMuZXZlbnRNYXAgPSBuZXcgTWFwKCk7CiAgICB2YXIgX2RhdGEkc2V0dGluZ3MgPSBkYXRhLnNldHRpbmdzLAogICAgICAgIHZpZXcgPSBfZGF0YSRzZXR0aW5ncy52aWV3LAogICAgICAgIHNob3dUb29sYmFyID0gX2RhdGEkc2V0dGluZ3Muc2hvd1Rvb2xiYXIsCiAgICAgICAgc2hvd0NvbnRleHRtZW51ID0gX2RhdGEkc2V0dGluZ3Muc2hvd0NvbnRleHRtZW51OwogICAgdGhpcy5lbCA9IGgoJ2RpdicsICIiLmNvbmNhdChjc3NQcmVmaXgsICItc2hlZXQiKSk7CiAgICB0aGlzLnRvb2xiYXIgPSBuZXcgVG9vbGJhcihkYXRhLCB2aWV3LndpZHRoLCAhc2hvd1Rvb2xiYXIpOwogICAgdGhpcy5wcmludCA9IG5ldyBQcmludChkYXRhKTsKICAgIHRhcmdldEVsLmNoaWxkcmVuKHRoaXMudG9vbGJhci5lbCwgdGhpcy5lbCwgdGhpcy5wcmludC5lbCk7CiAgICB0aGlzLmRhdGEgPSBkYXRhOyAvLyB0YWJsZQoKICAgIHRoaXMudGFibGVFbCA9IGgoJ2NhbnZhcycsICIiLmNvbmNhdChjc3NQcmVmaXgsICItdGFibGUiKSk7IC8vIHJlc2l6ZXIKCiAgICB0aGlzLnJvd1Jlc2l6ZXIgPSBuZXcgUmVzaXplcihmYWxzZSwgZGF0YS5yb3dzLmhlaWdodCk7CiAgICB0aGlzLmNvbFJlc2l6ZXIgPSBuZXcgUmVzaXplcih0cnVlLCBkYXRhLmNvbHMubWluV2lkdGgpOyAvLyBzY3JvbGxiYXIKCiAgICB0aGlzLnZlcnRpY2FsU2Nyb2xsYmFyID0gbmV3IFNjcm9sbGJhcih0cnVlKTsKICAgIHRoaXMuaG9yaXpvbnRhbFNjcm9sbGJhciA9IG5ldyBTY3JvbGxiYXIoZmFsc2UpOyAvLyBlZGl0b3IKCiAgICB0aGlzLmVkaXRvciA9IG5ldyBFZGl0b3IoZm9ybXVsYXMsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzNi5nZXRUYWJsZU9mZnNldCgpOwogICAgfSwgZGF0YS5yb3dzLmhlaWdodCk7IC8vIGRhdGEgdmFsaWRhdGlvbgoKICAgIHRoaXMubW9kYWxWYWxpZGF0aW9uID0gbmV3IE1vZGFsVmFsaWRhdGlvbigpOyAvLyBjb250ZXh0TWVudQoKICAgIHRoaXMuY29udGV4dE1lbnUgPSBuZXcgQ29udGV4dE1lbnUoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXM2LmdldFJlY3QoKTsKICAgIH0sICFzaG93Q29udGV4dG1lbnUpOyAvLyBzZWxlY3RvcgoKICAgIHRoaXMuc2VsZWN0b3IgPSBuZXcgU2VsZWN0b3IoZGF0YSk7CiAgICB0aGlzLm92ZXJsYXllckNFbCA9IGgoJ2RpdicsICIiLmNvbmNhdChjc3NQcmVmaXgsICItb3ZlcmxheWVyLWNvbnRlbnQiKSkuY2hpbGRyZW4odGhpcy5lZGl0b3IuZWwsIHRoaXMuc2VsZWN0b3IuZWwpOwogICAgdGhpcy5vdmVybGF5ZXJFbCA9IGgoJ2RpdicsICIiLmNvbmNhdChjc3NQcmVmaXgsICItb3ZlcmxheWVyIikpLmNoaWxkKHRoaXMub3ZlcmxheWVyQ0VsKTsgLy8gc29ydEZpbHRlcgoKICAgIHRoaXMuc29ydEZpbHRlciA9IG5ldyBTb3J0RmlsdGVyKCk7IC8vIHJvb3QgZWxlbWVudAoKICAgIHRoaXMuZWwuY2hpbGRyZW4odGhpcy50YWJsZUVsLCB0aGlzLm92ZXJsYXllckVsLmVsLCB0aGlzLnJvd1Jlc2l6ZXIuZWwsIHRoaXMuY29sUmVzaXplci5lbCwgdGhpcy52ZXJ0aWNhbFNjcm9sbGJhci5lbCwgdGhpcy5ob3Jpem9udGFsU2Nyb2xsYmFyLmVsLCB0aGlzLmNvbnRleHRNZW51LmVsLCB0aGlzLm1vZGFsVmFsaWRhdGlvbi5lbCwgdGhpcy5zb3J0RmlsdGVyLmVsKTsgLy8gdGFibGUKCiAgICB0aGlzLnRhYmxlID0gbmV3IFRhYmxlKHRoaXMudGFibGVFbC5lbCwgZGF0YSk7CiAgICBzaGVldEluaXRFdmVudHMuY2FsbCh0aGlzKTsKICAgIHNoZWV0UmVzZXQuY2FsbCh0aGlzKTsgLy8gaW5pdCBzZWxlY3RvciBbMCwgMF0KCiAgICBzZWxlY3RvclNldC5jYWxsKHRoaXMsIGZhbHNlLCAwLCAwKTsKICB9CgogIF9jcmVhdGVDbGFzcyhTaGVldCwgW3sKICAgIGtleTogIm9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbihldmVudE5hbWUsIGZ1bmMpIHsKICAgICAgdGhpcy5ldmVudE1hcC5zZXQoZXZlbnROYW1lLCBmdW5jKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAidHJpZ2dlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdHJpZ2dlcihldmVudE5hbWUpIHsKICAgICAgdmFyIGV2ZW50TWFwID0gdGhpcy5ldmVudE1hcDsKCiAgICAgIGlmIChldmVudE1hcC5oYXMoZXZlbnROYW1lKSkgewogICAgICAgIHZhciBfZXZlbnRNYXAkZ2V0OwoKICAgICAgICBmb3IgKHZhciBfbGVuMyA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbjMgPiAxID8gX2xlbjMgLSAxIDogMCksIF9rZXkzID0gMTsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykgewogICAgICAgICAgYXJnc1tfa2V5MyAtIDFdID0gYXJndW1lbnRzW19rZXkzXTsKICAgICAgICB9CgogICAgICAgIChfZXZlbnRNYXAkZ2V0ID0gZXZlbnRNYXAuZ2V0KGV2ZW50TmFtZSkpLmNhbGwuYXBwbHkoX2V2ZW50TWFwJGdldCwgW3RoaXNdLmNvbmNhdChhcmdzKSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNldERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0RGF0YShkYXRhKSB7CiAgICAgIC8vIGJlZm9yZQogICAgICB0aGlzLmVkaXRvci5jbGVhcigpOyAvLyBhZnRlcgoKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdmVydGljYWxTY3JvbGxiYXJTZXQuY2FsbCh0aGlzKTsKICAgICAgaG9yaXpvbnRhbFNjcm9sbGJhclNldC5jYWxsKHRoaXMpOwogICAgICB0aGlzLnRvb2xiYXIucmVzZXREYXRhKGRhdGEpOwogICAgICB0aGlzLnByaW50LnJlc2V0RGF0YShkYXRhKTsKICAgICAgdGhpcy5zZWxlY3Rvci5yZXNldERhdGEoZGF0YSk7CiAgICAgIHRoaXMudGFibGUucmVzZXREYXRhKGRhdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogImxvYWREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkRGF0YShkYXRhKSB7CiAgICAgIHRoaXMuZGF0YS5zZXREYXRhKGRhdGEpOwogICAgICBzaGVldFJlc2V0LmNhbGwodGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSAvLyBmcmVlemUgcm93cyBvciBjb2xzCgogIH0sIHsKICAgIGtleTogImZyZWV6ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZnJlZXplKHJpLCBjaSkgewogICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgZGF0YS5zZXRGcmVlemUocmksIGNpKTsKICAgICAgc2hlZXRSZXNldC5jYWxsKHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1bmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1bmRvKCkgewogICAgICB0aGlzLmRhdGEudW5kbygpOwogICAgICBzaGVldFJlc2V0LmNhbGwodGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVkbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVkbygpIHsKICAgICAgdGhpcy5kYXRhLnJlZG8oKTsKICAgICAgc2hlZXRSZXNldC5jYWxsKHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsb2FkKCkgewogICAgICBzaGVldFJlc2V0LmNhbGwodGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFJlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJlY3QoKSB7CiAgICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgICByZXR1cm4gewogICAgICAgIHdpZHRoOiBkYXRhLnZpZXdXaWR0aCgpLAogICAgICAgIGhlaWdodDogZGF0YS52aWV3SGVpZ2h0KCkKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRUYWJsZU9mZnNldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VGFibGVPZmZzZXQoKSB7CiAgICAgIHZhciBfdGhpcyRkYXRhID0gdGhpcy5kYXRhLAogICAgICAgICAgcm93cyA9IF90aGlzJGRhdGEucm93cywKICAgICAgICAgIGNvbHMgPSBfdGhpcyRkYXRhLmNvbHM7CgogICAgICB2YXIgX3RoaXMkZ2V0UmVjdCA9IHRoaXMuZ2V0UmVjdCgpLAogICAgICAgICAgd2lkdGggPSBfdGhpcyRnZXRSZWN0LndpZHRoLAogICAgICAgICAgaGVpZ2h0ID0gX3RoaXMkZ2V0UmVjdC5oZWlnaHQ7CgogICAgICByZXR1cm4gewogICAgICAgIHdpZHRoOiB3aWR0aCAtIGNvbHMuaW5kZXhXaWR0aCwKICAgICAgICBoZWlnaHQ6IGhlaWdodCAtIHJvd3MuaGVpZ2h0LAogICAgICAgIGxlZnQ6IGNvbHMuaW5kZXhXaWR0aCwKICAgICAgICB0b3A6IHJvd3MuaGVpZ2h0CiAgICAgIH07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU2hlZXQ7Cn0oKTsKCmV4cG9ydCB7IFNoZWV0IGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["D:/代码/del_demo/VisualizationExcle_Demo/src/components/x-spreadsheet/component/sheet.js"],"names":["h","bind","mouseMoveUp","bindTouch","Resizer","Scrollbar","Selector","Editor","Print","ContextMenu","Table","Toolbar","ModalValidation","SortFilter","xtoast","cssPrefix","formulas","throttle","func","wait","timeout","that","arg","args","setTimeout","apply","scrollbarMove","data","verticalScrollbar","horizontalScrollbar","getSelectedRect","l","t","left","top","width","height","tableOffset","getTableOffset","Math","abs","move","fsw","freezeTotalWidth","fsh","freezeTotalHeight","selectorSet","multiple","ri","ci","indexesUpdated","moving","table","selector","toolbar","contextMenu","setMode","cell","getCell","setEnd","trigger","range","set","reset","render","selectorMove","direction","rows","cols","indexes","eri","eci","moveIndexes","len","call","overlayerMousemove","evt","buttons","target","className","offsetX","offsetY","rowResizer","colResizer","tableEl","indexWidth","hide","tRect","box","cRect","getCellRectByXY","show","isHide","showUnhide","hideUnhide","overlayerMousescroll","scroll","deltaY","deltaX","loopValue","ii","vFunc","i","v","moveY","vertical","rh","getHeight","moveX","horizontal","cw","getWidth","tempY","tempX","temp","max","test","window","navigator","userAgent","detail","overlayerTouch","distance","verticalScrollbarSet","erth","exceptRowTotalHeight","totalHeight","horizontalScrollbarSet","totalWidth","sheetFreeze","editor","freeze","fwidth","fheight","setFreezeLengths","resetAreaOffset","sheetReset","overlayerEl","overlayerCEl","el","tOffset","vRect","getRect","attr","offset","css","clearClipboard","hideClipboard","copy","showClipboard","cut","paste","what","settings","mode","msg","cdata","clipboardData","getData","pasteFromText","hideRowsOrCols","unhideRowsOrCols","type","index","autofilter","toolbarChangePaintformatPaste","paintformatActive","paintformatToggle","overlayerMousedown","sortFilter","isAutofillEl","cellRect","autoFilter","includes","items","r","c","getFilter","getSort","setOffset","shiftKey","showAutofill","e","arange","autofill","hideAutofill","editorSetOffset","sOffset","sPosition","editorSet","setCell","getSelectedCell","getSelectedValidator","verticalScrollbarMove","scrolly","resetBRLAreaOffset","horizontalScrollbarMove","scrollx","resetBRTAreaOffset","rowResizerFinished","setHeight","colResizerFinished","setWidth","dataSetCellText","text","state","setSelectedCellText","insertDeleteRowColumn","insert","delete","deleteCell","setSelectedCellAttr","toolbarChange","value","undo","redo","print","preview","sortFilterChange","order","operator","setAutoFilter","sheetInitEvents","modalValidation","on","clear","xyInSelectedRect","setPosition","stopPropagation","inputChange","d","change","ok","o","finishedFn","unhideFn","moveFn","itext","action","addValidation","removeValidation","itemClick","setValue","getSelectedValidation","reload","focusing","contains","preventDefault","keyCode","which","key","ctrlKey","metaKey","Sheet","targetEl","eventMap","Map","view","showToolbar","showContextmenu","children","minWidth","child","eventName","has","get","resetData","setData","setFreeze","viewWidth","viewHeight"],"mappings":"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","sourcesContent":["import {\r\n  h\r\n} from './element';\r\nimport {\r\n  bind,\r\n  mouseMoveUp,\r\n  bindTouch\r\n} from './event';\r\nimport Resizer from './resizer';\r\nimport Scrollbar from './scrollbar';\r\nimport Selector from './selector';\r\nimport Editor from './editor';\r\nimport Print from './print';\r\nimport ContextMenu from './contextmenu';\r\nimport Table from './table';\r\nimport Toolbar from './toolbar/index';\r\nimport ModalValidation from './modal_validation';\r\nimport SortFilter from './sort_filter';\r\nimport {\r\n  xtoast\r\n} from './message';\r\nimport {\r\n  cssPrefix\r\n} from '../config';\r\nimport {\r\n  formulas\r\n} from '../core/formula';\r\n\r\n/**\r\n * @desc throttle fn\r\n * @param func function\r\n * @param wait Delay in milliseconds\r\n */\r\nfunction throttle(func, wait) {\r\n  let timeout;\r\n  return (...arg) => {\r\n    const that = this;\r\n    const args = arg;\r\n    if (!timeout) {\r\n      timeout = setTimeout(() => {\r\n        timeout = null;\r\n        func.apply(that, args);\r\n      }, wait);\r\n    }\r\n  };\r\n}\r\n\r\nfunction scrollbarMove() {\r\n  const {\r\n    data,\r\n    verticalScrollbar,\r\n    horizontalScrollbar,\r\n  } = this;\r\n  const {\r\n    l,\r\n    t,\r\n    left,\r\n    top,\r\n    width,\r\n    height,\r\n  } = data.getSelectedRect();\r\n  const tableOffset = this.getTableOffset();\r\n  // console.log(',l:', l, ', left:', left, ', tOffset.left:', tableOffset.width);\r\n  if (Math.abs(left) + width > tableOffset.width) {\r\n    horizontalScrollbar.move({\r\n      left: l + width - tableOffset.width\r\n    });\r\n  } else {\r\n    const fsw = data.freezeTotalWidth();\r\n    if (left < fsw) {\r\n      horizontalScrollbar.move({\r\n        left: l - 1 - fsw\r\n      });\r\n    }\r\n  }\r\n  // console.log('top:', top, ', height:', height, ', tof.height:', tableOffset.height);\r\n  if (Math.abs(top) + height > tableOffset.height) {\r\n    verticalScrollbar.move({\r\n      top: t + height - tableOffset.height - 1\r\n    });\r\n  } else {\r\n    const fsh = data.freezeTotalHeight();\r\n    if (top < fsh) {\r\n      verticalScrollbar.move({\r\n        top: t - 1 - fsh\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction selectorSet(multiple, ri, ci, indexesUpdated = true, moving = false) {\r\n  if (ri === -1 && ci === -1) return;\r\n  const {\r\n    table,\r\n    selector,\r\n    toolbar,\r\n    data,\r\n    contextMenu,\r\n  } = this;\r\n  contextMenu.setMode((ri === -1 || ci === -1) ? 'row-col' : 'range');\r\n  const cell = data.getCell(ri, ci);\r\n  if (multiple) {\r\n    selector.setEnd(ri, ci, moving);\r\n    this.trigger('cells-selected', cell, selector.range);\r\n  } else {\r\n    // trigger click event\r\n    selector.set(ri, ci, indexesUpdated);\r\n    this.trigger('cell-selected', cell, ri, ci);\r\n  }\r\n  toolbar.reset();\r\n  table.render();\r\n}\r\n\r\n// multiple: boolean\r\n// direction: left | right | up | down | row-first | row-last | col-first | col-last\r\nfunction selectorMove(multiple, direction) {\r\n  const {\r\n    selector,\r\n    data,\r\n  } = this;\r\n  const {\r\n    rows,\r\n    cols\r\n  } = data;\r\n  let [ri, ci] = selector.indexes;\r\n  const {\r\n    eri,\r\n    eci\r\n  } = selector.range;\r\n  if (multiple) {\r\n    [ri, ci] = selector.moveIndexes;\r\n  }\r\n  // console.log('selector.move:', ri, ci);\r\n  if (direction === 'left') {\r\n    if (ci > 0) ci -= 1;\r\n  } else if (direction === 'right') {\r\n    if (eci !== ci) ci = eci;\r\n    if (ci < cols.len - 1) ci += 1;\r\n  } else if (direction === 'up') {\r\n    if (ri > 0) ri -= 1;\r\n  } else if (direction === 'down') {\r\n    if (eri !== ri) ri = eri;\r\n    if (ri < rows.len - 1) ri += 1;\r\n  } else if (direction === 'row-first') {\r\n    ci = 0;\r\n  } else if (direction === 'row-last') {\r\n    ci = cols.len - 1;\r\n  } else if (direction === 'col-first') {\r\n    ri = 0;\r\n  } else if (direction === 'col-last') {\r\n    ri = rows.len - 1;\r\n  }\r\n  if (multiple) {\r\n    selector.moveIndexes = [ri, ci];\r\n  }\r\n  selectorSet.call(this, multiple, ri, ci);\r\n  scrollbarMove.call(this);\r\n}\r\n\r\n// private methods\r\nfunction overlayerMousemove(evt) {\r\n  // console.log('x:', evt.offsetX, ', y:', evt.offsetY);\r\n  if (evt.buttons !== 0) return;\r\n  if (evt.target.className === `${cssPrefix}-resizer-hover`) return;\r\n  const {\r\n    offsetX,\r\n    offsetY\r\n  } = evt;\r\n  const {\r\n    rowResizer,\r\n    colResizer,\r\n    tableEl,\r\n    data,\r\n  } = this;\r\n  const {\r\n    rows,\r\n    cols\r\n  } = data;\r\n  if (offsetX > cols.indexWidth && offsetY > rows.height) {\r\n    rowResizer.hide();\r\n    colResizer.hide();\r\n    return;\r\n  }\r\n  const tRect = tableEl.box();\r\n  const cRect = data.getCellRectByXY(evt.offsetX, evt.offsetY);\r\n  if (cRect.ri >= 0 && cRect.ci === -1) {\r\n    cRect.width = cols.indexWidth;\r\n    rowResizer.show(cRect, {\r\n      width: tRect.width,\r\n    });\r\n    if (rows.isHide(cRect.ri - 1)) {\r\n      rowResizer.showUnhide(cRect.ri);\r\n    } else {\r\n      rowResizer.hideUnhide();\r\n    }\r\n  } else {\r\n    rowResizer.hide();\r\n  }\r\n  if (cRect.ri === -1 && cRect.ci >= 0) {\r\n    cRect.height = rows.height;\r\n    colResizer.show(cRect, {\r\n      height: tRect.height,\r\n    });\r\n    if (cols.isHide(cRect.ci - 1)) {\r\n      colResizer.showUnhide(cRect.ci);\r\n    } else {\r\n      colResizer.hideUnhide();\r\n    }\r\n  } else {\r\n    colResizer.hide();\r\n  }\r\n}\r\n\r\n// let scrollThreshold = 15;\r\nfunction overlayerMousescroll(evt) {\r\n  // scrollThreshold -= 1;\r\n  // if (scrollThreshold > 0) return;\r\n  // scrollThreshold = 15;\r\n\r\n  const {\r\n    verticalScrollbar,\r\n    horizontalScrollbar,\r\n    data\r\n  } = this;\r\n  const {\r\n    top\r\n  } = verticalScrollbar.scroll();\r\n  const {\r\n    left\r\n  } = horizontalScrollbar.scroll();\r\n  // console.log('evt:::', evt.wheelDelta, evt.detail * 40);\r\n\r\n  const {\r\n    rows,\r\n    cols\r\n  } = data;\r\n\r\n  // deltaY for vertical delta\r\n  const {\r\n    deltaY,\r\n    deltaX\r\n  } = evt;\r\n  const loopValue = (ii, vFunc) => {\r\n    let i = ii;\r\n    let v = 0;\r\n    do {\r\n      v = vFunc(i);\r\n      i += 1;\r\n    } while (v <= 0);\r\n    return v;\r\n  };\r\n  // console.log('deltaX', deltaX, 'evt.detail', evt.detail);\r\n  // if (evt.detail) deltaY = evt.detail * 40;\r\n  const moveY = (vertical) => {\r\n    if (vertical > 0) {\r\n      // up\r\n      const ri = data.scroll.ri + 1;\r\n      if (ri < rows.len) {\r\n        const rh = loopValue(ri, i => rows.getHeight(i));\r\n        verticalScrollbar.move({\r\n          top: top + rh - 1\r\n        });\r\n      }\r\n    } else {\r\n      // down\r\n      const ri = data.scroll.ri - 1;\r\n      if (ri >= 0) {\r\n        const rh = loopValue(ri, i => rows.getHeight(i));\r\n        verticalScrollbar.move({\r\n          top: ri === 0 ? 0 : top - rh\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  // deltaX for Mac horizontal scroll\r\n  const moveX = (horizontal) => {\r\n    if (horizontal > 0) {\r\n      // left\r\n      const ci = data.scroll.ci + 1;\r\n      if (ci < cols.len) {\r\n        const cw = loopValue(ci, i => cols.getWidth(i));\r\n        horizontalScrollbar.move({\r\n          left: left + cw - 1\r\n        });\r\n      }\r\n    } else {\r\n      // right\r\n      const ci = data.scroll.ci - 1;\r\n      if (ci >= 0) {\r\n        const cw = loopValue(ci, i => cols.getWidth(i));\r\n        horizontalScrollbar.move({\r\n          left: ci === 0 ? 0 : left - cw\r\n        });\r\n      }\r\n    }\r\n  };\r\n  const tempY = Math.abs(deltaY);\r\n  const tempX = Math.abs(deltaX);\r\n  const temp = Math.max(tempY, tempX);\r\n  // console.log('event:', evt);\r\n  // detail for windows/mac firefox vertical scroll\r\n  if (/Firefox/i.test(window.navigator.userAgent)) throttle(moveY(evt.detail), 50);\r\n  if (temp === tempX) throttle(moveX(deltaX), 50);\r\n  if (temp === tempY) throttle(moveY(deltaY), 50);\r\n}\r\n\r\nfunction overlayerTouch(direction, distance) {\r\n  const {\r\n    verticalScrollbar,\r\n    horizontalScrollbar\r\n  } = this;\r\n  const {\r\n    top\r\n  } = verticalScrollbar.scroll();\r\n  const {\r\n    left\r\n  } = horizontalScrollbar.scroll();\r\n\r\n  if (direction === 'left' || direction === 'right') {\r\n    horizontalScrollbar.move({\r\n      left: left - distance\r\n    });\r\n  } else if (direction === 'up' || direction === 'down') {\r\n    verticalScrollbar.move({\r\n      top: top - distance\r\n    });\r\n  }\r\n}\r\n\r\nfunction verticalScrollbarSet() {\r\n  const {\r\n    data,\r\n    verticalScrollbar\r\n  } = this;\r\n  const {\r\n    height\r\n  } = this.getTableOffset();\r\n  const erth = data.exceptRowTotalHeight(0, -1);\r\n  // console.log('erth:', erth);\r\n  verticalScrollbar.set(height, data.rows.totalHeight() - erth);\r\n}\r\n\r\nfunction horizontalScrollbarSet() {\r\n  const {\r\n    data,\r\n    horizontalScrollbar\r\n  } = this;\r\n  const {\r\n    width\r\n  } = this.getTableOffset();\r\n  if (data) {\r\n    horizontalScrollbar.set(width, data.cols.totalWidth());\r\n  }\r\n}\r\n\r\nfunction sheetFreeze() {\r\n  const {\r\n    selector,\r\n    data,\r\n    editor,\r\n  } = this;\r\n  const [ri, ci] = data.freeze;\r\n  if (ri > 0 || ci > 0) {\r\n    const fwidth = data.freezeTotalWidth();\r\n    const fheight = data.freezeTotalHeight();\r\n    editor.setFreezeLengths(fwidth, fheight);\r\n  }\r\n  selector.resetAreaOffset();\r\n}\r\n\r\nfunction sheetReset() {\r\n  const {\r\n    tableEl,\r\n    overlayerEl,\r\n    overlayerCEl,\r\n    table,\r\n    toolbar,\r\n    selector,\r\n    el,\r\n  } = this;\r\n  const tOffset = this.getTableOffset();\r\n  const vRect = this.getRect();\r\n  tableEl.attr(vRect);\r\n  overlayerEl.offset(vRect);\r\n  overlayerCEl.offset(tOffset);\r\n  el.css('width', `${vRect.width}px`);\r\n  verticalScrollbarSet.call(this);\r\n  horizontalScrollbarSet.call(this);\r\n  sheetFreeze.call(this);\r\n  table.render();\r\n  toolbar.reset();\r\n  selector.reset();\r\n}\r\n\r\nfunction clearClipboard() {\r\n  const {\r\n    data,\r\n    selector\r\n  } = this;\r\n  data.clearClipboard();\r\n  selector.hideClipboard();\r\n}\r\n\r\nfunction copy() {\r\n  const {\r\n    data,\r\n    selector\r\n  } = this;\r\n  data.copy();\r\n  selector.showClipboard();\r\n}\r\n\r\nfunction cut() {\r\n  const {\r\n    data,\r\n    selector\r\n  } = this;\r\n  data.cut();\r\n  selector.showClipboard();\r\n}\r\n\r\nfunction paste(what, evt) {\r\n  const {\r\n    data\r\n  } = this;\r\n  if (data.settings.mode === 'read') return;\r\n  if (data.paste(what, msg => xtoast('Tip', msg))) {\r\n    sheetReset.call(this);\r\n  } else if (evt) {\r\n    const cdata = evt.clipboardData.getData('text/plain');\r\n    this.data.pasteFromText(cdata);\r\n    sheetReset.call(this);\r\n  }\r\n}\r\n\r\nfunction hideRowsOrCols() {\r\n  this.data.hideRowsOrCols();\r\n  sheetReset.call(this);\r\n}\r\n\r\nfunction unhideRowsOrCols(type, index) {\r\n  this.data.unhideRowsOrCols(type, index);\r\n  sheetReset.call(this);\r\n}\r\n\r\nfunction autofilter() {\r\n  const {\r\n    data\r\n  } = this;\r\n  data.autofilter();\r\n  sheetReset.call(this);\r\n}\r\n\r\nfunction toolbarChangePaintformatPaste() {\r\n  const {\r\n    toolbar\r\n  } = this;\r\n  if (toolbar.paintformatActive()) {\r\n    paste.call(this, 'format');\r\n    clearClipboard.call(this);\r\n    toolbar.paintformatToggle();\r\n  }\r\n}\r\n\r\nfunction overlayerMousedown(evt) {\r\n  // console.log(':::::overlayer.mousedown:', evt.detail, evt.button, evt.buttons, evt.shiftKey);\r\n  // console.log('evt.target.className:', evt.target.className);\r\n  const {\r\n    selector,\r\n    data,\r\n    table,\r\n    sortFilter,\r\n  } = this;\r\n  const {\r\n    offsetX,\r\n    offsetY\r\n  } = evt;\r\n  const isAutofillEl = evt.target.className === `${cssPrefix}-selector-corner`;\r\n  const cellRect = data.getCellRectByXY(offsetX, offsetY);\r\n  const {\r\n    left,\r\n    top,\r\n    width,\r\n    height,\r\n  } = cellRect;\r\n  let {\r\n    ri,\r\n    ci\r\n  } = cellRect;\r\n  // sort or filter\r\n  const {\r\n    autoFilter\r\n  } = data;\r\n  if (autoFilter.includes(ri, ci)) {\r\n    if (left + width - 20 < offsetX && top + height - 20 < offsetY) {\r\n      const items = autoFilter.items(ci, (r, c) => data.rows.getCell(r, c));\r\n      sortFilter.hide();\r\n      sortFilter.set(ci, items, autoFilter.getFilter(ci), autoFilter.getSort(ci));\r\n      sortFilter.setOffset({\r\n        left,\r\n        top: top + height + 2\r\n      });\r\n      return;\r\n    }\r\n  }\r\n\r\n  // console.log('ri:', ri, ', ci:', ci);\r\n  if (!evt.shiftKey) {\r\n    // console.log('selectorSetStart:::');\r\n    if (isAutofillEl) {\r\n      selector.showAutofill(ri, ci);\r\n    } else {\r\n      selectorSet.call(this, false, ri, ci);\r\n    }\r\n\r\n    // mouse move up\r\n    mouseMoveUp(window, (e) => {\r\n      // console.log('mouseMoveUp::::');\r\n      ({\r\n        ri,\r\n        ci\r\n      } = data.getCellRectByXY(e.offsetX, e.offsetY));\r\n      if (isAutofillEl) {\r\n        selector.showAutofill(ri, ci);\r\n      } else if (e.buttons === 1 && !e.shiftKey) {\r\n        selectorSet.call(this, true, ri, ci, true, true);\r\n      }\r\n    }, () => {\r\n      if (isAutofillEl && selector.arange && data.settings.mode !== 'read') {\r\n        if (data.autofill(selector.arange, 'all', msg => xtoast('Tip', msg))) {\r\n          table.render();\r\n        }\r\n      }\r\n      selector.hideAutofill();\r\n      toolbarChangePaintformatPaste.call(this);\r\n    });\r\n  }\r\n\r\n  if (!isAutofillEl && evt.buttons === 1) {\r\n    if (evt.shiftKey) {\r\n      // console.log('shiftKey::::');\r\n      selectorSet.call(this, true, ri, ci);\r\n    }\r\n  }\r\n}\r\n\r\nfunction editorSetOffset() {\r\n  const {\r\n    editor,\r\n    data\r\n  } = this;\r\n  const sOffset = data.getSelectedRect();\r\n  const tOffset = this.getTableOffset();\r\n  let sPosition = 'top';\r\n  // console.log('sOffset:', sOffset, ':', tOffset);\r\n  if (sOffset.top > tOffset.height / 2) {\r\n    sPosition = 'bottom';\r\n  }\r\n  editor.setOffset(sOffset, sPosition);\r\n}\r\n\r\nfunction editorSet() {\r\n  const {\r\n    editor,\r\n    data\r\n  } = this;\r\n  if (data.settings.mode === 'read') return;\r\n  editorSetOffset.call(this);\r\n  editor.setCell(data.getSelectedCell(), data.getSelectedValidator());\r\n  clearClipboard.call(this);\r\n}\r\n\r\nfunction verticalScrollbarMove(distance) {\r\n  const {\r\n    data,\r\n    table,\r\n    selector\r\n  } = this;\r\n  data.scrolly(distance, () => {\r\n    selector.resetBRLAreaOffset();\r\n    editorSetOffset.call(this);\r\n    table.render();\r\n  });\r\n}\r\n\r\nfunction horizontalScrollbarMove(distance) {\r\n  const {\r\n    data,\r\n    table,\r\n    selector\r\n  } = this;\r\n  data.scrollx(distance, () => {\r\n    selector.resetBRTAreaOffset();\r\n    editorSetOffset.call(this);\r\n    table.render();\r\n  });\r\n}\r\n\r\nfunction rowResizerFinished(cRect, distance) {\r\n  const {\r\n    ri\r\n  } = cRect;\r\n  const {\r\n    table,\r\n    selector,\r\n    data\r\n  } = this;\r\n  data.rows.setHeight(ri, distance);\r\n  table.render();\r\n  selector.resetAreaOffset();\r\n  verticalScrollbarSet.call(this);\r\n  editorSetOffset.call(this);\r\n}\r\n\r\nfunction colResizerFinished(cRect, distance) {\r\n  const {\r\n    ci\r\n  } = cRect;\r\n  const {\r\n    table,\r\n    selector,\r\n    data\r\n  } = this;\r\n  data.cols.setWidth(ci, distance);\r\n  // console.log('data:', data);\r\n  table.render();\r\n  selector.resetAreaOffset();\r\n  horizontalScrollbarSet.call(this);\r\n  editorSetOffset.call(this);\r\n}\r\n\r\nfunction dataSetCellText(text, state = 'finished') {\r\n  const {\r\n    data,\r\n    table\r\n  } = this;\r\n  // const [ri, ci] = selector.indexes;\r\n  if (data.settings.mode === 'read') return;\r\n  data.setSelectedCellText(text, state);\r\n  const {\r\n    ri,\r\n    ci\r\n  } = data.selector;\r\n  if (state === 'finished') {\r\n    table.render();\r\n  } else {\r\n    this.trigger('cell-edited', text, ri, ci);\r\n  }\r\n}\r\n\r\nfunction insertDeleteRowColumn(type) {\r\n  const {\r\n    data\r\n  } = this;\r\n  if (data.settings.mode === 'read') return;\r\n  if (type === 'insert-row') {\r\n    data.insert('row');\r\n  } else if (type === 'delete-row') {\r\n    data.delete('row');\r\n  } else if (type === 'insert-column') {\r\n    data.insert('column');\r\n  } else if (type === 'delete-column') {\r\n    data.delete('column');\r\n  } else if (type === 'delete-cell') {\r\n    data.deleteCell();\r\n  } else if (type === 'delete-cell-format') {\r\n    data.deleteCell('format');\r\n  } else if (type === 'delete-cell-text') {\r\n    data.deleteCell('text');\r\n  } else if (type === 'cell-printable') {\r\n    data.setSelectedCellAttr('printable', true);\r\n  } else if (type === 'cell-non-printable') {\r\n    data.setSelectedCellAttr('printable', false);\r\n  } else if (type === 'cell-editable') {\r\n    data.setSelectedCellAttr('editable', true);\r\n  } else if (type === 'cell-non-editable') {\r\n    data.setSelectedCellAttr('editable', false);\r\n  }\r\n  clearClipboard.call(this);\r\n  sheetReset.call(this);\r\n}\r\n\r\nfunction toolbarChange(type, value) {\r\n  const {\r\n    data\r\n  } = this;\r\n  if (type === 'undo') {\r\n    this.undo();\r\n  } else if (type === 'redo') {\r\n    this.redo();\r\n  } else if (type === 'print') {\r\n    this.print.preview();\r\n  } else if (type === 'paintformat') {\r\n    if (value === true) copy.call(this);\r\n    else clearClipboard.call(this);\r\n  } else if (type === 'clearformat') {\r\n    insertDeleteRowColumn.call(this, 'delete-cell-format');\r\n  } else if (type === 'link') {\r\n    // link\r\n  } else if (type === 'chart') {\r\n    // chart\r\n  } else if (type === 'autofilter') {\r\n    // filter\r\n    autofilter.call(this);\r\n  } else if (type === 'freeze') {\r\n    if (value) {\r\n      const {\r\n        ri,\r\n        ci\r\n      } = data.selector;\r\n      this.freeze(ri, ci);\r\n    } else {\r\n      this.freeze(0, 0);\r\n    }\r\n  } else {\r\n    data.setSelectedCellAttr(type, value);\r\n    if (type === 'formula' && !data.selector.multiple()) {\r\n      editorSet.call(this);\r\n    }\r\n    sheetReset.call(this);\r\n  }\r\n}\r\n\r\nfunction sortFilterChange(ci, order, operator, value) {\r\n  // console.log('sort:', sortDesc, operator, value);\r\n  this.data.setAutoFilter(ci, order, operator, value);\r\n  sheetReset.call(this);\r\n}\r\n\r\nfunction sheetInitEvents() {\r\n  const {\r\n    selector,\r\n    overlayerEl,\r\n    rowResizer,\r\n    colResizer,\r\n    verticalScrollbar,\r\n    horizontalScrollbar,\r\n    editor,\r\n    contextMenu,\r\n    toolbar,\r\n    modalValidation,\r\n    sortFilter,\r\n  } = this;\r\n  // overlayer\r\n  overlayerEl\r\n    .on('mousemove', (evt) => {\r\n      overlayerMousemove.call(this, evt);\r\n    })\r\n    .on('mousedown', (evt) => {\r\n      editor.clear();\r\n      contextMenu.hide();\r\n      // the left mouse button: mousedown → mouseup → click\r\n      // the right mouse button: mousedown → contenxtmenu → mouseup\r\n      if (evt.buttons === 2) {\r\n        if (this.data.xyInSelectedRect(evt.offsetX, evt.offsetY)) {\r\n          contextMenu.setPosition(evt.offsetX, evt.offsetY);\r\n        } else {\r\n          overlayerMousedown.call(this, evt);\r\n          contextMenu.setPosition(evt.offsetX, evt.offsetY);\r\n        }\r\n        evt.stopPropagation();\r\n      } else if (evt.detail === 2) {\r\n        editorSet.call(this);\r\n      } else {\r\n        overlayerMousedown.call(this, evt);\r\n      }\r\n    })\r\n    .on('mousewheel.stop', (evt) => {\r\n      overlayerMousescroll.call(this, evt);\r\n    })\r\n    .on('mouseout', (evt) => {\r\n      const {\r\n        offsetX,\r\n        offsetY\r\n      } = evt;\r\n      if (offsetY <= 0) colResizer.hide();\r\n      if (offsetX <= 0) rowResizer.hide();\r\n    });\r\n\r\n  selector.inputChange = (v) => {\r\n    dataSetCellText.call(this, v, 'input');\r\n    editorSet.call(this);\r\n  };\r\n\r\n  // slide on mobile\r\n  bindTouch(overlayerEl.el, {\r\n    move: (direction, d) => {\r\n      overlayerTouch.call(this, direction, d);\r\n    },\r\n  });\r\n\r\n  // toolbar change\r\n  toolbar.change = (type, value) => toolbarChange.call(this, type, value);\r\n\r\n  // sort filter ok\r\n  sortFilter.ok = (ci, order, o, v) => sortFilterChange.call(this, ci, order, o, v);\r\n\r\n  // resizer finished callback\r\n  rowResizer.finishedFn = (cRect, distance) => {\r\n    rowResizerFinished.call(this, cRect, distance);\r\n  };\r\n  colResizer.finishedFn = (cRect, distance) => {\r\n    colResizerFinished.call(this, cRect, distance);\r\n  };\r\n  // resizer unhide callback\r\n  rowResizer.unhideFn = (index) => {\r\n    unhideRowsOrCols.call(this, 'row', index);\r\n  };\r\n  colResizer.unhideFn = (index) => {\r\n    unhideRowsOrCols.call(this, 'col', index);\r\n  };\r\n  // scrollbar move callback\r\n  verticalScrollbar.moveFn = (distance, evt) => {\r\n    verticalScrollbarMove.call(this, distance, evt);\r\n  };\r\n  horizontalScrollbar.moveFn = (distance, evt) => {\r\n    horizontalScrollbarMove.call(this, distance, evt);\r\n  };\r\n  // editor\r\n  editor.change = (state, itext) => {\r\n    dataSetCellText.call(this, itext, state);\r\n  };\r\n  // modal validation\r\n  modalValidation.change = (action, ...args) => {\r\n    if (action === 'save') {\r\n      this.data.addValidation(...args);\r\n    } else {\r\n      this.data.removeValidation();\r\n    }\r\n  };\r\n  // contextmenu\r\n  contextMenu.itemClick = (type) => {\r\n    // console.log('type:', type);\r\n    if (type === 'validation') {\r\n      modalValidation.setValue(this.data.getSelectedValidation());\r\n    } else if (type === 'copy') {\r\n      copy.call(this);\r\n    } else if (type === 'cut') {\r\n      cut.call(this);\r\n    } else if (type === 'paste') {\r\n      paste.call(this, 'all');\r\n    } else if (type === 'paste-value') {\r\n      paste.call(this, 'text');\r\n    } else if (type === 'paste-format') {\r\n      paste.call(this, 'format');\r\n    } else if (type === 'hide') {\r\n      hideRowsOrCols.call(this);\r\n    } else {\r\n      insertDeleteRowColumn.call(this, type);\r\n    }\r\n  };\r\n\r\n  bind(window, 'resize', () => {\r\n    this.reload();\r\n  });\r\n\r\n  bind(window, 'click', (evt) => {\r\n    this.focusing = overlayerEl.contains(evt.target);\r\n  });\r\n\r\n  bind(window, 'paste', (evt) => {\r\n    if (!this.focusing) return;\r\n    paste.call(this, 'all', evt);\r\n    evt.preventDefault();\r\n  });\r\n\r\n  // for selector\r\n  bind(window, 'keydown', (evt) => {\r\n    if (!this.focusing) return;\r\n    const keyCode = evt.keyCode || evt.which;\r\n    const {\r\n      key,\r\n      ctrlKey,\r\n      shiftKey,\r\n      metaKey,\r\n    } = evt;\r\n    // console.log('keydown.evt: ', keyCode);\r\n    if (ctrlKey || metaKey) {\r\n      // const { sIndexes, eIndexes } = selector;\r\n      // let what = 'all';\r\n      // if (shiftKey) what = 'text';\r\n      // if (altKey) what = 'format';\r\n      switch (keyCode) {\r\n        case 90:\r\n          // undo: ctrl + z\r\n          this.undo();\r\n          evt.preventDefault();\r\n          break;\r\n        case 89:\r\n          // redo: ctrl + y\r\n          this.redo();\r\n          evt.preventDefault();\r\n          break;\r\n        case 67:\r\n          // ctrl + c\r\n          copy.call(this);\r\n          evt.preventDefault();\r\n          break;\r\n        case 88:\r\n          // ctrl + x\r\n          cut.call(this);\r\n          evt.preventDefault();\r\n          break;\r\n        case 85:\r\n          // ctrl + u\r\n          toolbar.trigger('underline');\r\n          evt.preventDefault();\r\n          break;\r\n        case 86:\r\n          // ctrl + v\r\n          // => paste\r\n          // evt.preventDefault();\r\n          break;\r\n        case 37:\r\n          // ctrl + left\r\n          selectorMove.call(this, shiftKey, 'row-first');\r\n          evt.preventDefault();\r\n          break;\r\n        case 38:\r\n          // ctrl + up\r\n          selectorMove.call(this, shiftKey, 'col-first');\r\n          evt.preventDefault();\r\n          break;\r\n        case 39:\r\n          // ctrl + right\r\n          selectorMove.call(this, shiftKey, 'row-last');\r\n          evt.preventDefault();\r\n          break;\r\n        case 40:\r\n          // ctrl + down\r\n          selectorMove.call(this, shiftKey, 'col-last');\r\n          evt.preventDefault();\r\n          break;\r\n        case 32:\r\n          // ctrl + space, all cells in col\r\n          selectorSet.call(this, false, -1, this.data.selector.ci, false);\r\n          evt.preventDefault();\r\n          break;\r\n        case 66:\r\n          // ctrl + B\r\n          toolbar.trigger('bold');\r\n          break;\r\n        case 73:\r\n          // ctrl + I\r\n          toolbar.trigger('italic');\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    } else {\r\n      // console.log('evt.keyCode:', evt.keyCode);\r\n      switch (keyCode) {\r\n        case 32:\r\n          if (shiftKey) {\r\n            // shift + space, all cells in row\r\n            selectorSet.call(this, false, this.data.selector.ri, -1, false);\r\n          }\r\n          break;\r\n        case 27: // esc\r\n          contextMenu.hide();\r\n          clearClipboard.call(this);\r\n          break;\r\n        case 37: // left\r\n          selectorMove.call(this, shiftKey, 'left');\r\n          evt.preventDefault();\r\n          break;\r\n        case 38: // up\r\n          selectorMove.call(this, shiftKey, 'up');\r\n          evt.preventDefault();\r\n          break;\r\n        case 39: // right\r\n          selectorMove.call(this, shiftKey, 'right');\r\n          evt.preventDefault();\r\n          break;\r\n        case 40: // down\r\n          selectorMove.call(this, shiftKey, 'down');\r\n          evt.preventDefault();\r\n          break;\r\n        case 9: // tab\r\n          editor.clear();\r\n          // shift + tab => move left\r\n          // tab => move right\r\n          selectorMove.call(this, false, shiftKey ? 'left' : 'right');\r\n          evt.preventDefault();\r\n          break;\r\n        case 13: // enter\r\n          editor.clear();\r\n          // shift + enter => move up\r\n          // enter => move down\r\n          selectorMove.call(this, false, shiftKey ? 'up' : 'down');\r\n          evt.preventDefault();\r\n          break;\r\n        case 8: // backspace\r\n          insertDeleteRowColumn.call(this, 'delete-cell-text');\r\n          evt.preventDefault();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      if (key === 'Delete') {\r\n        insertDeleteRowColumn.call(this, 'delete-cell-text');\r\n        evt.preventDefault();\r\n      } else if ((keyCode >= 65 && keyCode <= 90) ||\r\n        (keyCode >= 48 && keyCode <= 57) ||\r\n        (keyCode >= 96 && keyCode <= 105) ||\r\n        evt.key === '='\r\n      ) {\r\n        dataSetCellText.call(this, evt.key, 'input');\r\n        editorSet.call(this);\r\n      } else if (keyCode === 113) {\r\n        // F2\r\n        editorSet.call(this);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport default class Sheet {\r\n  constructor(targetEl, data) {\r\n    this.eventMap = new Map();\r\n    const {\r\n      view,\r\n      showToolbar,\r\n      showContextmenu\r\n    } = data.settings;\r\n    this.el = h('div', `${cssPrefix}-sheet`);\r\n    this.toolbar = new Toolbar(data, view.width, !showToolbar);\r\n    this.print = new Print(data);\r\n    targetEl.children(this.toolbar.el, this.el, this.print.el);\r\n    this.data = data;\r\n    // table\r\n    this.tableEl = h('canvas', `${cssPrefix}-table`);\r\n    // resizer\r\n    this.rowResizer = new Resizer(false, data.rows.height);\r\n    this.colResizer = new Resizer(true, data.cols.minWidth);\r\n    // scrollbar\r\n    this.verticalScrollbar = new Scrollbar(true);\r\n    this.horizontalScrollbar = new Scrollbar(false);\r\n    // editor\r\n    this.editor = new Editor(\r\n      formulas,\r\n      () => this.getTableOffset(),\r\n      data.rows.height,\r\n    );\r\n    // data validation\r\n    this.modalValidation = new ModalValidation();\r\n    // contextMenu\r\n    this.contextMenu = new ContextMenu(() => this.getRect(), !showContextmenu);\r\n    // selector\r\n    this.selector = new Selector(data);\r\n    this.overlayerCEl = h('div', `${cssPrefix}-overlayer-content`)\r\n      .children(\r\n        this.editor.el,\r\n        this.selector.el,\r\n      );\r\n    this.overlayerEl = h('div', `${cssPrefix}-overlayer`)\r\n      .child(this.overlayerCEl);\r\n    // sortFilter\r\n    this.sortFilter = new SortFilter();\r\n    // root element\r\n    this.el.children(\r\n      this.tableEl,\r\n      this.overlayerEl.el,\r\n      this.rowResizer.el,\r\n      this.colResizer.el,\r\n      this.verticalScrollbar.el,\r\n      this.horizontalScrollbar.el,\r\n      this.contextMenu.el,\r\n      this.modalValidation.el,\r\n      this.sortFilter.el,\r\n    );\r\n    // table\r\n    this.table = new Table(this.tableEl.el, data);\r\n    sheetInitEvents.call(this);\r\n    sheetReset.call(this);\r\n    // init selector [0, 0]\r\n    selectorSet.call(this, false, 0, 0);\r\n  }\r\n\r\n  on(eventName, func) {\r\n    this.eventMap.set(eventName, func);\r\n    return this;\r\n  }\r\n\r\n  trigger(eventName, ...args) {\r\n    const {\r\n      eventMap\r\n    } = this;\r\n    if (eventMap.has(eventName)) {\r\n      eventMap.get(eventName).call(this, ...args);\r\n    }\r\n  }\r\n\r\n  resetData(data) {\r\n    // before\r\n    this.editor.clear();\r\n    // after\r\n    this.data = data;\r\n    verticalScrollbarSet.call(this);\r\n    horizontalScrollbarSet.call(this);\r\n    this.toolbar.resetData(data);\r\n    this.print.resetData(data);\r\n    this.selector.resetData(data);\r\n    this.table.resetData(data);\r\n  }\r\n\r\n  loadData(data) {\r\n    this.data.setData(data);\r\n    sheetReset.call(this);\r\n    return this;\r\n  }\r\n\r\n  // freeze rows or cols\r\n  freeze(ri, ci) {\r\n    const {\r\n      data\r\n    } = this;\r\n    data.setFreeze(ri, ci);\r\n    sheetReset.call(this);\r\n    return this;\r\n  }\r\n\r\n  undo() {\r\n    this.data.undo();\r\n    sheetReset.call(this);\r\n  }\r\n\r\n  redo() {\r\n    this.data.redo();\r\n    sheetReset.call(this);\r\n  }\r\n\r\n  reload() {\r\n    sheetReset.call(this);\r\n    return this;\r\n  }\r\n\r\n  getRect() {\r\n    const {\r\n      data\r\n    } = this;\r\n    return {\r\n      width: data.viewWidth(),\r\n      height: data.viewHeight()\r\n    };\r\n  }\r\n\r\n  getTableOffset() {\r\n    const {\r\n      rows,\r\n      cols\r\n    } = this.data;\r\n    const {\r\n      width,\r\n      height\r\n    } = this.getRect();\r\n    return {\r\n      width: width - cols.indexWidth,\r\n      height: height - rows.height,\r\n      left: cols.indexWidth,\r\n      top: rows.height,\r\n    };\r\n  }\r\n}\r\n"]}]}