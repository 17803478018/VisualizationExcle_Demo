{"remainingRequest":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js!D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\代码\\del_demo\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\core\\cell.js","dependencies":[{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\core\\cell.js","mtime":1614915429358},{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1596536485880},{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1606828682259},{"path":"D:\\代码\\del_demo\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js","mtime":1603719226989}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkQ6L1x1NEVFM1x1NzgwMS9kZWxfZGVtby9WaXN1YWxpemF0aW9uRXhjbGVfRGVtby9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuaXMtc2FmZS1pbnRlZ2VyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgeyBleHByMnh5LCB4eTJleHByIH0gZnJvbSAnLi9hbHBoYWJldCc7CmltcG9ydCB7IG51bWJlckNhbGMgfSBmcm9tICcuL2hlbHBlcic7IC8vIENvbnZlcnRpbmcgaW5maXggZXhwcmVzc2lvbiB0byBhIHN1ZmZpeCBleHByZXNzaW9uCi8vIHNyYzogQVZFUkFHRShTVU0oQTEsQTIpLCBCMSkgKyA1MCArIEIyMAovLyByZXR1cm46IFtBMSwgQTJdLCBTVU1bLCBCMV0sQVZFUkFHRSw1MCwrLEIyMCwrCgp2YXIgaW5maXhFeHByVG9TdWZmaXhFeHByID0gZnVuY3Rpb24gaW5maXhFeHByVG9TdWZmaXhFeHByKHNyYykgewogIHZhciBvcGVyYXRvclN0YWNrID0gW107CiAgdmFyIHN0YWNrID0gW107CiAgdmFyIHN1YlN0cnMgPSBbXTsgLy8gU1VNLCBBMSwgQjIsIDUwIC4uLgoKICB2YXIgZm5BcmdUeXBlID0gMDsgLy8gMSA9PiAsIDIgPT4gOgoKICB2YXIgZm5BcmdPcGVyYXRvciA9ICcnOwogIHZhciBmbkFyZ3NMZW4gPSAxOyAvLyBBMSxBMixBMy4uLgoKICB2YXIgb2xkYyA9ICcnOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHNyYy5sZW5ndGg7IGkgKz0gMSkgewogICAgdmFyIGMgPSBzcmMuY2hhckF0KGkpOwoKICAgIGlmIChjICE9PSAnICcpIHsKICAgICAgaWYgKGMgPj0gJ2EnICYmIGMgPD0gJ3onKSB7CiAgICAgICAgc3ViU3Rycy5wdXNoKGMudG9VcHBlckNhc2UoKSk7CiAgICAgIH0gZWxzZSBpZiAoYyA+PSAnMCcgJiYgYyA8PSAnOScgfHwgYyA+PSAnQScgJiYgYyA8PSAnWicgfHwgYyA9PT0gJy4nKSB7CiAgICAgICAgc3ViU3Rycy5wdXNoKGMpOwogICAgICB9IGVsc2UgaWYgKGMgPT09ICciJykgewogICAgICAgIGkgKz0gMTsKCiAgICAgICAgd2hpbGUgKHNyYy5jaGFyQXQoaSkgIT09ICciJykgewogICAgICAgICAgc3ViU3Rycy5wdXNoKHNyYy5jaGFyQXQoaSkpOwogICAgICAgICAgaSArPSAxOwogICAgICAgIH0KCiAgICAgICAgc3RhY2sucHVzaCgiXCIiLmNvbmNhdChzdWJTdHJzLmpvaW4oJycpKSk7CiAgICAgICAgc3ViU3RycyA9IFtdOwogICAgICB9IGVsc2UgaWYgKGMgPT09ICctJyAmJiAvWytcLSovLChdLy50ZXN0KG9sZGMpKSB7CiAgICAgICAgc3ViU3Rycy5wdXNoKGMpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCdzdWJTdHJzOicsIHN1YlN0cnMuam9pbignJyksIHN0YWNrKTsKICAgICAgICBpZiAoYyAhPT0gJygnICYmIHN1YlN0cnMubGVuZ3RoID4gMCkgewogICAgICAgICAgc3RhY2sucHVzaChzdWJTdHJzLmpvaW4oJycpKTsKICAgICAgICB9CgogICAgICAgIGlmIChjID09PSAnKScpIHsKICAgICAgICAgIHZhciBjMSA9IG9wZXJhdG9yU3RhY2sucG9wKCk7CgogICAgICAgICAgaWYgKGZuQXJnVHlwZSA9PT0gMikgewogICAgICAgICAgICAvLyBmbiBhcmd1bWVudCByYW5nZSA9PiBBMTpCNQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHZhciBfZXhwcjJ4eSA9IGV4cHIyeHkoc3RhY2sucG9wKCkpLAogICAgICAgICAgICAgICAgICBfZXhwcjJ4eTIgPSBfc2xpY2VkVG9BcnJheShfZXhwcjJ4eSwgMiksCiAgICAgICAgICAgICAgICAgIGV4ID0gX2V4cHIyeHkyWzBdLAogICAgICAgICAgICAgICAgICBleSA9IF9leHByMnh5MlsxXTsKCiAgICAgICAgICAgICAgdmFyIF9leHByMnh5MyA9IGV4cHIyeHkoc3RhY2sucG9wKCkpLAogICAgICAgICAgICAgICAgICBfZXhwcjJ4eTQgPSBfc2xpY2VkVG9BcnJheShfZXhwcjJ4eTMsIDIpLAogICAgICAgICAgICAgICAgICBzeCA9IF9leHByMnh5NFswXSwKICAgICAgICAgICAgICAgICAgc3kgPSBfZXhwcjJ4eTRbMV07IC8vIGNvbnNvbGUubG9nKCc6OicsIHN4LCBzeSwgZXgsIGV5KTsKCgogICAgICAgICAgICAgIHZhciByYW5nZWxlbiA9IDA7CgogICAgICAgICAgICAgIGZvciAodmFyIHggPSBzeDsgeCA8PSBleDsgeCArPSAxKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gc3k7IHkgPD0gZXk7IHkgKz0gMSkgewogICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHh5MmV4cHIoeCwgeSkpOwogICAgICAgICAgICAgICAgICByYW5nZWxlbiArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RhY2sucHVzaChbYzEsIHJhbmdlbGVuXSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsvLyBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChmbkFyZ1R5cGUgPT09IDEgfHwgZm5BcmdUeXBlID09PSAzKSB7CiAgICAgICAgICAgIGlmIChmbkFyZ1R5cGUgPT09IDMpIHN0YWNrLnB1c2goZm5BcmdPcGVyYXRvcik7IC8vIGZuIGFyZ3VtZW50ID0+IEExLEEyLEI1CgogICAgICAgICAgICBzdGFjay5wdXNoKFtjMSwgZm5BcmdzTGVuXSk7CiAgICAgICAgICAgIGZuQXJnc0xlbiA9IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnYzE6JywgYzEsIGZuQXJnVHlwZSwgc3RhY2ssIG9wZXJhdG9yU3RhY2spOwogICAgICAgICAgICB3aGlsZSAoYzEgIT09ICcoJykgewogICAgICAgICAgICAgIHN0YWNrLnB1c2goYzEpOwogICAgICAgICAgICAgIGlmIChvcGVyYXRvclN0YWNrLmxlbmd0aCA8PSAwKSBicmVhazsKICAgICAgICAgICAgICBjMSA9IG9wZXJhdG9yU3RhY2sucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmbkFyZ1R5cGUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJz0nIHx8IGMgPT09ICc+JyB8fCBjID09PSAnPCcpIHsKICAgICAgICAgIHZhciBuYyA9IHNyYy5jaGFyQXQoaSArIDEpOwogICAgICAgICAgZm5BcmdPcGVyYXRvciA9IGM7CgogICAgICAgICAgaWYgKG5jID09PSAnPScgfHwgbmMgPT09ICctJykgewogICAgICAgICAgICBmbkFyZ09wZXJhdG9yICs9IG5jOwogICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICB9CgogICAgICAgICAgZm5BcmdUeXBlID0gMzsKICAgICAgICB9IGVsc2UgaWYgKGMgPT09ICc6JykgewogICAgICAgICAgZm5BcmdUeXBlID0gMjsKICAgICAgICB9IGVsc2UgaWYgKGMgPT09ICcsJykgewogICAgICAgICAgaWYgKGZuQXJnVHlwZSA9PT0gMykgewogICAgICAgICAgICBzdGFjay5wdXNoKGZuQXJnT3BlcmF0b3IpOwogICAgICAgICAgfQoKICAgICAgICAgIGZuQXJnVHlwZSA9IDE7CiAgICAgICAgICBmbkFyZ3NMZW4gKz0gMTsKICAgICAgICB9IGVsc2UgaWYgKGMgPT09ICcoJyAmJiBzdWJTdHJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIC8vIGZ1bmN0aW9uCiAgICAgICAgICBvcGVyYXRvclN0YWNrLnB1c2goc3ViU3Rycy5qb2luKCcnKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIHByaW9yaXR5OiAqLyA+ICstCiAgICAgICAgICAvLyBjb25zb2xlLmxvZygneHh4eDonLCBvcGVyYXRvclN0YWNrLCBjLCBzdGFjayk7CiAgICAgICAgICBpZiAob3BlcmF0b3JTdGFjay5sZW5ndGggPiAwICYmIChjID09PSAnKycgfHwgYyA9PT0gJy0nKSkgewogICAgICAgICAgICB2YXIgdG9wID0gb3BlcmF0b3JTdGFja1tvcGVyYXRvclN0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAodG9wICE9PSAnKCcpIHN0YWNrLnB1c2gob3BlcmF0b3JTdGFjay5wb3AoKSk7CgogICAgICAgICAgICBpZiAodG9wID09PSAnKicgfHwgdG9wID09PSAnLycpIHsKICAgICAgICAgICAgICB3aGlsZSAob3BlcmF0b3JTdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0b3AgPSBvcGVyYXRvclN0YWNrW29wZXJhdG9yU3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBpZiAodG9wICE9PSAnKCcpIHN0YWNrLnB1c2gob3BlcmF0b3JTdGFjay5wb3AoKSk7ZWxzZSBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAob3BlcmF0b3JTdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBfdG9wID0gb3BlcmF0b3JTdGFja1tvcGVyYXRvclN0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAoX3RvcCA9PT0gJyonIHx8IF90b3AgPT09ICcvJykgc3RhY2sucHVzaChvcGVyYXRvclN0YWNrLnBvcCgpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBvcGVyYXRvclN0YWNrLnB1c2goYyk7CiAgICAgICAgfQoKICAgICAgICBzdWJTdHJzID0gW107CiAgICAgIH0KCiAgICAgIG9sZGMgPSBjOwogICAgfQogIH0KCiAgaWYgKHN1YlN0cnMubGVuZ3RoID4gMCkgewogICAgc3RhY2sucHVzaChzdWJTdHJzLmpvaW4oJycpKTsKICB9CgogIHdoaWxlIChvcGVyYXRvclN0YWNrLmxlbmd0aCA+IDApIHsKICAgIHN0YWNrLnB1c2gob3BlcmF0b3JTdGFjay5wb3AoKSk7CiAgfQoKICByZXR1cm4gc3RhY2s7Cn07Cgp2YXIgZXZhbFN1YkV4cHIgPSBmdW5jdGlvbiBldmFsU3ViRXhwcihzdWJFeHByLCBjZWxsUmVuZGVyKSB7CiAgdmFyIF9zdWJFeHByID0gX3NsaWNlZFRvQXJyYXkoc3ViRXhwciwgMSksCiAgICAgIGZsID0gX3N1YkV4cHJbMF07CgogIHZhciBleHByID0gc3ViRXhwcjsKCiAgaWYgKGZsID09PSAnIicpIHsKICAgIHJldHVybiBzdWJFeHByLnN1YnN0cmluZygxKTsKICB9CgogIHZhciByZXQgPSAxOwoKICBpZiAoZmwgPT09ICctJykgewogICAgZXhwciA9IHN1YkV4cHIuc3Vic3RyaW5nKDEpOwogICAgcmV0ID0gLTE7CiAgfQoKICBpZiAoZXhwclswXSA+PSAnMCcgJiYgZXhwclswXSA8PSAnOScpIHsKICAgIHJldHVybiByZXQgKiBOdW1iZXIoZXhwcik7CiAgfQoKICB2YXIgX2V4cHIyeHk1ID0gZXhwcjJ4eShleHByKSwKICAgICAgX2V4cHIyeHk2ID0gX3NsaWNlZFRvQXJyYXkoX2V4cHIyeHk1LCAyKSwKICAgICAgeCA9IF9leHByMnh5NlswXSwKICAgICAgeSA9IF9leHByMnh5NlsxXTsKCiAgcmV0dXJuIHJldCAqIGNlbGxSZW5kZXIoeCwgeSk7Cn07IC8vIGV2YWx1YXRlIHRoZSBzdWZmaXggZXhwcmVzc2lvbgovLyBzcmNTdGFjazogPD0gaW5maXhFeHByVG9TdWZpeEV4cHIKLy8gZm9ybXVsYU1hcDogeydTVU0nOiB7fSwgLi4ufQovLyBjZWxsUmVuZGVyOiAoeCwgeSkgPT4ge30KCgp2YXIgZXZhbFN1ZmZpeEV4cHIgPSBmdW5jdGlvbiBldmFsU3VmZml4RXhwcihzcmNTdGFjaywgZm9ybXVsYU1hcCwgY2VsbFJlbmRlciwgY2VsbExpc3QpIHsKICB2YXIgc3RhY2sgPSBbXTsgLy8gY29uc29sZS5sb2coJzo6Ojo6Zm9ybXVsYU1hcDonLCBmb3JtdWxhTWFwKTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcmNTdGFjay5sZW5ndGg7IGkgKz0gMSkgewogICAgLy8gY29uc29sZS5sb2coJzo6Oj4+PicsIHNyY1N0YWNrW2ldKTsKICAgIHZhciBleHByID0gc3JjU3RhY2tbaV07CiAgICB2YXIgZmMgPSBleHByWzBdOwoKICAgIGlmIChleHByID09PSAnKycpIHsKICAgICAgdmFyIHRvcCA9IHN0YWNrLnBvcCgpOwogICAgICBzdGFjay5wdXNoKG51bWJlckNhbGMoJysnLCBzdGFjay5wb3AoKSwgdG9wKSk7CiAgICB9IGVsc2UgaWYgKGV4cHIgPT09ICctJykgewogICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAxKSB7CiAgICAgICAgdmFyIF90b3AyID0gc3RhY2sucG9wKCk7CgogICAgICAgIHN0YWNrLnB1c2gobnVtYmVyQ2FsYygnKicsIF90b3AyLCAtMSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfdG9wMyA9IHN0YWNrLnBvcCgpOwoKICAgICAgICBzdGFjay5wdXNoKG51bWJlckNhbGMoJy0nLCBzdGFjay5wb3AoKSwgX3RvcDMpKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChleHByID09PSAnKicpIHsKICAgICAgc3RhY2sucHVzaChudW1iZXJDYWxjKCcqJywgc3RhY2sucG9wKCksIHN0YWNrLnBvcCgpKSk7CiAgICB9IGVsc2UgaWYgKGV4cHIgPT09ICcvJykgewogICAgICB2YXIgX3RvcDQgPSBzdGFjay5wb3AoKTsKCiAgICAgIHN0YWNrLnB1c2gobnVtYmVyQ2FsYygnLycsIHN0YWNrLnBvcCgpLCBfdG9wNCkpOwogICAgfSBlbHNlIGlmIChmYyA9PT0gJz0nIHx8IGZjID09PSAnPicgfHwgZmMgPT09ICc8JykgewogICAgICB2YXIgX3RvcDUgPSBzdGFjay5wb3AoKTsKCiAgICAgIGlmICghTnVtYmVyLmlzTmFOKF90b3A1KSkgX3RvcDUgPSBOdW1iZXIoX3RvcDUpOwogICAgICB2YXIgbGVmdCA9IHN0YWNrLnBvcCgpOwogICAgICBpZiAoIU51bWJlci5pc05hTihsZWZ0KSkgbGVmdCA9IE51bWJlcihsZWZ0KTsKICAgICAgdmFyIHJldCA9IGZhbHNlOwoKICAgICAgaWYgKGZjID09PSAnPScpIHsKICAgICAgICByZXQgPSBsZWZ0ID09PSBfdG9wNTsKICAgICAgfSBlbHNlIGlmIChleHByID09PSAnPicpIHsKICAgICAgICByZXQgPSBsZWZ0ID4gX3RvcDU7CiAgICAgIH0gZWxzZSBpZiAoZXhwciA9PT0gJz49JykgewogICAgICAgIHJldCA9IGxlZnQgPj0gX3RvcDU7CiAgICAgIH0gZWxzZSBpZiAoZXhwciA9PT0gJzwnKSB7CiAgICAgICAgcmV0ID0gbGVmdCA8IF90b3A1OwogICAgICB9IGVsc2UgaWYgKGV4cHIgPT09ICc8PScpIHsKICAgICAgICByZXQgPSBsZWZ0IDw9IF90b3A1OwogICAgICB9CgogICAgICBzdGFjay5wdXNoKHJldCk7CiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZXhwcikpIHsKICAgICAgdmFyIF9leHByID0gX3NsaWNlZFRvQXJyYXkoZXhwciwgMiksCiAgICAgICAgICBmb3JtdWxhID0gX2V4cHJbMF0sCiAgICAgICAgICBsZW4gPSBfZXhwclsxXTsKCiAgICAgIHZhciBwYXJhbXMgPSBbXTsKCiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuOyBqICs9IDEpIHsKICAgICAgICBwYXJhbXMucHVzaChzdGFjay5wb3AoKSk7CiAgICAgIH0KCiAgICAgIHN0YWNrLnB1c2goZm9ybXVsYU1hcFtmb3JtdWxhXS5yZW5kZXIocGFyYW1zLnJldmVyc2UoKSkpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGNlbGxMaXN0LmluY2x1ZGVzKGV4cHIpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KCiAgICAgIGlmIChmYyA+PSAnYScgJiYgZmMgPD0gJ3onIHx8IGZjID49ICdBJyAmJiBmYyA8PSAnWicpIHsKICAgICAgICBjZWxsTGlzdC5wdXNoKGV4cHIpOwogICAgICB9CgogICAgICBzdGFjay5wdXNoKGV2YWxTdWJFeHByKGV4cHIsIGNlbGxSZW5kZXIpKTsKICAgICAgY2VsbExpc3QucG9wKCk7CiAgICB9IC8vIGNvbnNvbGUubG9nKCdzdGFjazonLCBzdGFjayk7CgogIH0KCiAgcmV0dXJuIHN0YWNrWzBdOwp9OwoKdmFyIGNlbGxSZW5kZXIgPSBmdW5jdGlvbiBjZWxsUmVuZGVyKHNyYywgZm9ybXVsYU1hcCwgZ2V0Q2VsbFRleHQpIHsKICB2YXIgY2VsbExpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IFtdOwoKICBpZiAoc3JjWzBdID09PSAnPScpIHsKICAgIHZhciBzdGFjayA9IGluZml4RXhwclRvU3VmZml4RXhwcihzcmMuc3Vic3RyaW5nKDEpKTsKICAgIGlmIChzdGFjay5sZW5ndGggPD0gMCkgcmV0dXJuIHNyYzsKICAgIHJldHVybiBldmFsU3VmZml4RXhwcihzdGFjaywgZm9ybXVsYU1hcCwgZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgcmV0dXJuIGNlbGxSZW5kZXIoZ2V0Q2VsbFRleHQoeCwgeSksIGZvcm11bGFNYXAsIGdldENlbGxUZXh0LCBjZWxsTGlzdCk7CiAgICB9LCBjZWxsTGlzdCk7CiAgfQoKICByZXR1cm4gc3JjOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIHJlbmRlcjogY2VsbFJlbmRlcgp9OwpleHBvcnQgeyBpbmZpeEV4cHJUb1N1ZmZpeEV4cHIgfTs="},{"version":3,"sources":["D:/代码/del_demo/VisualizationExcle_Demo/src/components/x-spreadsheet/core/cell.js"],"names":["expr2xy","xy2expr","numberCalc","infixExprToSuffixExpr","src","operatorStack","stack","subStrs","fnArgType","fnArgOperator","fnArgsLen","oldc","i","length","c","charAt","push","toUpperCase","join","test","c1","pop","ex","ey","sx","sy","rangelen","x","y","e","nc","top","evalSubExpr","subExpr","cellRender","fl","expr","substring","ret","Number","evalSuffixExpr","srcStack","formulaMap","cellList","fc","isNaN","left","Array","isArray","formula","len","params","j","render","reverse","includes","getCellText"],"mappings":"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","sourcesContent":["import { expr2xy, xy2expr } from './alphabet';\r\nimport { numberCalc } from './helper';\r\n\r\n// Converting infix expression to a suffix expression\r\n// src: AVERAGE(SUM(A1,A2), B1) + 50 + B20\r\n// return: [A1, A2], SUM[, B1],AVERAGE,50,+,B20,+\r\nconst infixExprToSuffixExpr = (src) => {\r\n  const operatorStack = [];\r\n  const stack = [];\r\n  let subStrs = []; // SUM, A1, B2, 50 ...\r\n  let fnArgType = 0; // 1 => , 2 => :\r\n  let fnArgOperator = '';\r\n  let fnArgsLen = 1; // A1,A2,A3...\r\n  let oldc = '';\r\n  for (let i = 0; i < src.length; i += 1) {\r\n    const c = src.charAt(i);\r\n    if (c !== ' ') {\r\n      if (c >= 'a' && c <= 'z') {\r\n        subStrs.push(c.toUpperCase());\r\n      } else if ((c >= '0' && c <= '9') || (c >= 'A' && c <= 'Z') || c === '.') {\r\n        subStrs.push(c);\r\n      } else if (c === '\"') {\r\n        i += 1;\r\n        while (src.charAt(i) !== '\"') {\r\n          subStrs.push(src.charAt(i));\r\n          i += 1;\r\n        }\r\n        stack.push(`\"${subStrs.join('')}`);\r\n        subStrs = [];\r\n      } else if (c === '-' && /[+\\-*/,(]/.test(oldc)) {\r\n        subStrs.push(c);\r\n      } else {\r\n        // console.log('subStrs:', subStrs.join(''), stack);\r\n        if (c !== '(' && subStrs.length > 0) {\r\n          stack.push(subStrs.join(''));\r\n        }\r\n        if (c === ')') {\r\n          let c1 = operatorStack.pop();\r\n          if (fnArgType === 2) {\r\n            // fn argument range => A1:B5\r\n            try {\r\n              const [ex, ey] = expr2xy(stack.pop());\r\n              const [sx, sy] = expr2xy(stack.pop());\r\n              // console.log('::', sx, sy, ex, ey);\r\n              let rangelen = 0;\r\n              for (let x = sx; x <= ex; x += 1) {\r\n                for (let y = sy; y <= ey; y += 1) {\r\n                  stack.push(xy2expr(x, y));\r\n                  rangelen += 1;\r\n                }\r\n              }\r\n              stack.push([c1, rangelen]);\r\n            } catch (e) {\r\n              // console.log(e);\r\n            }\r\n          } else if (fnArgType === 1 || fnArgType === 3) {\r\n            if (fnArgType === 3) stack.push(fnArgOperator);\r\n            // fn argument => A1,A2,B5\r\n            stack.push([c1, fnArgsLen]);\r\n            fnArgsLen = 1;\r\n          } else {\r\n            // console.log('c1:', c1, fnArgType, stack, operatorStack);\r\n            while (c1 !== '(') {\r\n              stack.push(c1);\r\n              if (operatorStack.length <= 0) break;\r\n              c1 = operatorStack.pop();\r\n            }\r\n          }\r\n          fnArgType = 0;\r\n        } else if (c === '=' || c === '>' || c === '<') {\r\n          const nc = src.charAt(i + 1);\r\n          fnArgOperator = c;\r\n          if (nc === '=' || nc === '-') {\r\n            fnArgOperator += nc;\r\n            i += 1;\r\n          }\r\n          fnArgType = 3;\r\n        } else if (c === ':') {\r\n          fnArgType = 2;\r\n        } else if (c === ',') {\r\n          if (fnArgType === 3) {\r\n            stack.push(fnArgOperator);\r\n          }\r\n          fnArgType = 1;\r\n          fnArgsLen += 1;\r\n        } else if (c === '(' && subStrs.length > 0) {\r\n          // function\r\n          operatorStack.push(subStrs.join(''));\r\n        } else {\r\n          // priority: */ > +-\r\n          // console.log('xxxx:', operatorStack, c, stack);\r\n          if (operatorStack.length > 0 && (c === '+' || c === '-')) {\r\n            let top = operatorStack[operatorStack.length - 1];\r\n            if (top !== '(') stack.push(operatorStack.pop());\r\n            if (top === '*' || top === '/') {\r\n              while (operatorStack.length > 0) {\r\n                top = operatorStack[operatorStack.length - 1];\r\n                if (top !== '(') stack.push(operatorStack.pop());\r\n                else break;\r\n              }\r\n            }\r\n          } else if (operatorStack.length > 0) {\r\n            const top = operatorStack[operatorStack.length - 1];\r\n            if (top === '*' || top === '/') stack.push(operatorStack.pop());\r\n          }\r\n          operatorStack.push(c);\r\n        }\r\n        subStrs = [];\r\n      }\r\n      oldc = c;\r\n    }\r\n  }\r\n  if (subStrs.length > 0) {\r\n    stack.push(subStrs.join(''));\r\n  }\r\n  while (operatorStack.length > 0) {\r\n    stack.push(operatorStack.pop());\r\n  }\r\n  return stack;\r\n};\r\n\r\nconst evalSubExpr = (subExpr, cellRender) => {\r\n  const [fl] = subExpr;\r\n  let expr = subExpr;\r\n  if (fl === '\"') {\r\n    return subExpr.substring(1);\r\n  }\r\n  let ret = 1;\r\n  if (fl === '-') {\r\n    expr = subExpr.substring(1);\r\n    ret = -1;\r\n  }\r\n  if (expr[0] >= '0' && expr[0] <= '9') {\r\n    return ret * Number(expr);\r\n  }\r\n  const [x, y] = expr2xy(expr);\r\n  return ret * cellRender(x, y);\r\n};\r\n\r\n// evaluate the suffix expression\r\n// srcStack: <= infixExprToSufixExpr\r\n// formulaMap: {'SUM': {}, ...}\r\n// cellRender: (x, y) => {}\r\nconst evalSuffixExpr = (srcStack, formulaMap, cellRender, cellList) => {\r\n  const stack = [];\r\n  // console.log(':::::formulaMap:', formulaMap);\r\n  for (let i = 0; i < srcStack.length; i += 1) {\r\n    // console.log(':::>>>', srcStack[i]);\r\n    const expr = srcStack[i];\r\n    const fc = expr[0];\r\n    if (expr === '+') {\r\n      const top = stack.pop();\r\n      stack.push(numberCalc('+', stack.pop(), top));\r\n    } else if (expr === '-') {\r\n      if (stack.length === 1) {\r\n        const top = stack.pop();\r\n        stack.push(numberCalc('*', top, -1));\r\n      } else {\r\n        const top = stack.pop();\r\n        stack.push(numberCalc('-', stack.pop(), top));\r\n      }\r\n    } else if (expr === '*') {\r\n      stack.push(numberCalc('*', stack.pop(), stack.pop()));\r\n    } else if (expr === '/') {\r\n      const top = stack.pop();\r\n      stack.push(numberCalc('/', stack.pop(), top));\r\n    } else if (fc === '=' || fc === '>' || fc === '<') {\r\n      let top = stack.pop();\r\n      if (!Number.isNaN(top)) top = Number(top);\r\n      let left = stack.pop();\r\n      if (!Number.isNaN(left)) left = Number(left);\r\n      let ret = false;\r\n      if (fc === '=') {\r\n        ret = (left === top);\r\n      } else if (expr === '>') {\r\n        ret = (left > top);\r\n      } else if (expr === '>=') {\r\n        ret = (left >= top);\r\n      } else if (expr === '<') {\r\n        ret = (left < top);\r\n      } else if (expr === '<=') {\r\n        ret = (left <= top);\r\n      }\r\n      stack.push(ret);\r\n    } else if (Array.isArray(expr)) {\r\n      const [formula, len] = expr;\r\n      const params = [];\r\n      for (let j = 0; j < len; j += 1) {\r\n        params.push(stack.pop());\r\n      }\r\n      stack.push(formulaMap[formula].render(params.reverse()));\r\n    } else {\r\n      if (cellList.includes(expr)) {\r\n        return 0;\r\n      }\r\n      if ((fc >= 'a' && fc <= 'z') || (fc >= 'A' && fc <= 'Z')) {\r\n        cellList.push(expr);\r\n      }\r\n      stack.push(evalSubExpr(expr, cellRender));\r\n      cellList.pop();\r\n    }\r\n    // console.log('stack:', stack);\r\n  }\r\n  return stack[0];\r\n};\r\n\r\nconst cellRender = (src, formulaMap, getCellText, cellList = []) => {\r\n  if (src[0] === '=') {\r\n    const stack = infixExprToSuffixExpr(src.substring(1));\r\n    if (stack.length <= 0) return src;\r\n    return evalSuffixExpr(\r\n      stack,\r\n      formulaMap,\r\n      (x, y) => cellRender(getCellText(x, y), formulaMap, getCellText, cellList),\r\n      cellList,\r\n    );\r\n  }\r\n  return src;\r\n};\r\n\r\nexport default {\r\n  render: cellRender,\r\n};\r\nexport {\r\n  infixExprToSuffixExpr,\r\n};\r\n"]}]}