{"remainingRequest":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\component\\editor.js","dependencies":[{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\component\\editor.js","mtime":1615364198195},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615364186494},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1615364186192},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js","mtime":1615364189991}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOi9Vc2Vycy9cdTU0MzRcdTVFRkFcdTY2MEUvRGVza3RvcC9WaXN1YWxpemF0aW9uRXhjbGVfRGVtby9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6L1VzZXJzL1x1NTQzNFx1NUVGQVx1NjYwRS9EZXNrdG9wL1Zpc3VhbGl6YXRpb25FeGNsZV9EZW1vL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiQzovVXNlcnMvXHU1NDM0XHU1RUZBXHU2NjBFL0Rlc2t0b3AvVmlzdWFsaXphdGlvbkV4Y2xlX0RlbW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7Ci8vKiBnbG9iYWwgd2luZG93ICovCmltcG9ydCB7IGggfSBmcm9tICcuL2VsZW1lbnQnOwppbXBvcnQgU3VnZ2VzdCBmcm9tICcuL3N1Z2dlc3QnOwppbXBvcnQgRGF0ZXBpY2tlciBmcm9tICcuL2RhdGVwaWNrZXInOwppbXBvcnQgeyBjc3NQcmVmaXggfSBmcm9tICcuLi9jb25maWcnOyAvLyBpbXBvcnQgeyBtb3VzZU1vdmVVcCB9IGZyb20gJy4uL2V2ZW50JzsKCmZ1bmN0aW9uIHJlc2V0VGV4dGFyZWFTaXplKCkgewogIHZhciBpbnB1dFRleHQgPSB0aGlzLmlucHV0VGV4dDsKCiAgaWYgKCEvXlxzKiQvLnRlc3QoaW5wdXRUZXh0KSkgewogICAgdmFyIHRleHRsaW5lRWwgPSB0aGlzLnRleHRsaW5lRWwsCiAgICAgICAgdGV4dEVsID0gdGhpcy50ZXh0RWwsCiAgICAgICAgYXJlYU9mZnNldCA9IHRoaXMuYXJlYU9mZnNldDsKICAgIHZhciB0eHRzID0gaW5wdXRUZXh0LnNwbGl0KCdcbicpOwogICAgdmFyIG1heFR4dFNpemUgPSBNYXRoLm1heC5hcHBseShNYXRoLCBfdG9Db25zdW1hYmxlQXJyYXkodHh0cy5tYXAoZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiBpdC5sZW5ndGg7CiAgICB9KSkpOwogICAgdmFyIHRsT2Zmc2V0ID0gdGV4dGxpbmVFbC5vZmZzZXQoKTsKICAgIHZhciBmb250V2lkdGggPSB0bE9mZnNldC53aWR0aCAvIGlucHV0VGV4dC5sZW5ndGg7CiAgICB2YXIgdGxpbmVXaWR0aCA9IChtYXhUeHRTaXplICsgMSkgKiBmb250V2lkdGggKyA1OwogICAgdmFyIG1heFdpZHRoID0gdGhpcy52aWV3Rm4oKS53aWR0aCAtIGFyZWFPZmZzZXQubGVmdCAtIGZvbnRXaWR0aDsKICAgIHZhciBoMSA9IHR4dHMubGVuZ3RoOwoKICAgIGlmICh0bGluZVdpZHRoID4gYXJlYU9mZnNldC53aWR0aCkgewogICAgICB2YXIgdHdpZHRoID0gdGxpbmVXaWR0aDsKCiAgICAgIGlmICh0bGluZVdpZHRoID4gbWF4V2lkdGgpIHsKICAgICAgICB0d2lkdGggPSBtYXhXaWR0aDsKICAgICAgICBoMSArPSBwYXJzZUludCh0bGluZVdpZHRoIC8gbWF4V2lkdGgsIDEwKTsKICAgICAgICBoMSArPSB0bGluZVdpZHRoICUgbWF4V2lkdGggPiAwID8gMSA6IDA7CiAgICAgIH0KCiAgICAgIHRleHRFbC5jc3MoJ3dpZHRoJywgIiIuY29uY2F0KHR3aWR0aCwgInB4IikpOwogICAgfQoKICAgIGgxICo9IHRoaXMucm93SGVpZ2h0OwoKICAgIGlmIChoMSA+IGFyZWFPZmZzZXQuaGVpZ2h0KSB7CiAgICAgIHRleHRFbC5jc3MoJ2hlaWdodCcsICIiLmNvbmNhdChoMSwgInB4IikpOwogICAgfQogIH0KfQoKZnVuY3Rpb24gaW5zZXJ0VGV4dChfcmVmLCBpdHh0KSB7CiAgdmFyIHRhcmdldCA9IF9yZWYudGFyZ2V0OwogIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZSwKICAgICAgc2VsZWN0aW9uRW5kID0gdGFyZ2V0LnNlbGVjdGlvbkVuZDsKICB2YXIgbnR4dCA9ICIiLmNvbmNhdCh2YWx1ZS5zbGljZSgwLCBzZWxlY3Rpb25FbmQpKS5jb25jYXQoaXR4dCkuY29uY2F0KHZhbHVlLnNsaWNlKHNlbGVjdGlvbkVuZCkpOwogIHRhcmdldC52YWx1ZSA9IG50eHQ7CiAgdGFyZ2V0LnNldFNlbGVjdGlvblJhbmdlKHNlbGVjdGlvbkVuZCArIDEsIHNlbGVjdGlvbkVuZCArIDEpOwogIHRoaXMuaW5wdXRUZXh0ID0gbnR4dDsKICB0aGlzLnRleHRsaW5lRWwuaHRtbChudHh0KTsKICByZXNldFRleHRhcmVhU2l6ZS5jYWxsKHRoaXMpOwp9CgpmdW5jdGlvbiBrZXlkb3duRXZlbnRIYW5kbGVyKGV2dCkgewogIHZhciBrZXlDb2RlID0gZXZ0LmtleUNvZGUsCiAgICAgIGFsdEtleSA9IGV2dC5hbHRLZXk7CiAgaWYgKGtleUNvZGUgIT09IDEzICYmIGtleUNvZGUgIT09IDkpIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgaWYgKGtleUNvZGUgPT09IDEzICYmIGFsdEtleSkgewogICAgaW5zZXJ0VGV4dC5jYWxsKHRoaXMsIGV2dCwgJ1xuJyk7CiAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgfQoKICBpZiAoa2V5Q29kZSA9PT0gMTMgJiYgIWFsdEtleSkgZXZ0LnByZXZlbnREZWZhdWx0KCk7Cn0KCmZ1bmN0aW9uIGlucHV0RXZlbnRIYW5kbGVyKGV2dCkgewogIHZhciB2ID0gZXZ0LnRhcmdldC52YWx1ZTsgLy8gY29uc29sZS5sb2coZXZ0LCAndjonLCB2KTsKCiAgdmFyIHN1Z2dlc3QgPSB0aGlzLnN1Z2dlc3QsCiAgICAgIHRleHRsaW5lRWwgPSB0aGlzLnRleHRsaW5lRWwsCiAgICAgIHZhbGlkYXRvciA9IHRoaXMudmFsaWRhdG9yOwogIHZhciBjZWxsID0gdGhpcy5jZWxsOwoKICBpZiAoY2VsbCAhPT0gbnVsbCkgewogICAgaWYgKCdlZGl0YWJsZScgaW4gY2VsbCAmJiBjZWxsLmVkaXRhYmxlID09PSB0cnVlIHx8IGNlbGwuZWRpdGFibGUgPT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmlucHV0VGV4dCA9IHY7CgogICAgICBpZiAodmFsaWRhdG9yKSB7CiAgICAgICAgaWYgKHZhbGlkYXRvci50eXBlID09PSAnbGlzdCcpIHsKICAgICAgICAgIHN1Z2dlc3Quc2VhcmNoKHYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdWdnZXN0LmhpZGUoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gdi5sYXN0SW5kZXhPZignPScpOwoKICAgICAgICBpZiAoc3RhcnQgIT09IC0xKSB7CiAgICAgICAgICBzdWdnZXN0LnNlYXJjaCh2LnN1YnN0cmluZyhzdGFydCArIDEpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VnZ2VzdC5oaWRlKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0ZXh0bGluZUVsLmh0bWwodik7CiAgICAgIHJlc2V0VGV4dGFyZWFTaXplLmNhbGwodGhpcyk7CiAgICAgIHRoaXMuY2hhbmdlKCdpbnB1dCcsIHYpOwogICAgfSBlbHNlIHsKICAgICAgZXZ0LnRhcmdldC52YWx1ZSA9ICcnOwogICAgfQogIH0gZWxzZSB7CiAgICB0aGlzLmlucHV0VGV4dCA9IHY7CgogICAgaWYgKHZhbGlkYXRvcikgewogICAgICBpZiAodmFsaWRhdG9yLnR5cGUgPT09ICdsaXN0JykgewogICAgICAgIHN1Z2dlc3Quc2VhcmNoKHYpOwogICAgICB9IGVsc2UgewogICAgICAgIHN1Z2dlc3QuaGlkZSgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2YXIgX3N0YXJ0ID0gdi5sYXN0SW5kZXhPZignPScpOwoKICAgICAgaWYgKF9zdGFydCAhPT0gLTEpIHsKICAgICAgICBzdWdnZXN0LnNlYXJjaCh2LnN1YnN0cmluZyhfc3RhcnQgKyAxKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3VnZ2VzdC5oaWRlKCk7CiAgICAgIH0KICAgIH0KCiAgICB0ZXh0bGluZUVsLmh0bWwodik7CiAgICByZXNldFRleHRhcmVhU2l6ZS5jYWxsKHRoaXMpOwogICAgdGhpcy5jaGFuZ2UoJ2lucHV0Jywgdik7CiAgfQp9CgpmdW5jdGlvbiBzZXRUZXh0YXJlYVJhbmdlKHBvc2l0aW9uKSB7CiAgdmFyIGVsID0gdGhpcy50ZXh0RWwuZWw7CiAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICBlbC5mb2N1cygpOwogICAgZWwuc2V0U2VsZWN0aW9uUmFuZ2UocG9zaXRpb24sIHBvc2l0aW9uKTsKICB9LCAwKTsKfQoKZnVuY3Rpb24gX3NldFRleHQodGV4dCwgcG9zaXRpb24pIHsKICB2YXIgdGV4dEVsID0gdGhpcy50ZXh0RWwsCiAgICAgIHRleHRsaW5lRWwgPSB0aGlzLnRleHRsaW5lRWw7IC8vIGZpcmVmb3ggYnVnCgogIHRleHRFbC5lbC5ibHVyKCk7CiAgdGV4dEVsLnZhbCh0ZXh0KTsKICB0ZXh0bGluZUVsLmh0bWwodGV4dCk7CiAgc2V0VGV4dGFyZWFSYW5nZS5jYWxsKHRoaXMsIHBvc2l0aW9uKTsKfQoKZnVuY3Rpb24gc3VnZ2VzdEl0ZW1DbGljayhpdCkgewogIHZhciBpbnB1dFRleHQgPSB0aGlzLmlucHV0VGV4dCwKICAgICAgdmFsaWRhdG9yID0gdGhpcy52YWxpZGF0b3I7CiAgdmFyIHBvc2l0aW9uID0gMDsKCiAgaWYgKHZhbGlkYXRvciAmJiB2YWxpZGF0b3IudHlwZSA9PT0gJ2xpc3QnKSB7CiAgICB0aGlzLmlucHV0VGV4dCA9IGl0OwogICAgcG9zaXRpb24gPSB0aGlzLmlucHV0VGV4dC5sZW5ndGg7CiAgfSBlbHNlIHsKICAgIHZhciBzdGFydCA9IGlucHV0VGV4dC5sYXN0SW5kZXhPZignPScpOwogICAgdmFyIHNpdCA9IGlucHV0VGV4dC5zdWJzdHJpbmcoMCwgc3RhcnQgKyAxKTsKICAgIHZhciBlaXQgPSBpbnB1dFRleHQuc3Vic3RyaW5nKHN0YXJ0ICsgMSk7CgogICAgaWYgKGVpdC5pbmRleE9mKCcpJykgIT09IC0xKSB7CiAgICAgIGVpdCA9IGVpdC5zdWJzdHJpbmcoZWl0LmluZGV4T2YoJyknKSk7CiAgICB9IGVsc2UgewogICAgICBlaXQgPSAnJzsKICAgIH0KCiAgICB0aGlzLmlucHV0VGV4dCA9ICIiLmNvbmNhdChzaXQgKyBpdC5rZXksICIoIik7IC8vIGNvbnNvbGUubG9nKCdpbnB1dFRleHQ6JywgdGhpcy5pbnB1dFRleHQpOwoKICAgIHBvc2l0aW9uID0gdGhpcy5pbnB1dFRleHQubGVuZ3RoOwogICAgdGhpcy5pbnB1dFRleHQgKz0gIikiLmNvbmNhdChlaXQpOwogIH0KCiAgX3NldFRleHQuY2FsbCh0aGlzLCB0aGlzLmlucHV0VGV4dCwgcG9zaXRpb24pOwp9CgpmdW5jdGlvbiByZXNldFN1Z2dlc3RJdGVtcygpIHsKICB0aGlzLnN1Z2dlc3Quc2V0SXRlbXModGhpcy5mb3JtdWxhcyk7Cn0KCmZ1bmN0aW9uIGRhdGVGb3JtYXQoZCkgewogIHZhciBtb250aCA9IGQuZ2V0TW9udGgoKSArIDE7CiAgdmFyIGRhdGUgPSBkLmdldERhdGUoKTsKICBpZiAobW9udGggPCAxMCkgbW9udGggPSAiMCIuY29uY2F0KG1vbnRoKTsKICBpZiAoZGF0ZSA8IDEwKSBkYXRlID0gIjAiLmNvbmNhdChkYXRlKTsKICByZXR1cm4gIiIuY29uY2F0KGQuZ2V0RnVsbFllYXIoKSwgIi0iKS5jb25jYXQobW9udGgsICItIikuY29uY2F0KGRhdGUpOwp9Cgp2YXIgRWRpdG9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBFZGl0b3IoZm9ybXVsYXMsIHZpZXdGbiwgcm93SGVpZ2h0KSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFZGl0b3IpOwoKICAgIHRoaXMudmlld0ZuID0gdmlld0ZuOwogICAgdGhpcy5yb3dIZWlnaHQgPSByb3dIZWlnaHQ7CiAgICB0aGlzLmZvcm11bGFzID0gZm9ybXVsYXM7CiAgICB0aGlzLnN1Z2dlc3QgPSBuZXcgU3VnZ2VzdChmb3JtdWxhcywgZnVuY3Rpb24gKGl0KSB7CiAgICAgIHN1Z2dlc3RJdGVtQ2xpY2suY2FsbChfdGhpcywgaXQpOwogICAgfSk7CiAgICB0aGlzLmRhdGVwaWNrZXIgPSBuZXcgRGF0ZXBpY2tlcigpOwogICAgdGhpcy5kYXRlcGlja2VyLmNoYW5nZShmdW5jdGlvbiAoZCkgewogICAgICAvLyBjb25zb2xlLmxvZygnZDonLCBkKTsKICAgICAgX3RoaXMuc2V0VGV4dChkYXRlRm9ybWF0KGQpKTsKCiAgICAgIF90aGlzLmNsZWFyKCk7CiAgICB9KTsKICAgIHRoaXMuYXJlYUVsID0gaCgnZGl2JywgIiIuY29uY2F0KGNzc1ByZWZpeCwgIi1lZGl0b3ItYXJlYSIpKS5jaGlsZHJlbih0aGlzLnRleHRFbCA9IGgoJ3RleHRhcmVhJywgJycpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgcmV0dXJuIGlucHV0RXZlbnRIYW5kbGVyLmNhbGwoX3RoaXMsIGV2dCk7CiAgICB9KS5vbigncGFzdGUuc3RvcCcsIGZ1bmN0aW9uICgpIHt9KS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgcmV0dXJuIGtleWRvd25FdmVudEhhbmRsZXIuY2FsbChfdGhpcywgZXZ0KTsKICAgIH0pLCB0aGlzLnRleHRsaW5lRWwgPSBoKCdkaXYnLCAndGV4dGxpbmUnKSwgdGhpcy5zdWdnZXN0LmVsLCB0aGlzLmRhdGVwaWNrZXIuZWwpLm9uKCdtb3VzZW1vdmUuc3RvcCcsIGZ1bmN0aW9uICgpIHt9KS5vbignbW91c2Vkb3duLnN0b3AnLCBmdW5jdGlvbiAoKSB7fSk7CiAgICB0aGlzLmVsID0gaCgnZGl2JywgIiIuY29uY2F0KGNzc1ByZWZpeCwgIi1lZGl0b3IiKSkuY2hpbGQodGhpcy5hcmVhRWwpLmhpZGUoKTsKICAgIHRoaXMuc3VnZ2VzdC5iaW5kSW5wdXRFdmVudHModGhpcy50ZXh0RWwpOwogICAgdGhpcy5hcmVhT2Zmc2V0ID0gbnVsbDsKICAgIHRoaXMuZnJlZXplID0gewogICAgICB3OiAwLAogICAgICBoOiAwCiAgICB9OwogICAgdGhpcy5jZWxsID0gbnVsbDsKICAgIHRoaXMuaW5wdXRUZXh0ID0gJyc7CgogICAgdGhpcy5jaGFuZ2UgPSBmdW5jdGlvbiAoKSB7fTsKICB9CgogIF9jcmVhdGVDbGFzcyhFZGl0b3IsIFt7CiAgICBrZXk6ICJzZXRGcmVlemVMZW5ndGhzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGcmVlemVMZW5ndGhzKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgdGhpcy5mcmVlemUudyA9IHdpZHRoOwogICAgICB0aGlzLmZyZWV6ZS5oID0gaGVpZ2h0OwogICAgfQogIH0sIHsKICAgIGtleTogImNsZWFyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgLy8gY29uc3QgeyBjZWxsIH0gPSB0aGlzOwogICAgICAvLyBjb25zdCBjZWxsVGV4dCA9IChjZWxsICYmIGNlbGwudGV4dCkgfHwgJyc7CiAgICAgIGlmICh0aGlzLmlucHV0VGV4dCAhPT0gJycpIHsKICAgICAgICB0aGlzLmNoYW5nZSgnZmluaXNoZWQnLCB0aGlzLmlucHV0VGV4dCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2VsbCA9IG51bGw7CiAgICAgIHRoaXMuYXJlYU9mZnNldCA9IG51bGw7CiAgICAgIHRoaXMuaW5wdXRUZXh0ID0gJyc7CiAgICAgIHRoaXMuZWwuaGlkZSgpOwogICAgICB0aGlzLnRleHRFbC52YWwoJycpOwogICAgICB0aGlzLnRleHRsaW5lRWwuaHRtbCgnJyk7CiAgICAgIHJlc2V0U3VnZ2VzdEl0ZW1zLmNhbGwodGhpcyk7CiAgICAgIHRoaXMuZGF0ZXBpY2tlci5oaWRlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0T2Zmc2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPZmZzZXQob2Zmc2V0KSB7CiAgICAgIHZhciBzdWdnZXN0UG9zaXRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICd0b3AnOwogICAgICB2YXIgdGV4dEVsID0gdGhpcy50ZXh0RWwsCiAgICAgICAgICBhcmVhRWwgPSB0aGlzLmFyZWFFbCwKICAgICAgICAgIHN1Z2dlc3QgPSB0aGlzLnN1Z2dlc3QsCiAgICAgICAgICBmcmVlemUgPSB0aGlzLmZyZWV6ZSwKICAgICAgICAgIGVsID0gdGhpcy5lbDsKCiAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICB0aGlzLmFyZWFPZmZzZXQgPSBvZmZzZXQ7CiAgICAgICAgdmFyIGxlZnQgPSBvZmZzZXQubGVmdCwKICAgICAgICAgICAgdG9wID0gb2Zmc2V0LnRvcCwKICAgICAgICAgICAgd2lkdGggPSBvZmZzZXQud2lkdGgsCiAgICAgICAgICAgIGhlaWdodCA9IG9mZnNldC5oZWlnaHQsCiAgICAgICAgICAgIGwgPSBvZmZzZXQubCwKICAgICAgICAgICAgdCA9IG9mZnNldC50OyAvLyBjb25zb2xlLmxvZygnbGVmdDonLCBsZWZ0LCAnLHRvcDonLCB0b3AsICcsIGZyZWV6ZTonLCBmcmVlemUpOwoKICAgICAgICB2YXIgZWxPZmZzZXQgPSB7CiAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgdG9wOiAwCiAgICAgICAgfTsgLy8gdG9wIGxlZnQKCiAgICAgICAgaWYgKGZyZWV6ZS53ID4gbCAmJiBmcmVlemUuaCA+IHQpIHsvLwogICAgICAgIH0gZWxzZSBpZiAoZnJlZXplLncgPCBsICYmIGZyZWV6ZS5oIDwgdCkgewogICAgICAgICAgZWxPZmZzZXQubGVmdCA9IGZyZWV6ZS53OwogICAgICAgICAgZWxPZmZzZXQudG9wID0gZnJlZXplLmg7CiAgICAgICAgfSBlbHNlIGlmIChmcmVlemUudyA+IGwpIHsKICAgICAgICAgIGVsT2Zmc2V0LnRvcCA9IGZyZWV6ZS5oOwogICAgICAgIH0gZWxzZSBpZiAoZnJlZXplLmggPiB0KSB7CiAgICAgICAgICBlbE9mZnNldC5sZWZ0ID0gZnJlZXplLnc7CiAgICAgICAgfQoKICAgICAgICBlbC5vZmZzZXQoZWxPZmZzZXQpOwogICAgICAgIGFyZWFFbC5vZmZzZXQoewogICAgICAgICAgbGVmdDogbGVmdCAtIGVsT2Zmc2V0LmxlZnQgLSAwLjgsCiAgICAgICAgICB0b3A6IHRvcCAtIGVsT2Zmc2V0LnRvcCAtIDAuOAogICAgICAgIH0pOwogICAgICAgIHRleHRFbC5vZmZzZXQoewogICAgICAgICAgd2lkdGg6IHdpZHRoIC0gOSArIDAuOCwKICAgICAgICAgIGhlaWdodDogaGVpZ2h0IC0gMyArIDAuOAogICAgICAgIH0pOwogICAgICAgIHZhciBzT2Zmc2V0ID0gewogICAgICAgICAgbGVmdDogMAogICAgICAgIH07CiAgICAgICAgc09mZnNldFtzdWdnZXN0UG9zaXRpb25dID0gaGVpZ2h0OwogICAgICAgIHN1Z2dlc3Quc2V0T2Zmc2V0KHNPZmZzZXQpOwogICAgICAgIHN1Z2dlc3QuaGlkZSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Q2VsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2VsbChjZWxsLCB2YWxpZGF0b3IpIHsKICAgICAgLy8gY29uc29sZS5sb2coJzo6JywgdmFsaWRhdG9yKTsKICAgICAgdmFyIGVsID0gdGhpcy5lbCwKICAgICAgICAgIGRhdGVwaWNrZXIgPSB0aGlzLmRhdGVwaWNrZXIsCiAgICAgICAgICBzdWdnZXN0ID0gdGhpcy5zdWdnZXN0OwogICAgICBlbC5zaG93KCk7CiAgICAgIHRoaXMuY2VsbCA9IGNlbGw7CiAgICAgIHZhciB0ZXh0ID0gY2VsbCAmJiBjZWxsLnRleHQgfHwgJyc7CiAgICAgIHRoaXMuc2V0VGV4dCh0ZXh0KTsKICAgICAgdGhpcy52YWxpZGF0b3IgPSB2YWxpZGF0b3I7CgogICAgICBpZiAodmFsaWRhdG9yKSB7CiAgICAgICAgdmFyIHR5cGUgPSB2YWxpZGF0b3IudHlwZTsKCiAgICAgICAgaWYgKHR5cGUgPT09ICdkYXRlJykgewogICAgICAgICAgZGF0ZXBpY2tlci5zaG93KCk7CgogICAgICAgICAgaWYgKCEvXlxzKiQvLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgZGF0ZXBpY2tlci5zZXRWYWx1ZSh0ZXh0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0eXBlID09PSAnbGlzdCcpIHsKICAgICAgICAgIHN1Z2dlc3Quc2V0SXRlbXModmFsaWRhdG9yLnZhbHVlcygpKTsKICAgICAgICAgIHN1Z2dlc3Quc2VhcmNoKCcnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRUZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUZXh0KHRleHQpIHsKICAgICAgdGhpcy5pbnB1dFRleHQgPSB0ZXh0OyAvLyBjb25zb2xlLmxvZygndGV4dD4+OicsIHRleHQpOwoKICAgICAgX3NldFRleHQuY2FsbCh0aGlzLCB0ZXh0LCB0ZXh0Lmxlbmd0aCk7CgogICAgICByZXNldFRleHRhcmVhU2l6ZS5jYWxsKHRoaXMpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEVkaXRvcjsKfSgpOwoKZXhwb3J0IHsgRWRpdG9yIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["C:/Users/吴建明/Desktop/VisualizationExcle_Demo/src/components/x-spreadsheet/component/editor.js"],"names":["h","Suggest","Datepicker","cssPrefix","resetTextareaSize","inputText","test","textlineEl","textEl","areaOffset","txts","split","maxTxtSize","Math","max","map","it","length","tlOffset","offset","fontWidth","width","tlineWidth","maxWidth","viewFn","left","h1","twidth","parseInt","css","rowHeight","height","insertText","itxt","target","value","selectionEnd","ntxt","slice","setSelectionRange","html","call","keydownEventHandler","evt","keyCode","altKey","stopPropagation","preventDefault","inputEventHandler","v","suggest","validator","cell","editable","undefined","type","search","hide","start","lastIndexOf","substring","change","setTextareaRange","position","el","setTimeout","focus","setText","text","blur","val","suggestItemClick","sit","eit","indexOf","key","resetSuggestItems","setItems","formulas","dateFormat","d","month","getMonth","date","getDate","getFullYear","Editor","datepicker","clear","areaEl","children","on","child","bindInputEvents","freeze","w","suggestPosition","top","l","t","elOffset","sOffset","setOffset","show","setValue","values"],"mappings":"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","sourcesContent":["//* global window */\r\nimport { h } from './element';\r\nimport Suggest from './suggest';\r\nimport Datepicker from './datepicker';\r\nimport { cssPrefix } from '../config';\r\n// import { mouseMoveUp } from '../event';\r\n\r\nfunction resetTextareaSize() {\r\n  const { inputText } = this;\r\n  if (!/^\\s*$/.test(inputText)) {\r\n    const {\r\n      textlineEl, textEl, areaOffset,\r\n    } = this;\r\n    const txts = inputText.split('\\n');\r\n    const maxTxtSize = Math.max(...txts.map(it => it.length));\r\n    const tlOffset = textlineEl.offset();\r\n    const fontWidth = tlOffset.width / inputText.length;\r\n    const tlineWidth = (maxTxtSize + 1) * fontWidth + 5;\r\n    const maxWidth = this.viewFn().width - areaOffset.left - fontWidth;\r\n    let h1 = txts.length;\r\n    if (tlineWidth > areaOffset.width) {\r\n      let twidth = tlineWidth;\r\n      if (tlineWidth > maxWidth) {\r\n        twidth = maxWidth;\r\n        h1 += parseInt(tlineWidth / maxWidth, 10);\r\n        h1 += (tlineWidth % maxWidth) > 0 ? 1 : 0;\r\n      }\r\n      textEl.css('width', `${twidth}px`);\r\n    }\r\n    h1 *= this.rowHeight;\r\n    if (h1 > areaOffset.height) {\r\n      textEl.css('height', `${h1}px`);\r\n    }\r\n  }\r\n}\r\n\r\nfunction insertText({ target }, itxt) {\r\n  const { value, selectionEnd } = target;\r\n  const ntxt = `${value.slice(0, selectionEnd)}${itxt}${value.slice(selectionEnd)}`;\r\n  target.value = ntxt;\r\n  target.setSelectionRange(selectionEnd + 1, selectionEnd + 1);\r\n\r\n  this.inputText = ntxt;\r\n  this.textlineEl.html(ntxt);\r\n  resetTextareaSize.call(this);\r\n}\r\n\r\nfunction keydownEventHandler(evt) {\r\n  const { keyCode, altKey } = evt;\r\n  if (keyCode !== 13 && keyCode !== 9) evt.stopPropagation();\r\n  if (keyCode === 13 && altKey) {\r\n    insertText.call(this, evt, '\\n');\r\n    evt.stopPropagation();\r\n  }\r\n  if (keyCode === 13 && !altKey) evt.preventDefault();\r\n}\r\n\r\nfunction inputEventHandler(evt) {\r\n  const v = evt.target.value;\r\n  // console.log(evt, 'v:', v);\r\n  const { suggest, textlineEl, validator } = this;\r\n  const { cell } = this;\r\n  if (cell !== null) {\r\n    if (('editable' in cell && cell.editable === true) || (cell.editable === undefined)) {\r\n      this.inputText = v;\r\n      if (validator) {\r\n        if (validator.type === 'list') {\r\n          suggest.search(v);\r\n        } else {\r\n          suggest.hide();\r\n        }\r\n      } else {\r\n        const start = v.lastIndexOf('=');\r\n        if (start !== -1) {\r\n          suggest.search(v.substring(start + 1));\r\n        } else {\r\n          suggest.hide();\r\n        }\r\n      }\r\n      textlineEl.html(v);\r\n      resetTextareaSize.call(this);\r\n      this.change('input', v);\r\n    } else {\r\n      evt.target.value = '';\r\n    }\r\n  } else {\r\n    this.inputText = v;\r\n    if (validator) {\r\n      if (validator.type === 'list') {\r\n        suggest.search(v);\r\n      } else {\r\n        suggest.hide();\r\n      }\r\n    } else {\r\n      const start = v.lastIndexOf('=');\r\n      if (start !== -1) {\r\n        suggest.search(v.substring(start + 1));\r\n      } else {\r\n        suggest.hide();\r\n      }\r\n    }\r\n    textlineEl.html(v);\r\n    resetTextareaSize.call(this);\r\n    this.change('input', v);\r\n  }\r\n}\r\n\r\nfunction setTextareaRange(position) {\r\n  const { el } = this.textEl;\r\n  setTimeout(() => {\r\n    el.focus();\r\n    el.setSelectionRange(position, position);\r\n  }, 0);\r\n}\r\n\r\nfunction setText(text, position) {\r\n  const { textEl, textlineEl } = this;\r\n  // firefox bug\r\n  textEl.el.blur();\r\n\r\n  textEl.val(text);\r\n  textlineEl.html(text);\r\n  setTextareaRange.call(this, position);\r\n}\r\n\r\nfunction suggestItemClick(it) {\r\n  const { inputText, validator } = this;\r\n  let position = 0;\r\n  if (validator && validator.type === 'list') {\r\n    this.inputText = it;\r\n    position = this.inputText.length;\r\n  } else {\r\n    const start = inputText.lastIndexOf('=');\r\n    const sit = inputText.substring(0, start + 1);\r\n    let eit = inputText.substring(start + 1);\r\n    if (eit.indexOf(')') !== -1) {\r\n      eit = eit.substring(eit.indexOf(')'));\r\n    } else {\r\n      eit = '';\r\n    }\r\n    this.inputText = `${sit + it.key}(`;\r\n    // console.log('inputText:', this.inputText);\r\n    position = this.inputText.length;\r\n    this.inputText += `)${eit}`;\r\n  }\r\n  setText.call(this, this.inputText, position);\r\n}\r\n\r\nfunction resetSuggestItems() {\r\n  this.suggest.setItems(this.formulas);\r\n}\r\n\r\nfunction dateFormat(d) {\r\n  let month = d.getMonth() + 1;\r\n  let date = d.getDate();\r\n  if (month < 10) month = `0${month}`;\r\n  if (date < 10) date = `0${date}`;\r\n  return `${d.getFullYear()}-${month}-${date}`;\r\n}\r\n\r\nexport default class Editor {\r\n  constructor(formulas, viewFn, rowHeight) {\r\n    this.viewFn = viewFn;\r\n    this.rowHeight = rowHeight;\r\n    this.formulas = formulas;\r\n    this.suggest = new Suggest(formulas, (it) => {\r\n      suggestItemClick.call(this, it);\r\n    });\r\n    this.datepicker = new Datepicker();\r\n    this.datepicker.change((d) => {\r\n      // console.log('d:', d);\r\n      this.setText(dateFormat(d));\r\n      this.clear();\r\n    });\r\n    this.areaEl = h('div', `${cssPrefix}-editor-area`)\r\n      .children(\r\n        this.textEl = h('textarea', '')\r\n          .on('input', evt => inputEventHandler.call(this, evt))\r\n          .on('paste.stop', () => {})\r\n          .on('keydown', evt => keydownEventHandler.call(this, evt)),\r\n        this.textlineEl = h('div', 'textline'),\r\n        this.suggest.el,\r\n        this.datepicker.el,\r\n      )\r\n      .on('mousemove.stop', () => {})\r\n      .on('mousedown.stop', () => {});\r\n    this.el = h('div', `${cssPrefix}-editor`)\r\n      .child(this.areaEl).hide();\r\n    this.suggest.bindInputEvents(this.textEl);\r\n\r\n    this.areaOffset = null;\r\n    this.freeze = { w: 0, h: 0 };\r\n    this.cell = null;\r\n    this.inputText = '';\r\n    this.change = () => {};\r\n  }\r\n\r\n  setFreezeLengths(width, height) {\r\n    this.freeze.w = width;\r\n    this.freeze.h = height;\r\n  }\r\n\r\n  clear() {\r\n    // const { cell } = this;\r\n    // const cellText = (cell && cell.text) || '';\r\n    if (this.inputText !== '') {\r\n      this.change('finished', this.inputText);\r\n    }\r\n    this.cell = null;\r\n    this.areaOffset = null;\r\n    this.inputText = '';\r\n    this.el.hide();\r\n    this.textEl.val('');\r\n    this.textlineEl.html('');\r\n    resetSuggestItems.call(this);\r\n    this.datepicker.hide();\r\n  }\r\n\r\n  setOffset(offset, suggestPosition = 'top') {\r\n    const {\r\n      textEl, areaEl, suggest, freeze, el,\r\n    } = this;\r\n    if (offset) {\r\n      this.areaOffset = offset;\r\n      const {\r\n        left, top, width, height, l, t,\r\n      } = offset;\r\n      // console.log('left:', left, ',top:', top, ', freeze:', freeze);\r\n      const elOffset = { left: 0, top: 0 };\r\n      // top left\r\n      if (freeze.w > l && freeze.h > t) {\r\n        //\r\n      } else if (freeze.w < l && freeze.h < t) {\r\n        elOffset.left = freeze.w;\r\n        elOffset.top = freeze.h;\r\n      } else if (freeze.w > l) {\r\n        elOffset.top = freeze.h;\r\n      } else if (freeze.h > t) {\r\n        elOffset.left = freeze.w;\r\n      }\r\n      el.offset(elOffset);\r\n      areaEl.offset({ left: left - elOffset.left - 0.8, top: top - elOffset.top - 0.8 });\r\n      textEl.offset({ width: width - 9 + 0.8, height: height - 3 + 0.8 });\r\n      const sOffset = { left: 0 };\r\n      sOffset[suggestPosition] = height;\r\n      suggest.setOffset(sOffset);\r\n      suggest.hide();\r\n    }\r\n  }\r\n\r\n  setCell(cell, validator) {\r\n    // console.log('::', validator);\r\n    const { el, datepicker, suggest } = this;\r\n    el.show();\r\n    this.cell = cell;\r\n    const text = (cell && cell.text) || '';\r\n    this.setText(text);\r\n\r\n    this.validator = validator;\r\n    if (validator) {\r\n      const { type } = validator;\r\n      if (type === 'date') {\r\n        datepicker.show();\r\n        if (!/^\\s*$/.test(text)) {\r\n          datepicker.setValue(text);\r\n        }\r\n      }\r\n      if (type === 'list') {\r\n        suggest.setItems(validator.values());\r\n        suggest.search('');\r\n      }\r\n    }\r\n  }\r\n\r\n  setText(text) {\r\n    this.inputText = text;\r\n    // console.log('text>>:', text);\r\n    setText.call(this, text, text.length);\r\n    resetTextareaSize.call(this);\r\n  }\r\n}\r\n"]}]}