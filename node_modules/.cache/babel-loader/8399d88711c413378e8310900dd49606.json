{"remainingRequest":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\core\\cell.js","dependencies":[{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\core\\cell.js","mtime":1615364198218},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615364186494},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1615364186192},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js","mtime":1615364189991}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkM6L1VzZXJzL1x1NTQzNFx1NUVGQVx1NjYwRS9EZXNrdG9wL1Zpc3VhbGl6YXRpb25FeGNsZV9EZW1vL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5pcy1zYWZlLWludGVnZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcy5qcyI7CmltcG9ydCB7IGV4cHIyeHksIHh5MmV4cHIgfSBmcm9tICcuL2FscGhhYmV0JzsKaW1wb3J0IHsgbnVtYmVyQ2FsYyB9IGZyb20gJy4vaGVscGVyJzsgLy8gQ29udmVydGluZyBpbmZpeCBleHByZXNzaW9uIHRvIGEgc3VmZml4IGV4cHJlc3Npb24KLy8gc3JjOiBBVkVSQUdFKFNVTShBMSxBMiksIEIxKSArIDUwICsgQjIwCi8vIHJldHVybjogW0ExLCBBMl0sIFNVTVssIEIxXSxBVkVSQUdFLDUwLCssQjIwLCsKCnZhciBpbmZpeEV4cHJUb1N1ZmZpeEV4cHIgPSBmdW5jdGlvbiBpbmZpeEV4cHJUb1N1ZmZpeEV4cHIoc3JjKSB7CiAgdmFyIG9wZXJhdG9yU3RhY2sgPSBbXTsKICB2YXIgc3RhY2sgPSBbXTsKICB2YXIgc3ViU3RycyA9IFtdOyAvLyBTVU0sIEExLCBCMiwgNTAgLi4uCgogIHZhciBmbkFyZ1R5cGUgPSAwOyAvLyAxID0+ICwgMiA9PiA6CgogIHZhciBmbkFyZ09wZXJhdG9yID0gJyc7CiAgdmFyIGZuQXJnc0xlbiA9IDE7IC8vIEExLEEyLEEzLi4uCgogIHZhciBvbGRjID0gJyc7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgc3JjLmxlbmd0aDsgaSArPSAxKSB7CiAgICB2YXIgYyA9IHNyYy5jaGFyQXQoaSk7CgogICAgaWYgKGMgIT09ICcgJykgewogICAgICBpZiAoYyA+PSAnYScgJiYgYyA8PSAneicpIHsKICAgICAgICBzdWJTdHJzLnB1c2goYy50b1VwcGVyQ2FzZSgpKTsKICAgICAgfSBlbHNlIGlmIChjID49ICcwJyAmJiBjIDw9ICc5JyB8fCBjID49ICdBJyAmJiBjIDw9ICdaJyB8fCBjID09PSAnLicpIHsKICAgICAgICBzdWJTdHJzLnB1c2goYyk7CiAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJyInKSB7CiAgICAgICAgaSArPSAxOwoKICAgICAgICB3aGlsZSAoc3JjLmNoYXJBdChpKSAhPT0gJyInKSB7CiAgICAgICAgICBzdWJTdHJzLnB1c2goc3JjLmNoYXJBdChpKSk7CiAgICAgICAgICBpICs9IDE7CiAgICAgICAgfQoKICAgICAgICBzdGFjay5wdXNoKCJcIiIuY29uY2F0KHN1YlN0cnMuam9pbignJykpKTsKICAgICAgICBzdWJTdHJzID0gW107CiAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJy0nICYmIC9bK1wtKi8sKF0vLnRlc3Qob2xkYykpIHsKICAgICAgICBzdWJTdHJzLnB1c2goYyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3N1YlN0cnM6Jywgc3ViU3Rycy5qb2luKCcnKSwgc3RhY2spOwogICAgICAgIGlmIChjICE9PSAnKCcgJiYgc3ViU3Rycy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBzdGFjay5wdXNoKHN1YlN0cnMuam9pbignJykpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGMgPT09ICcpJykgewogICAgICAgICAgdmFyIGMxID0gb3BlcmF0b3JTdGFjay5wb3AoKTsKCiAgICAgICAgICBpZiAoZm5BcmdUeXBlID09PSAyKSB7CiAgICAgICAgICAgIC8vIGZuIGFyZ3VtZW50IHJhbmdlID0+IEExOkI1CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIF9leHByMnh5ID0gZXhwcjJ4eShzdGFjay5wb3AoKSksCiAgICAgICAgICAgICAgICAgIF9leHByMnh5MiA9IF9zbGljZWRUb0FycmF5KF9leHByMnh5LCAyKSwKICAgICAgICAgICAgICAgICAgZXggPSBfZXhwcjJ4eTJbMF0sCiAgICAgICAgICAgICAgICAgIGV5ID0gX2V4cHIyeHkyWzFdOwoKICAgICAgICAgICAgICB2YXIgX2V4cHIyeHkzID0gZXhwcjJ4eShzdGFjay5wb3AoKSksCiAgICAgICAgICAgICAgICAgIF9leHByMnh5NCA9IF9zbGljZWRUb0FycmF5KF9leHByMnh5MywgMiksCiAgICAgICAgICAgICAgICAgIHN4ID0gX2V4cHIyeHk0WzBdLAogICAgICAgICAgICAgICAgICBzeSA9IF9leHByMnh5NFsxXTsgLy8gY29uc29sZS5sb2coJzo6Jywgc3gsIHN5LCBleCwgZXkpOwoKCiAgICAgICAgICAgICAgdmFyIHJhbmdlbGVuID0gMDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IHN4OyB4IDw9IGV4OyB4ICs9IDEpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIHkgPSBzeTsgeSA8PSBleTsgeSArPSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goeHkyZXhwcih4LCB5KSk7CiAgICAgICAgICAgICAgICAgIHJhbmdlbGVuICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdGFjay5wdXNoKFtjMSwgcmFuZ2VsZW5dKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgey8vIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGZuQXJnVHlwZSA9PT0gMSB8fCBmbkFyZ1R5cGUgPT09IDMpIHsKICAgICAgICAgICAgaWYgKGZuQXJnVHlwZSA9PT0gMykgc3RhY2sucHVzaChmbkFyZ09wZXJhdG9yKTsgLy8gZm4gYXJndW1lbnQgPT4gQTEsQTIsQjUKCiAgICAgICAgICAgIHN0YWNrLnB1c2goW2MxLCBmbkFyZ3NMZW5dKTsKICAgICAgICAgICAgZm5BcmdzTGVuID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdjMTonLCBjMSwgZm5BcmdUeXBlLCBzdGFjaywgb3BlcmF0b3JTdGFjayk7CiAgICAgICAgICAgIHdoaWxlIChjMSAhPT0gJygnKSB7CiAgICAgICAgICAgICAgc3RhY2sucHVzaChjMSk7CiAgICAgICAgICAgICAgaWYgKG9wZXJhdG9yU3RhY2subGVuZ3RoIDw9IDApIGJyZWFrOwogICAgICAgICAgICAgIGMxID0gb3BlcmF0b3JTdGFjay5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZuQXJnVHlwZSA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChjID09PSAnPScgfHwgYyA9PT0gJz4nIHx8IGMgPT09ICc8JykgewogICAgICAgICAgdmFyIG5jID0gc3JjLmNoYXJBdChpICsgMSk7CiAgICAgICAgICBmbkFyZ09wZXJhdG9yID0gYzsKCiAgICAgICAgICBpZiAobmMgPT09ICc9JyB8fCBuYyA9PT0gJy0nKSB7CiAgICAgICAgICAgIGZuQXJnT3BlcmF0b3IgKz0gbmM7CiAgICAgICAgICAgIGkgKz0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICBmbkFyZ1R5cGUgPSAzOwogICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJzonKSB7CiAgICAgICAgICBmbkFyZ1R5cGUgPSAyOwogICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJywnKSB7CiAgICAgICAgICBpZiAoZm5BcmdUeXBlID09PSAzKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goZm5BcmdPcGVyYXRvcik7CiAgICAgICAgICB9CgogICAgICAgICAgZm5BcmdUeXBlID0gMTsKICAgICAgICAgIGZuQXJnc0xlbiArPSAxOwogICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJygnICYmIHN1YlN0cnMubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8gZnVuY3Rpb24KICAgICAgICAgIG9wZXJhdG9yU3RhY2sucHVzaChzdWJTdHJzLmpvaW4oJycpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gcHJpb3JpdHk6ICovID4gKy0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd4eHh4OicsIG9wZXJhdG9yU3RhY2ssIGMsIHN0YWNrKTsKICAgICAgICAgIGlmIChvcGVyYXRvclN0YWNrLmxlbmd0aCA+IDAgJiYgKGMgPT09ICcrJyB8fCBjID09PSAnLScpKSB7CiAgICAgICAgICAgIHZhciB0b3AgPSBvcGVyYXRvclN0YWNrW29wZXJhdG9yU3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGlmICh0b3AgIT09ICcoJykgc3RhY2sucHVzaChvcGVyYXRvclN0YWNrLnBvcCgpKTsKCiAgICAgICAgICAgIGlmICh0b3AgPT09ICcqJyB8fCB0b3AgPT09ICcvJykgewogICAgICAgICAgICAgIHdoaWxlIChvcGVyYXRvclN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHRvcCA9IG9wZXJhdG9yU3RhY2tbb3BlcmF0b3JTdGFjay5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGlmICh0b3AgIT09ICcoJykgc3RhY2sucHVzaChvcGVyYXRvclN0YWNrLnBvcCgpKTtlbHNlIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRvclN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIF90b3AgPSBvcGVyYXRvclN0YWNrW29wZXJhdG9yU3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGlmIChfdG9wID09PSAnKicgfHwgX3RvcCA9PT0gJy8nKSBzdGFjay5wdXNoKG9wZXJhdG9yU3RhY2sucG9wKCkpOwogICAgICAgICAgfQoKICAgICAgICAgIG9wZXJhdG9yU3RhY2sucHVzaChjKTsKICAgICAgICB9CgogICAgICAgIHN1YlN0cnMgPSBbXTsKICAgICAgfQoKICAgICAgb2xkYyA9IGM7CiAgICB9CiAgfQoKICBpZiAoc3ViU3Rycy5sZW5ndGggPiAwKSB7CiAgICBzdGFjay5wdXNoKHN1YlN0cnMuam9pbignJykpOwogIH0KCiAgd2hpbGUgKG9wZXJhdG9yU3RhY2subGVuZ3RoID4gMCkgewogICAgc3RhY2sucHVzaChvcGVyYXRvclN0YWNrLnBvcCgpKTsKICB9CgogIHJldHVybiBzdGFjazsKfTsKCnZhciBldmFsU3ViRXhwciA9IGZ1bmN0aW9uIGV2YWxTdWJFeHByKHN1YkV4cHIsIGNlbGxSZW5kZXIpIHsKICB2YXIgX3N1YkV4cHIgPSBfc2xpY2VkVG9BcnJheShzdWJFeHByLCAxKSwKICAgICAgZmwgPSBfc3ViRXhwclswXTsKCiAgdmFyIGV4cHIgPSBzdWJFeHByOwoKICBpZiAoZmwgPT09ICciJykgewogICAgcmV0dXJuIHN1YkV4cHIuc3Vic3RyaW5nKDEpOwogIH0KCiAgdmFyIHJldCA9IDE7CgogIGlmIChmbCA9PT0gJy0nKSB7CiAgICBleHByID0gc3ViRXhwci5zdWJzdHJpbmcoMSk7CiAgICByZXQgPSAtMTsKICB9CgogIGlmIChleHByWzBdID49ICcwJyAmJiBleHByWzBdIDw9ICc5JykgewogICAgcmV0dXJuIHJldCAqIE51bWJlcihleHByKTsKICB9CgogIHZhciBfZXhwcjJ4eTUgPSBleHByMnh5KGV4cHIpLAogICAgICBfZXhwcjJ4eTYgPSBfc2xpY2VkVG9BcnJheShfZXhwcjJ4eTUsIDIpLAogICAgICB4ID0gX2V4cHIyeHk2WzBdLAogICAgICB5ID0gX2V4cHIyeHk2WzFdOwoKICByZXR1cm4gcmV0ICogY2VsbFJlbmRlcih4LCB5KTsKfTsgLy8gZXZhbHVhdGUgdGhlIHN1ZmZpeCBleHByZXNzaW9uCi8vIHNyY1N0YWNrOiA8PSBpbmZpeEV4cHJUb1N1Zml4RXhwcgovLyBmb3JtdWxhTWFwOiB7J1NVTSc6IHt9LCAuLi59Ci8vIGNlbGxSZW5kZXI6ICh4LCB5KSA9PiB7fQoKCnZhciBldmFsU3VmZml4RXhwciA9IGZ1bmN0aW9uIGV2YWxTdWZmaXhFeHByKHNyY1N0YWNrLCBmb3JtdWxhTWFwLCBjZWxsUmVuZGVyLCBjZWxsTGlzdCkgewogIHZhciBzdGFjayA9IFtdOyAvLyBjb25zb2xlLmxvZygnOjo6Ojpmb3JtdWxhTWFwOicsIGZvcm11bGFNYXApOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHNyY1N0YWNrLmxlbmd0aDsgaSArPSAxKSB7CiAgICAvLyBjb25zb2xlLmxvZygnOjo6Pj4+Jywgc3JjU3RhY2tbaV0pOwogICAgdmFyIGV4cHIgPSBzcmNTdGFja1tpXTsKICAgIHZhciBmYyA9IGV4cHJbMF07CgogICAgaWYgKGV4cHIgPT09ICcrJykgewogICAgICB2YXIgdG9wID0gc3RhY2sucG9wKCk7CiAgICAgIHN0YWNrLnB1c2gobnVtYmVyQ2FsYygnKycsIHN0YWNrLnBvcCgpLCB0b3ApKTsKICAgIH0gZWxzZSBpZiAoZXhwciA9PT0gJy0nKSB7CiAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDEpIHsKICAgICAgICB2YXIgX3RvcDIgPSBzdGFjay5wb3AoKTsKCiAgICAgICAgc3RhY2sucHVzaChudW1iZXJDYWxjKCcqJywgX3RvcDIsIC0xKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF90b3AzID0gc3RhY2sucG9wKCk7CgogICAgICAgIHN0YWNrLnB1c2gobnVtYmVyQ2FsYygnLScsIHN0YWNrLnBvcCgpLCBfdG9wMykpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cHIgPT09ICcqJykgewogICAgICBzdGFjay5wdXNoKG51bWJlckNhbGMoJyonLCBzdGFjay5wb3AoKSwgc3RhY2sucG9wKCkpKTsKICAgIH0gZWxzZSBpZiAoZXhwciA9PT0gJy8nKSB7CiAgICAgIHZhciBfdG9wNCA9IHN0YWNrLnBvcCgpOwoKICAgICAgc3RhY2sucHVzaChudW1iZXJDYWxjKCcvJywgc3RhY2sucG9wKCksIF90b3A0KSk7CiAgICB9IGVsc2UgaWYgKGZjID09PSAnPScgfHwgZmMgPT09ICc+JyB8fCBmYyA9PT0gJzwnKSB7CiAgICAgIHZhciBfdG9wNSA9IHN0YWNrLnBvcCgpOwoKICAgICAgaWYgKCFOdW1iZXIuaXNOYU4oX3RvcDUpKSBfdG9wNSA9IE51bWJlcihfdG9wNSk7CiAgICAgIHZhciBsZWZ0ID0gc3RhY2sucG9wKCk7CiAgICAgIGlmICghTnVtYmVyLmlzTmFOKGxlZnQpKSBsZWZ0ID0gTnVtYmVyKGxlZnQpOwogICAgICB2YXIgcmV0ID0gZmFsc2U7CgogICAgICBpZiAoZmMgPT09ICc9JykgewogICAgICAgIHJldCA9IGxlZnQgPT09IF90b3A1OwogICAgICB9IGVsc2UgaWYgKGV4cHIgPT09ICc+JykgewogICAgICAgIHJldCA9IGxlZnQgPiBfdG9wNTsKICAgICAgfSBlbHNlIGlmIChleHByID09PSAnPj0nKSB7CiAgICAgICAgcmV0ID0gbGVmdCA+PSBfdG9wNTsKICAgICAgfSBlbHNlIGlmIChleHByID09PSAnPCcpIHsKICAgICAgICByZXQgPSBsZWZ0IDwgX3RvcDU7CiAgICAgIH0gZWxzZSBpZiAoZXhwciA9PT0gJzw9JykgewogICAgICAgIHJldCA9IGxlZnQgPD0gX3RvcDU7CiAgICAgIH0KCiAgICAgIHN0YWNrLnB1c2gocmV0KTsKICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShleHByKSkgewogICAgICB2YXIgX2V4cHIgPSBfc2xpY2VkVG9BcnJheShleHByLCAyKSwKICAgICAgICAgIGZvcm11bGEgPSBfZXhwclswXSwKICAgICAgICAgIGxlbiA9IF9leHByWzFdOwoKICAgICAgdmFyIHBhcmFtcyA9IFtdOwoKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBsZW47IGogKz0gMSkgewogICAgICAgIHBhcmFtcy5wdXNoKHN0YWNrLnBvcCgpKTsKICAgICAgfQoKICAgICAgc3RhY2sucHVzaChmb3JtdWxhTWFwW2Zvcm11bGFdLnJlbmRlcihwYXJhbXMucmV2ZXJzZSgpKSk7CiAgICB9IGVsc2UgewogICAgICBpZiAoY2VsbExpc3QuaW5jbHVkZXMoZXhwcikpIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQoKICAgICAgaWYgKGZjID49ICdhJyAmJiBmYyA8PSAneicgfHwgZmMgPj0gJ0EnICYmIGZjIDw9ICdaJykgewogICAgICAgIGNlbGxMaXN0LnB1c2goZXhwcik7CiAgICAgIH0KCiAgICAgIHN0YWNrLnB1c2goZXZhbFN1YkV4cHIoZXhwciwgY2VsbFJlbmRlcikpOwogICAgICBjZWxsTGlzdC5wb3AoKTsKICAgIH0gLy8gY29uc29sZS5sb2coJ3N0YWNrOicsIHN0YWNrKTsKCiAgfQoKICByZXR1cm4gc3RhY2tbMF07Cn07Cgp2YXIgY2VsbFJlbmRlciA9IGZ1bmN0aW9uIGNlbGxSZW5kZXIoc3JjLCBmb3JtdWxhTWFwLCBnZXRDZWxsVGV4dCkgewogIHZhciBjZWxsTGlzdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogW107CgogIGlmIChzcmNbMF0gPT09ICc9JykgewogICAgdmFyIHN0YWNrID0gaW5maXhFeHByVG9TdWZmaXhFeHByKHNyYy5zdWJzdHJpbmcoMSkpOwogICAgaWYgKHN0YWNrLmxlbmd0aCA8PSAwKSByZXR1cm4gc3JjOwogICAgcmV0dXJuIGV2YWxTdWZmaXhFeHByKHN0YWNrLCBmb3JtdWxhTWFwLCBmdW5jdGlvbiAoeCwgeSkgewogICAgICByZXR1cm4gY2VsbFJlbmRlcihnZXRDZWxsVGV4dCh4LCB5KSwgZm9ybXVsYU1hcCwgZ2V0Q2VsbFRleHQsIGNlbGxMaXN0KTsKICAgIH0sIGNlbGxMaXN0KTsKICB9CgogIHJldHVybiBzcmM7Cn07CgpleHBvcnQgZGVmYXVsdCB7CiAgcmVuZGVyOiBjZWxsUmVuZGVyCn07CmV4cG9ydCB7IGluZml4RXhwclRvU3VmZml4RXhwciB9Ow=="},{"version":3,"sources":["C:/Users/吴建明/Desktop/VisualizationExcle_Demo/src/components/x-spreadsheet/core/cell.js"],"names":["expr2xy","xy2expr","numberCalc","infixExprToSuffixExpr","src","operatorStack","stack","subStrs","fnArgType","fnArgOperator","fnArgsLen","oldc","i","length","c","charAt","push","toUpperCase","join","test","c1","pop","ex","ey","sx","sy","rangelen","x","y","e","nc","top","evalSubExpr","subExpr","cellRender","fl","expr","substring","ret","Number","evalSuffixExpr","srcStack","formulaMap","cellList","fc","isNaN","left","Array","isArray","formula","len","params","j","render","reverse","includes","getCellText"],"mappings":"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","sourcesContent":["import { expr2xy, xy2expr } from './alphabet';\r\nimport { numberCalc } from './helper';\r\n\r\n// Converting infix expression to a suffix expression\r\n// src: AVERAGE(SUM(A1,A2), B1) + 50 + B20\r\n// return: [A1, A2], SUM[, B1],AVERAGE,50,+,B20,+\r\nconst infixExprToSuffixExpr = (src) => {\r\n  const operatorStack = [];\r\n  const stack = [];\r\n  let subStrs = []; // SUM, A1, B2, 50 ...\r\n  let fnArgType = 0; // 1 => , 2 => :\r\n  let fnArgOperator = '';\r\n  let fnArgsLen = 1; // A1,A2,A3...\r\n  let oldc = '';\r\n  for (let i = 0; i < src.length; i += 1) {\r\n    const c = src.charAt(i);\r\n    if (c !== ' ') {\r\n      if (c >= 'a' && c <= 'z') {\r\n        subStrs.push(c.toUpperCase());\r\n      } else if ((c >= '0' && c <= '9') || (c >= 'A' && c <= 'Z') || c === '.') {\r\n        subStrs.push(c);\r\n      } else if (c === '\"') {\r\n        i += 1;\r\n        while (src.charAt(i) !== '\"') {\r\n          subStrs.push(src.charAt(i));\r\n          i += 1;\r\n        }\r\n        stack.push(`\"${subStrs.join('')}`);\r\n        subStrs = [];\r\n      } else if (c === '-' && /[+\\-*/,(]/.test(oldc)) {\r\n        subStrs.push(c);\r\n      } else {\r\n        // console.log('subStrs:', subStrs.join(''), stack);\r\n        if (c !== '(' && subStrs.length > 0) {\r\n          stack.push(subStrs.join(''));\r\n        }\r\n        if (c === ')') {\r\n          let c1 = operatorStack.pop();\r\n          if (fnArgType === 2) {\r\n            // fn argument range => A1:B5\r\n            try {\r\n              const [ex, ey] = expr2xy(stack.pop());\r\n              const [sx, sy] = expr2xy(stack.pop());\r\n              // console.log('::', sx, sy, ex, ey);\r\n              let rangelen = 0;\r\n              for (let x = sx; x <= ex; x += 1) {\r\n                for (let y = sy; y <= ey; y += 1) {\r\n                  stack.push(xy2expr(x, y));\r\n                  rangelen += 1;\r\n                }\r\n              }\r\n              stack.push([c1, rangelen]);\r\n            } catch (e) {\r\n              // console.log(e);\r\n            }\r\n          } else if (fnArgType === 1 || fnArgType === 3) {\r\n            if (fnArgType === 3) stack.push(fnArgOperator);\r\n            // fn argument => A1,A2,B5\r\n            stack.push([c1, fnArgsLen]);\r\n            fnArgsLen = 1;\r\n          } else {\r\n            // console.log('c1:', c1, fnArgType, stack, operatorStack);\r\n            while (c1 !== '(') {\r\n              stack.push(c1);\r\n              if (operatorStack.length <= 0) break;\r\n              c1 = operatorStack.pop();\r\n            }\r\n          }\r\n          fnArgType = 0;\r\n        } else if (c === '=' || c === '>' || c === '<') {\r\n          const nc = src.charAt(i + 1);\r\n          fnArgOperator = c;\r\n          if (nc === '=' || nc === '-') {\r\n            fnArgOperator += nc;\r\n            i += 1;\r\n          }\r\n          fnArgType = 3;\r\n        } else if (c === ':') {\r\n          fnArgType = 2;\r\n        } else if (c === ',') {\r\n          if (fnArgType === 3) {\r\n            stack.push(fnArgOperator);\r\n          }\r\n          fnArgType = 1;\r\n          fnArgsLen += 1;\r\n        } else if (c === '(' && subStrs.length > 0) {\r\n          // function\r\n          operatorStack.push(subStrs.join(''));\r\n        } else {\r\n          // priority: */ > +-\r\n          // console.log('xxxx:', operatorStack, c, stack);\r\n          if (operatorStack.length > 0 && (c === '+' || c === '-')) {\r\n            let top = operatorStack[operatorStack.length - 1];\r\n            if (top !== '(') stack.push(operatorStack.pop());\r\n            if (top === '*' || top === '/') {\r\n              while (operatorStack.length > 0) {\r\n                top = operatorStack[operatorStack.length - 1];\r\n                if (top !== '(') stack.push(operatorStack.pop());\r\n                else break;\r\n              }\r\n            }\r\n          } else if (operatorStack.length > 0) {\r\n            const top = operatorStack[operatorStack.length - 1];\r\n            if (top === '*' || top === '/') stack.push(operatorStack.pop());\r\n          }\r\n          operatorStack.push(c);\r\n        }\r\n        subStrs = [];\r\n      }\r\n      oldc = c;\r\n    }\r\n  }\r\n  if (subStrs.length > 0) {\r\n    stack.push(subStrs.join(''));\r\n  }\r\n  while (operatorStack.length > 0) {\r\n    stack.push(operatorStack.pop());\r\n  }\r\n  return stack;\r\n};\r\n\r\nconst evalSubExpr = (subExpr, cellRender) => {\r\n  const [fl] = subExpr;\r\n  let expr = subExpr;\r\n  if (fl === '\"') {\r\n    return subExpr.substring(1);\r\n  }\r\n  let ret = 1;\r\n  if (fl === '-') {\r\n    expr = subExpr.substring(1);\r\n    ret = -1;\r\n  }\r\n  if (expr[0] >= '0' && expr[0] <= '9') {\r\n    return ret * Number(expr);\r\n  }\r\n  const [x, y] = expr2xy(expr);\r\n  return ret * cellRender(x, y);\r\n};\r\n\r\n// evaluate the suffix expression\r\n// srcStack: <= infixExprToSufixExpr\r\n// formulaMap: {'SUM': {}, ...}\r\n// cellRender: (x, y) => {}\r\nconst evalSuffixExpr = (srcStack, formulaMap, cellRender, cellList) => {\r\n  const stack = [];\r\n  // console.log(':::::formulaMap:', formulaMap);\r\n  for (let i = 0; i < srcStack.length; i += 1) {\r\n    // console.log(':::>>>', srcStack[i]);\r\n    const expr = srcStack[i];\r\n    const fc = expr[0];\r\n    if (expr === '+') {\r\n      const top = stack.pop();\r\n      stack.push(numberCalc('+', stack.pop(), top));\r\n    } else if (expr === '-') {\r\n      if (stack.length === 1) {\r\n        const top = stack.pop();\r\n        stack.push(numberCalc('*', top, -1));\r\n      } else {\r\n        const top = stack.pop();\r\n        stack.push(numberCalc('-', stack.pop(), top));\r\n      }\r\n    } else if (expr === '*') {\r\n      stack.push(numberCalc('*', stack.pop(), stack.pop()));\r\n    } else if (expr === '/') {\r\n      const top = stack.pop();\r\n      stack.push(numberCalc('/', stack.pop(), top));\r\n    } else if (fc === '=' || fc === '>' || fc === '<') {\r\n      let top = stack.pop();\r\n      if (!Number.isNaN(top)) top = Number(top);\r\n      let left = stack.pop();\r\n      if (!Number.isNaN(left)) left = Number(left);\r\n      let ret = false;\r\n      if (fc === '=') {\r\n        ret = (left === top);\r\n      } else if (expr === '>') {\r\n        ret = (left > top);\r\n      } else if (expr === '>=') {\r\n        ret = (left >= top);\r\n      } else if (expr === '<') {\r\n        ret = (left < top);\r\n      } else if (expr === '<=') {\r\n        ret = (left <= top);\r\n      }\r\n      stack.push(ret);\r\n    } else if (Array.isArray(expr)) {\r\n      const [formula, len] = expr;\r\n      const params = [];\r\n      for (let j = 0; j < len; j += 1) {\r\n        params.push(stack.pop());\r\n      }\r\n      stack.push(formulaMap[formula].render(params.reverse()));\r\n    } else {\r\n      if (cellList.includes(expr)) {\r\n        return 0;\r\n      }\r\n      if ((fc >= 'a' && fc <= 'z') || (fc >= 'A' && fc <= 'Z')) {\r\n        cellList.push(expr);\r\n      }\r\n      stack.push(evalSubExpr(expr, cellRender));\r\n      cellList.pop();\r\n    }\r\n    // console.log('stack:', stack);\r\n  }\r\n  return stack[0];\r\n};\r\n\r\nconst cellRender = (src, formulaMap, getCellText, cellList = []) => {\r\n  if (src[0] === '=') {\r\n    const stack = infixExprToSuffixExpr(src.substring(1));\r\n    if (stack.length <= 0) return src;\r\n    return evalSuffixExpr(\r\n      stack,\r\n      formulaMap,\r\n      (x, y) => cellRender(getCellText(x, y), formulaMap, getCellText, cellList),\r\n      cellList,\r\n    );\r\n  }\r\n  return src;\r\n};\r\n\r\nexport default {\r\n  render: cellRender,\r\n};\r\nexport {\r\n  infixExprToSuffixExpr,\r\n};\r\n"]}]}