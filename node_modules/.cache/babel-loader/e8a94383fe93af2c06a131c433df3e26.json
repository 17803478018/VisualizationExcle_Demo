{"remainingRequest":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\core\\data_proxy.js","dependencies":[{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\src\\components\\x-spreadsheet\\core\\data_proxy.js","mtime":1615364198220},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615364186494},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1615364186192},{"path":"C:\\Users\\吴建明\\Desktop\\VisualizationExcle_Demo\\node_modules\\eslint-loader\\index.js","mtime":1615364189991}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJDOi9Vc2Vycy9cdTU0MzRcdTVFRkFcdTY2MEUvRGVza3RvcC9WaXN1YWxpemF0aW9uRXhjbGVfRGVtby9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkM6L1VzZXJzL1x1NTQzNFx1NUVGQVx1NjYwRS9EZXNrdG9wL1Zpc3VhbGl6YXRpb25FeGNsZV9EZW1vL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQzovVXNlcnMvXHU1NDM0XHU1RUZBXHU2NjBFL0Rlc2t0b3AvVmlzdWFsaXphdGlvbkV4Y2xlX0RlbW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkM6L1VzZXJzL1x1NTQzNFx1NUVGQVx1NjYwRS9EZXNrdG9wL1Zpc3VhbGl6YXRpb25FeGNsZV9EZW1vL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mcm9tLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CgovKiBnbG9iYWwgZG9jdW1lbnQgKi8KaW1wb3J0IFNlbGVjdG9yIGZyb20gJy4vc2VsZWN0b3InOwppbXBvcnQgU2Nyb2xsIGZyb20gJy4vc2Nyb2xsJzsKaW1wb3J0IEhpc3RvcnkgZnJvbSAnLi9oaXN0b3J5JzsKaW1wb3J0IENsaXBib2FyZCBmcm9tICcuL2NsaXBib2FyZCc7CmltcG9ydCBBdXRvRmlsdGVyIGZyb20gJy4vYXV0b19maWx0ZXInOwppbXBvcnQgeyBNZXJnZXMgfSBmcm9tICcuL21lcmdlJzsKaW1wb3J0IGhlbHBlciBmcm9tICcuL2hlbHBlcic7CmltcG9ydCB7IFJvd3MgfSBmcm9tICcuL3Jvdyc7CmltcG9ydCB7IENvbHMgfSBmcm9tICcuL2NvbCc7CmltcG9ydCB7IFZhbGlkYXRpb25zIH0gZnJvbSAnLi92YWxpZGF0aW9uJzsKaW1wb3J0IHsgQ2VsbFJhbmdlIH0gZnJvbSAnLi9jZWxsX3JhbmdlJzsKaW1wb3J0IHsgZXhwcjJ4eSwgeHkyZXhwciB9IGZyb20gJy4vYWxwaGFiZXQnOwppbXBvcnQgeyB0IH0gZnJvbSAnLi4vbG9jYWxlL2xvY2FsZSc7IC8vIHByaXZhdGUgbWV0aG9kcwoKLyoNCiAqIHsNCiAqICBuYW1lOiAnJw0KICogIGZyZWV6ZTogWzAsIDBdLA0KICogIGZvcm1hdHM6IFtdLA0KICogIHN0eWxlczogWw0KICogICAgew0KICogICAgICBiZ2NvbG9yOiAnJywNCiAqICAgICAgYWxpZ246ICcnLA0KICogICAgICB2YWxpZ246ICcnLA0KICogICAgICB0ZXh0d3JhcDogZmFsc2UsDQogKiAgICAgIHN0cmlrZTogZmFsc2UsDQogKiAgICAgIHVuZGVybGluZTogZmFsc2UsDQogKiAgICAgIGNvbG9yOiAnJywNCiAqICAgICAgZm9ybWF0OiAxLA0KICogICAgICBib3JkZXI6IHsNCiAqICAgICAgICBsZWZ0OiBbc3R5bGUsIGNvbG9yXSwNCiAqICAgICAgICByaWdodDogW3N0eWxlLCBjb2xvcl0sDQogKiAgICAgICAgdG9wOiBbc3R5bGUsIGNvbG9yXSwNCiAqICAgICAgICBib3R0b206IFtzdHlsZSwgY29sb3JdLA0KICogICAgICB9LA0KICogICAgICBmb250OiB7DQogKiAgICAgICAgbmFtZTogJ0hlbHZldGljYScsDQogKiAgICAgICAgc2l6ZTogMTAsDQogKiAgICAgICAgYm9sZDogZmFsc2UsDQogKiAgICAgICAgaXRhbGljOiBmYWxzZSwNCiAqICAgICAgfQ0KICogICAgfQ0KICogIF0sDQogKiAgbWVyZ2VzOiBbDQogKiAgICAnQTE6RjExJywNCiAqICAgIC4uLg0KICogIF0sDQogKiAgcm93czogew0KICogICAgMTogew0KICogICAgICBoZWlnaHQ6IDUwLA0KICogICAgICBzdHlsZTogMSwNCiAqICAgICAgY2VsbHM6IHsNCiAqICAgICAgICAxOiB7DQogKiAgICAgICAgICBzdHlsZTogMiwNCiAqICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLA0KICogICAgICAgICAgdGV4dDogJycsDQogKiAgICAgICAgICB2YWx1ZTogJycsIC8vIGNhbCByZXN1bHQNCiAqICAgICAgICB9DQogKiAgICAgIH0NCiAqICAgIH0sDQogKiAgICAuLi4NCiAqICB9LA0KICogIGNvbHM6IHsNCiAqICAgIDI6IHsgd2lkdGg6IDEwMCwgc3R5bGU6IDEgfQ0KICogIH0NCiAqIH0NCiAqLwoKdmFyIGRlZmF1bHRTZXR0aW5ncyA9IHsKICBtb2RlOiAnZWRpdCcsCiAgLy8gZWRpdCB8IHJlYWQKICB2aWV3OiB7CiAgICBoZWlnaHQ6IGZ1bmN0aW9uIGhlaWdodCgpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CiAgICB9LAogICAgd2lkdGg6IGZ1bmN0aW9uIHdpZHRoKCkgewogICAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwogICAgfQogIH0sCiAgc2hvd0dyaWQ6IHRydWUsCiAgc2hvd1Rvb2xiYXI6IHRydWUsCiAgc2hvd0NvbnRleHRtZW51OiB0cnVlLAogIHJvdzogewogICAgbGVuOiAxMDAsCiAgICBoZWlnaHQ6IDI1CiAgfSwKICBjb2w6IHsKICAgIGxlbjogMjYsCiAgICB3aWR0aDogMTAwLAogICAgaW5kZXhXaWR0aDogNjAsCiAgICBtaW5XaWR0aDogNjAKICB9LAogIHN0eWxlOiB7CiAgICBiZ2NvbG9yOiAnI2ZmZmZmZicsCiAgICBhbGlnbjogJ2xlZnQnLAogICAgdmFsaWduOiAnbWlkZGxlJywKICAgIHRleHR3cmFwOiBmYWxzZSwKICAgIHN0cmlrZTogZmFsc2UsCiAgICB1bmRlcmxpbmU6IGZhbHNlLAogICAgY29sb3I6ICcjMGEwYTBhJywKICAgIGZvbnQ6IHsKICAgICAgbmFtZTogJ0FyaWFsJywKICAgICAgc2l6ZTogMTAsCiAgICAgIGJvbGQ6IGZhbHNlLAogICAgICBpdGFsaWM6IGZhbHNlCiAgICB9LAogICAgZm9ybWF0OiAnbm9ybWFsJwogIH0KfTsKdmFyIHRvb2xiYXJIZWlnaHQgPSA0MTsKdmFyIGJvdHRvbWJhckhlaWdodCA9IDQxOyAvLyBzcmM6IGNlbGxSYW5nZQovLyBkc3Q6IGNlbGxSYW5nZQoKZnVuY3Rpb24gY2FuUGFzdGUoc3JjLCBkc3QpIHsKICB2YXIgZXJyb3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZ1bmN0aW9uICgpIHt9OwogIHZhciBtZXJnZXMgPSB0aGlzLm1lcmdlczsKICB2YXIgY2VsbFJhbmdlID0gZHN0LmNsb25lKCk7CgogIHZhciBfc3JjJHNpemUgPSBzcmMuc2l6ZSgpLAogICAgICBfc3JjJHNpemUyID0gX3NsaWNlZFRvQXJyYXkoX3NyYyRzaXplLCAyKSwKICAgICAgc3JuID0gX3NyYyRzaXplMlswXSwKICAgICAgc2NuID0gX3NyYyRzaXplMlsxXTsKCiAgdmFyIF9kc3Qkc2l6ZSA9IGRzdC5zaXplKCksCiAgICAgIF9kc3Qkc2l6ZTIgPSBfc2xpY2VkVG9BcnJheShfZHN0JHNpemUsIDIpLAogICAgICBkcm4gPSBfZHN0JHNpemUyWzBdLAogICAgICBkY24gPSBfZHN0JHNpemUyWzFdOwoKICBpZiAoc3JuID4gZHJuKSB7CiAgICBjZWxsUmFuZ2UuZXJpID0gZHN0LnNyaSArIHNybiAtIDE7CiAgfQoKICBpZiAoc2NuID4gZGNuKSB7CiAgICBjZWxsUmFuZ2UuZWNpID0gZHN0LnNjaSArIHNjbiAtIDE7CiAgfQoKICBpZiAobWVyZ2VzLmludGVyc2VjdHMoY2VsbFJhbmdlKSkgewogICAgZXJyb3IodCgnZXJyb3IucGFzdGVGb3JNZXJnZWRDZWxsJykpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIGNvcHlQYXN0ZShzcmNDZWxsUmFuZ2UsIGRzdENlbGxSYW5nZSwgd2hhdCkgewogIHZhciBhdXRvZmlsbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogZmFsc2U7CiAgdmFyIHJvd3MgPSB0aGlzLnJvd3MsCiAgICAgIG1lcmdlcyA9IHRoaXMubWVyZ2VzOyAvLyBkZWxldGUgZGVzdCBtZXJnZQoKICBpZiAod2hhdCA9PT0gJ2FsbCcgfHwgd2hhdCA9PT0gJ2Zvcm1hdCcpIHsKICAgIHJvd3MuZGVsZXRlQ2VsbHMoZHN0Q2VsbFJhbmdlLCB3aGF0KTsKICAgIG1lcmdlcy5kZWxldGVXaXRoaW4oZHN0Q2VsbFJhbmdlKTsKICB9CgogIHJvd3MuY29weVBhc3RlKHNyY0NlbGxSYW5nZSwgZHN0Q2VsbFJhbmdlLCB3aGF0LCBhdXRvZmlsbCwgZnVuY3Rpb24gKHJpLCBjaSwgY2VsbCkgewogICAgaWYgKGNlbGwgJiYgY2VsbC5tZXJnZSkgewogICAgICAvLyBjb25zb2xlLmxvZygnY2VsbDonLCByaSwgY2ksIGNlbGwpOwogICAgICB2YXIgX2NlbGwkbWVyZ2UgPSBfc2xpY2VkVG9BcnJheShjZWxsLm1lcmdlLCAyKSwKICAgICAgICAgIHJuID0gX2NlbGwkbWVyZ2VbMF0sCiAgICAgICAgICBjbiA9IF9jZWxsJG1lcmdlWzFdOwoKICAgICAgaWYgKHJuIDw9IDAgJiYgY24gPD0gMCkgcmV0dXJuOwogICAgICBtZXJnZXMuYWRkKG5ldyBDZWxsUmFuZ2UocmksIGNpLCByaSArIHJuLCBjaSArIGNuKSk7CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIGN1dFBhc3RlKHNyY0NlbGxSYW5nZSwgZHN0Q2VsbFJhbmdlKSB7CiAgdmFyIGNsaXBib2FyZCA9IHRoaXMuY2xpcGJvYXJkLAogICAgICByb3dzID0gdGhpcy5yb3dzLAogICAgICBtZXJnZXMgPSB0aGlzLm1lcmdlczsKICByb3dzLmN1dFBhc3RlKHNyY0NlbGxSYW5nZSwgZHN0Q2VsbFJhbmdlKTsKICBtZXJnZXMubW92ZShzcmNDZWxsUmFuZ2UsIGRzdENlbGxSYW5nZS5zcmkgLSBzcmNDZWxsUmFuZ2Uuc3JpLCBkc3RDZWxsUmFuZ2Uuc2NpIC0gc3JjQ2VsbFJhbmdlLnNjaSk7CiAgY2xpcGJvYXJkLmNsZWFyKCk7Cn0gLy8gYnNzOiB7IHRvcCwgYm90dG9tLCBsZWZ0LCByaWdodCB9CgoKZnVuY3Rpb24gc2V0U3R5bGVCb3JkZXIocmksIGNpLCBic3MpIHsKICB2YXIgc3R5bGVzID0gdGhpcy5zdHlsZXMsCiAgICAgIHJvd3MgPSB0aGlzLnJvd3M7CiAgdmFyIGNlbGwgPSByb3dzLmdldENlbGxPck5ldyhyaSwgY2kpOwogIHZhciBjc3R5bGUgPSB7fTsKCiAgaWYgKGNlbGwuc3R5bGUgIT09IHVuZGVmaW5lZCkgewogICAgY3N0eWxlID0gaGVscGVyLmNsb25lRGVlcChzdHlsZXNbY2VsbC5zdHlsZV0pOwogIH0KCiAgY3N0eWxlID0gaGVscGVyLm1lcmdlKGNzdHlsZSwgewogICAgYm9yZGVyOiBic3MKICB9KTsKICBjZWxsLnN0eWxlID0gdGhpcy5hZGRTdHlsZShjc3R5bGUpOwp9CgpmdW5jdGlvbiBzZXRTdHlsZUJvcmRlcnMoX3JlZikgewogIHZhciBfdGhpcyA9IHRoaXM7CgogIHZhciBtb2RlID0gX3JlZi5tb2RlLAogICAgICBzdHlsZSA9IF9yZWYuc3R5bGUsCiAgICAgIGNvbG9yID0gX3JlZi5jb2xvcjsKICB2YXIgc3R5bGVzID0gdGhpcy5zdHlsZXMsCiAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciwKICAgICAgcm93cyA9IHRoaXMucm93czsKICB2YXIgX3NlbGVjdG9yJHJhbmdlID0gc2VsZWN0b3IucmFuZ2UsCiAgICAgIHNyaSA9IF9zZWxlY3RvciRyYW5nZS5zcmksCiAgICAgIHNjaSA9IF9zZWxlY3RvciRyYW5nZS5zY2ksCiAgICAgIGVyaSA9IF9zZWxlY3RvciRyYW5nZS5lcmksCiAgICAgIGVjaSA9IF9zZWxlY3RvciRyYW5nZS5lY2k7CiAgdmFyIG11bHRpcGxlID0gIXRoaXMuaXNTaWdubGVTZWxlY3RlZCgpOwoKICBpZiAoIW11bHRpcGxlKSB7CiAgICBpZiAobW9kZSA9PT0gJ2luc2lkZScgfHwgbW9kZSA9PT0gJ2hvcml6b250YWwnIHx8IG1vZGUgPT09ICd2ZXJ0aWNhbCcpIHsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgaWYgKG1vZGUgPT09ICdvdXRzaWRlJyAmJiAhbXVsdGlwbGUpIHsKICAgIHNldFN0eWxlQm9yZGVyLmNhbGwodGhpcywgc3JpLCBzY2ksIHsKICAgICAgdG9wOiBbc3R5bGUsIGNvbG9yXSwKICAgICAgYm90dG9tOiBbc3R5bGUsIGNvbG9yXSwKICAgICAgbGVmdDogW3N0eWxlLCBjb2xvcl0sCiAgICAgIHJpZ2h0OiBbc3R5bGUsIGNvbG9yXQogICAgfSk7CiAgfSBlbHNlIGlmIChtb2RlID09PSAnbm9uZScpIHsKICAgIHNlbGVjdG9yLnJhbmdlLmVhY2goZnVuY3Rpb24gKHJpLCBjaSkgewogICAgICB2YXIgY2VsbCA9IHJvd3MuZ2V0Q2VsbChyaSwgY2kpOwoKICAgICAgaWYgKGNlbGwgJiYgY2VsbC5zdHlsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFyIG5zID0gaGVscGVyLmNsb25lRGVlcChzdHlsZXNbY2VsbC5zdHlsZV0pOwogICAgICAgIGRlbGV0ZSBucy5ib3JkZXI7IC8vIFsnYm90dG9tJywgJ3RvcCcsICdsZWZ0JywgJ3JpZ2h0J10uZm9yRWFjaCgocHJvcCkgPT4gewogICAgICAgIC8vICAgaWYgKG5zW3Byb3BdKSBkZWxldGUgbnNbcHJvcF07CiAgICAgICAgLy8gfSk7CgogICAgICAgIGNlbGwuc3R5bGUgPSBfdGhpcy5hZGRTdHlsZShucyk7CiAgICAgIH0KICAgIH0pOwogIH0gZWxzZSBpZiAobW9kZSA9PT0gJ2FsbCcgfHwgbW9kZSA9PT0gJ2luc2lkZScgfHwgbW9kZSA9PT0gJ291dHNpZGUnIHx8IG1vZGUgPT09ICdob3Jpem9udGFsJyB8fCBtb2RlID09PSAndmVydGljYWwnKSB7CiAgICAoZnVuY3Rpb24gKCkgewogICAgICB2YXIgbWVyZ2VzID0gW107CgogICAgICBmb3IgKHZhciByaSA9IHNyaTsgcmkgPD0gZXJpOyByaSArPSAxKSB7CiAgICAgICAgZm9yICh2YXIgY2kgPSBzY2k7IGNpIDw9IGVjaTsgY2kgKz0gMSkgewogICAgICAgICAgLy8ganVtcCBtZXJnZXMgLS0gc3RhcnQKICAgICAgICAgIHZhciBtZXJnZUluZGV4ZXMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgbWVyZ2VzLmxlbmd0aDsgaWkgKz0gMSkgewogICAgICAgICAgICB2YXIgX21lcmdlcyRpaSA9IF9zbGljZWRUb0FycmF5KG1lcmdlc1tpaV0sIDQpLAogICAgICAgICAgICAgICAgbXJpID0gX21lcmdlcyRpaVswXSwKICAgICAgICAgICAgICAgIG1jaSA9IF9tZXJnZXMkaWlbMV0sCiAgICAgICAgICAgICAgICBfcm4gPSBfbWVyZ2VzJGlpWzJdLAogICAgICAgICAgICAgICAgX2NuID0gX21lcmdlcyRpaVszXTsKCiAgICAgICAgICAgIGlmIChyaSA9PT0gbXJpICsgX3JuICsgMSkgbWVyZ2VJbmRleGVzLnB1c2goaWkpOwoKICAgICAgICAgICAgaWYgKG1yaSA8PSByaSAmJiByaSA8PSBtcmkgKyBfcm4pIHsKICAgICAgICAgICAgICBpZiAoY2kgPT09IG1jaSkgewogICAgICAgICAgICAgICAgY2kgKz0gX2NuICsgMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIG1lcmdlSW5kZXhlcy5mb3JFYWNoKGZ1bmN0aW9uIChpdCkgewogICAgICAgICAgICByZXR1cm4gbWVyZ2VzLnNwbGljZShpdCwgMSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChjaSA+IGVjaSkgYnJlYWs7IC8vIGp1bXAgbWVyZ2VzIC0tIGVuZAoKICAgICAgICAgIHZhciBjZWxsID0gcm93cy5nZXRDZWxsKHJpLCBjaSk7CiAgICAgICAgICB2YXIgcm4gPSAwLAogICAgICAgICAgICAgIGNuID0gMDsKCiAgICAgICAgICBpZiAoY2VsbCAmJiBjZWxsLm1lcmdlKSB7CiAgICAgICAgICAgIHZhciBfY2VsbCRtZXJnZTIgPSBfc2xpY2VkVG9BcnJheShjZWxsLm1lcmdlLCAyKTsKCiAgICAgICAgICAgIHJuID0gX2NlbGwkbWVyZ2UyWzBdOwogICAgICAgICAgICBjbiA9IF9jZWxsJG1lcmdlMlsxXTsKICAgICAgICAgICAgbWVyZ2VzLnB1c2goW3JpLCBjaSwgcm4sIGNuXSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG1ybCA9IHJuID4gMCAmJiByaSArIHJuID09PSBlcmk7CiAgICAgICAgICB2YXIgbWNsID0gY24gPiAwICYmIGNpICsgY24gPT09IGVjaTsKICAgICAgICAgIHZhciBic3MgPSB7fTsKCiAgICAgICAgICBpZiAobW9kZSA9PT0gJ2FsbCcpIHsKICAgICAgICAgICAgYnNzID0gewogICAgICAgICAgICAgIGJvdHRvbTogW3N0eWxlLCBjb2xvcl0sCiAgICAgICAgICAgICAgdG9wOiBbc3R5bGUsIGNvbG9yXSwKICAgICAgICAgICAgICBsZWZ0OiBbc3R5bGUsIGNvbG9yXSwKICAgICAgICAgICAgICByaWdodDogW3N0eWxlLCBjb2xvcl0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ2luc2lkZScpIHsKICAgICAgICAgICAgaWYgKCFtY2wgJiYgY2kgPCBlY2kpIGJzcy5yaWdodCA9IFtzdHlsZSwgY29sb3JdOwogICAgICAgICAgICBpZiAoIW1ybCAmJiByaSA8IGVyaSkgYnNzLmJvdHRvbSA9IFtzdHlsZSwgY29sb3JdOwogICAgICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnaG9yaXpvbnRhbCcpIHsKICAgICAgICAgICAgaWYgKCFtcmwgJiYgcmkgPCBlcmkpIGJzcy5ib3R0b20gPSBbc3R5bGUsIGNvbG9yXTsKICAgICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ3ZlcnRpY2FsJykgewogICAgICAgICAgICBpZiAoIW1jbCAmJiBjaSA8IGVjaSkgYnNzLnJpZ2h0ID0gW3N0eWxlLCBjb2xvcl07CiAgICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdvdXRzaWRlJyAmJiBtdWx0aXBsZSkgewogICAgICAgICAgICBpZiAoc3JpID09PSByaSkgYnNzLnRvcCA9IFtzdHlsZSwgY29sb3JdOwogICAgICAgICAgICBpZiAobXJsIHx8IGVyaSA9PT0gcmkpIGJzcy5ib3R0b20gPSBbc3R5bGUsIGNvbG9yXTsKICAgICAgICAgICAgaWYgKHNjaSA9PT0gY2kpIGJzcy5sZWZ0ID0gW3N0eWxlLCBjb2xvcl07CiAgICAgICAgICAgIGlmIChtY2wgfHwgZWNpID09PSBjaSkgYnNzLnJpZ2h0ID0gW3N0eWxlLCBjb2xvcl07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGJzcykubGVuZ3RoID4gMCkgewogICAgICAgICAgICBzZXRTdHlsZUJvcmRlci5jYWxsKF90aGlzLCByaSwgY2ksIGJzcyk7CiAgICAgICAgICB9CgogICAgICAgICAgY2kgKz0gY247CiAgICAgICAgfQogICAgICB9CiAgICB9KSgpOwogIH0gZWxzZSBpZiAobW9kZSA9PT0gJ3RvcCcgfHwgbW9kZSA9PT0gJ2JvdHRvbScpIHsKICAgIGZvciAodmFyIGNpID0gc2NpOyBjaSA8PSBlY2k7IGNpICs9IDEpIHsKICAgICAgaWYgKG1vZGUgPT09ICd0b3AnKSB7CiAgICAgICAgc2V0U3R5bGVCb3JkZXIuY2FsbCh0aGlzLCBzcmksIGNpLCB7CiAgICAgICAgICB0b3A6IFtzdHlsZSwgY29sb3JdCiAgICAgICAgfSk7CiAgICAgICAgY2kgKz0gcm93cy5nZXRDZWxsTWVyZ2Uoc3JpLCBjaSlbMV07CiAgICAgIH0KCiAgICAgIGlmIChtb2RlID09PSAnYm90dG9tJykgewogICAgICAgIHNldFN0eWxlQm9yZGVyLmNhbGwodGhpcywgZXJpLCBjaSwgewogICAgICAgICAgYm90dG9tOiBbc3R5bGUsIGNvbG9yXQogICAgICAgIH0pOwogICAgICAgIGNpICs9IHJvd3MuZ2V0Q2VsbE1lcmdlKGVyaSwgY2kpWzFdOwogICAgICB9CiAgICB9CiAgfSBlbHNlIGlmIChtb2RlID09PSAnbGVmdCcgfHwgbW9kZSA9PT0gJ3JpZ2h0JykgewogICAgZm9yICh2YXIgcmkgPSBzcmk7IHJpIDw9IGVyaTsgcmkgKz0gMSkgewogICAgICBpZiAobW9kZSA9PT0gJ2xlZnQnKSB7CiAgICAgICAgc2V0U3R5bGVCb3JkZXIuY2FsbCh0aGlzLCByaSwgc2NpLCB7CiAgICAgICAgICBsZWZ0OiBbc3R5bGUsIGNvbG9yXQogICAgICAgIH0pOwogICAgICAgIHJpICs9IHJvd3MuZ2V0Q2VsbE1lcmdlKHJpLCBzY2kpWzBdOwogICAgICB9CgogICAgICBpZiAobW9kZSA9PT0gJ3JpZ2h0JykgewogICAgICAgIHNldFN0eWxlQm9yZGVyLmNhbGwodGhpcywgcmksIGVjaSwgewogICAgICAgICAgcmlnaHQ6IFtzdHlsZSwgY29sb3JdCiAgICAgICAgfSk7CiAgICAgICAgcmkgKz0gcm93cy5nZXRDZWxsTWVyZ2UocmksIGVjaSlbMF07CiAgICAgIH0KICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGdldENlbGxSb3dCeVkoeSwgc2Nyb2xsT2Zmc2V0eSkgewogIHZhciByb3dzID0gdGhpcy5yb3dzOwogIHZhciBmc2ggPSB0aGlzLmZyZWV6ZVRvdGFsSGVpZ2h0KCk7IC8vIGNvbnNvbGUubG9nKCd5OicsIHksICcsIGZzaDonLCBmc2gpOwoKICB2YXIgaW5pdHMgPSByb3dzLmhlaWdodDsKICBpZiAoZnNoICsgcm93cy5oZWlnaHQgPCB5KSBpbml0cyAtPSBzY3JvbGxPZmZzZXR5OyAvLyBoYW5kbGUgcmkgaW4gYXV0b2ZpbHRlcgoKICB2YXIgZnJzZXQgPSB0aGlzLmV4Y2VwdFJvd1NldDsKICB2YXIgcmkgPSAwOwogIHZhciB0b3AgPSBpbml0czsKICB2YXIgaGVpZ2h0ID0gcm93cy5oZWlnaHQ7CgogIGZvciAoOyByaSA8IHJvd3MubGVuOyByaSArPSAxKSB7CiAgICBpZiAodG9wID4geSkgYnJlYWs7CgogICAgaWYgKCFmcnNldC5oYXMocmkpKSB7CiAgICAgIGhlaWdodCA9IHJvd3MuZ2V0SGVpZ2h0KHJpKTsKICAgICAgdG9wICs9IGhlaWdodDsKICAgIH0KICB9CgogIHRvcCAtPSBoZWlnaHQ7IC8vIGNvbnNvbGUubG9nKCdyaTonLCByaSwgJywgdG9wOicsIHRvcCwgJywgaGVpZ2h0OicsIGhlaWdodCk7CgogIGlmICh0b3AgPD0gMCkgewogICAgcmV0dXJuIHsKICAgICAgcmk6IC0xLAogICAgICB0b3A6IDAsCiAgICAgIGhlaWdodDogaGVpZ2h0CiAgICB9OwogIH0KCiAgcmV0dXJuIHsKICAgIHJpOiByaSAtIDEsCiAgICB0b3A6IHRvcCwKICAgIGhlaWdodDogaGVpZ2h0CiAgfTsKfQoKZnVuY3Rpb24gZ2V0Q2VsbENvbEJ5WCh4LCBzY3JvbGxPZmZzZXR4KSB7CiAgdmFyIGNvbHMgPSB0aGlzLmNvbHM7CiAgdmFyIGZzdyA9IHRoaXMuZnJlZXplVG90YWxXaWR0aCgpOwogIHZhciBpbml0cyA9IGNvbHMuaW5kZXhXaWR0aDsKICBpZiAoZnN3ICsgY29scy5pbmRleFdpZHRoIDwgeCkgaW5pdHMgLT0gc2Nyb2xsT2Zmc2V0eDsKCiAgdmFyIF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZiA9IGhlbHBlci5yYW5nZVJlZHVjZUlmKDAsIGNvbHMubGVuLCBpbml0cywgY29scy5pbmRleFdpZHRoLCB4LCBmdW5jdGlvbiAoaSkgewogICAgcmV0dXJuIGNvbHMuZ2V0V2lkdGgoaSk7CiAgfSksCiAgICAgIF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjIgPSBfc2xpY2VkVG9BcnJheShfaGVscGVyJHJhbmdlUmVkdWNlSWYsIDMpLAogICAgICBjaSA9IF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjJbMF0sCiAgICAgIGxlZnQgPSBfaGVscGVyJHJhbmdlUmVkdWNlSWYyWzFdLAogICAgICB3aWR0aCA9IF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjJbMl07CgogIGlmIChsZWZ0IDw9IDApIHsKICAgIHJldHVybiB7CiAgICAgIGNpOiAtMSwKICAgICAgbGVmdDogMCwKICAgICAgd2lkdGg6IGNvbHMuaW5kZXhXaWR0aAogICAgfTsKICB9CgogIHJldHVybiB7CiAgICBjaTogY2kgLSAxLAogICAgbGVmdDogbGVmdCwKICAgIHdpZHRoOiB3aWR0aAogIH07Cn0KCnZhciBEYXRhUHJveHkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIERhdGFQcm94eShuYW1lLCBzZXR0aW5ncykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFQcm94eSk7CgogICAgdGhpcy5zZXR0aW5ncyA9IGhlbHBlci5tZXJnZShkZWZhdWx0U2V0dGluZ3MsIHNldHRpbmdzIHx8IHt9KTsgLy8gc2F2ZSBkYXRhIGJlZ2luCgogICAgdGhpcy5uYW1lID0gbmFtZSB8fCAnc2hlZXQnOwogICAgdGhpcy5mcmVlemUgPSBbMCwgMF07CiAgICB0aGlzLnN0eWxlcyA9IFtdOyAvLyBBcnJheTxTdHlsZT4KCiAgICB0aGlzLm1lcmdlcyA9IG5ldyBNZXJnZXMoKTsgLy8gW0NlbGxSYW5nZSwgLi4uXQoKICAgIHRoaXMucm93cyA9IG5ldyBSb3dzKHRoaXMuc2V0dGluZ3Mucm93KTsKICAgIHRoaXMuY29scyA9IG5ldyBDb2xzKHRoaXMuc2V0dGluZ3MuY29sKTsKICAgIHRoaXMudmFsaWRhdGlvbnMgPSBuZXcgVmFsaWRhdGlvbnMoKTsKICAgIHRoaXMuaHlwZXJsaW5rcyA9IHt9OwogICAgdGhpcy5jb21tZW50cyA9IHt9OyAvLyBzYXZlIGRhdGEgZW5kCiAgICAvLyBkb24ndCBzYXZlIG9iamVjdAoKICAgIHRoaXMuc2VsZWN0b3IgPSBuZXcgU2VsZWN0b3IoKTsKICAgIHRoaXMuc2Nyb2xsID0gbmV3IFNjcm9sbCgpOwogICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkoKTsKICAgIHRoaXMuY2xpcGJvYXJkID0gbmV3IENsaXBib2FyZCgpOwogICAgdGhpcy5hdXRvRmlsdGVyID0gbmV3IEF1dG9GaWx0ZXIoKTsKCiAgICB0aGlzLmNoYW5nZSA9IGZ1bmN0aW9uICgpIHt9OwoKICAgIHRoaXMuZXhjZXB0Um93U2V0ID0gbmV3IFNldCgpOwogICAgdGhpcy5zb3J0ZWRSb3dNYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnVuc29ydGVkUm93TWFwID0gbmV3IE1hcCgpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKERhdGFQcm94eSwgW3sKICAgIGtleTogImFkZFZhbGlkYXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFZhbGlkYXRpb24obW9kZSwgcmVmLCB2YWxpZGF0b3IpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZygnbW9kZTonLCBtb2RlLCAnLCByZWY6JywgcmVmLCAnLCB2YWxpZGF0b3I6JywgdmFsaWRhdG9yKTsKICAgICAgdGhpcy5jaGFuZ2VEYXRhKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIudmFsaWRhdGlvbnMuYWRkKG1vZGUsIHJlZiwgdmFsaWRhdG9yKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlVmFsaWRhdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlVmFsaWRhdGlvbigpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgcmFuZ2UgPSB0aGlzLnNlbGVjdG9yLnJhbmdlOwogICAgICB0aGlzLmNoYW5nZURhdGEoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy52YWxpZGF0aW9ucy5yZW1vdmUocmFuZ2UpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3RlZFZhbGlkYXRvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2VsZWN0ZWRWYWxpZGF0b3IoKSB7CiAgICAgIHZhciBfdGhpcyRzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IsCiAgICAgICAgICByaSA9IF90aGlzJHNlbGVjdG9yLnJpLAogICAgICAgICAgY2kgPSBfdGhpcyRzZWxlY3Rvci5jaTsKICAgICAgdmFyIHYgPSB0aGlzLnZhbGlkYXRpb25zLmdldChyaSwgY2kpOwogICAgICByZXR1cm4gdiA/IHYudmFsaWRhdG9yIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3RlZFZhbGlkYXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGVkVmFsaWRhdGlvbigpIHsKICAgICAgdmFyIF90aGlzJHNlbGVjdG9yMiA9IHRoaXMuc2VsZWN0b3IsCiAgICAgICAgICByaSA9IF90aGlzJHNlbGVjdG9yMi5yaSwKICAgICAgICAgIGNpID0gX3RoaXMkc2VsZWN0b3IyLmNpLAogICAgICAgICAgcmFuZ2UgPSBfdGhpcyRzZWxlY3RvcjIucmFuZ2U7CiAgICAgIHZhciB2ID0gdGhpcy52YWxpZGF0aW9ucy5nZXQocmksIGNpKTsKICAgICAgdmFyIHJldCA9IHsKICAgICAgICByZWY6IHJhbmdlLnRvU3RyaW5nKCkKICAgICAgfTsKCiAgICAgIGlmICh2ICE9PSBudWxsKSB7CiAgICAgICAgcmV0Lm1vZGUgPSB2Lm1vZGU7CiAgICAgICAgcmV0LnZhbGlkYXRvciA9IHYudmFsaWRhdG9yOwogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfQogIH0sIHsKICAgIGtleTogImNhblVuZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhblVuZG8oKSB7CiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuY2FuVW5kbygpOwogICAgfQogIH0sIHsKICAgIGtleTogImNhblJlZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhblJlZG8oKSB7CiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuY2FuUmVkbygpOwogICAgfQogIH0sIHsKICAgIGtleTogInVuZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVuZG8oKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdGhpcy5oaXN0b3J5LnVuZG8odGhpcy5nZXREYXRhKCksIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgX3RoaXM0LnNldERhdGEoZCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZG8oKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdGhpcy5oaXN0b3J5LnJlZG8odGhpcy5nZXREYXRhKCksIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgX3RoaXM1LnNldERhdGEoZCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNvcHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvcHkoKSB7CiAgICAgIHRoaXMuY2xpcGJvYXJkLmNvcHkodGhpcy5zZWxlY3Rvci5yYW5nZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjdXQoKSB7CiAgICAgIHRoaXMuY2xpcGJvYXJkLmN1dCh0aGlzLnNlbGVjdG9yLnJhbmdlKTsKICAgIH0gLy8gd2hhdDogYWxsIHwgdGV4dCB8IGZvcm1hdAoKICB9LCB7CiAgICBrZXk6ICJwYXN0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGFzdGUoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIHdoYXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICdhbGwnOwogICAgICB2YXIgZXJyb3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZ1bmN0aW9uICgpIHt9OwogICAgICAvLyBjb25zb2xlLmxvZygnc0luZGV4ZXM6Jywgc0luZGV4ZXMpOwogICAgICB2YXIgY2xpcGJvYXJkID0gdGhpcy5jbGlwYm9hcmQsCiAgICAgICAgICBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3I7CiAgICAgIGlmIChjbGlwYm9hcmQuaXNDbGVhcigpKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghY2FuUGFzdGUuY2FsbCh0aGlzLCBjbGlwYm9hcmQucmFuZ2UsIHNlbGVjdG9yLnJhbmdlLCBlcnJvcikpIHJldHVybiBmYWxzZTsKICAgICAgdGhpcy5jaGFuZ2VEYXRhKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoY2xpcGJvYXJkLmlzQ29weSgpKSB7CiAgICAgICAgICBjb3B5UGFzdGUuY2FsbChfdGhpczYsIGNsaXBib2FyZC5yYW5nZSwgc2VsZWN0b3IucmFuZ2UsIHdoYXQpOwogICAgICAgIH0gZWxzZSBpZiAoY2xpcGJvYXJkLmlzQ3V0KCkpIHsKICAgICAgICAgIGN1dFBhc3RlLmNhbGwoX3RoaXM2LCBjbGlwYm9hcmQucmFuZ2UsIHNlbGVjdG9yLnJhbmdlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwYXN0ZUZyb21UZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYXN0ZUZyb21UZXh0KHR4dCkgewogICAgICB2YXIgbGluZXMgPSB0eHQuc3BsaXQoJ1xyXG4nKS5tYXAoZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGl0LnJlcGxhY2UoLyIvZywgJycpLnNwbGl0KCdcdCcpOwogICAgICB9KTsKICAgICAgaWYgKGxpbmVzLmxlbmd0aCA+IDApIGxpbmVzLmxlbmd0aCAtPSAxOwogICAgICB2YXIgcm93cyA9IHRoaXMucm93cywKICAgICAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvcjsKICAgICAgdGhpcy5jaGFuZ2VEYXRhKGZ1bmN0aW9uICgpIHsKICAgICAgICByb3dzLnBhc3RlKGxpbmVzLCBzZWxlY3Rvci5yYW5nZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImF1dG9maWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhdXRvZmlsbChjZWxsUmFuZ2UsIHdoYXQpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgZXJyb3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZ1bmN0aW9uICgpIHt9OwogICAgICB2YXIgc3JjUmFuZ2UgPSB0aGlzLnNlbGVjdG9yLnJhbmdlOwogICAgICBpZiAoIWNhblBhc3RlLmNhbGwodGhpcywgc3JjUmFuZ2UsIGNlbGxSYW5nZSwgZXJyb3IpKSByZXR1cm4gZmFsc2U7CiAgICAgIHRoaXMuY2hhbmdlRGF0YShmdW5jdGlvbiAoKSB7CiAgICAgICAgY29weVBhc3RlLmNhbGwoX3RoaXM3LCBzcmNSYW5nZSwgY2VsbFJhbmdlLCB3aGF0LCB0cnVlKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImNsZWFyQ2xpcGJvYXJkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhckNsaXBib2FyZCgpIHsKICAgICAgdGhpcy5jbGlwYm9hcmQuY2xlYXIoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYWxTZWxlY3RlZFJhbmdlQnlFbmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhbFNlbGVjdGVkUmFuZ2VCeUVuZChyaSwgY2kpIHsKICAgICAgdmFyIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciwKICAgICAgICAgIHJvd3MgPSB0aGlzLnJvd3MsCiAgICAgICAgICBjb2xzID0gdGhpcy5jb2xzLAogICAgICAgICAgbWVyZ2VzID0gdGhpcy5tZXJnZXM7CiAgICAgIHZhciBfc2VsZWN0b3IkcmFuZ2UyID0gc2VsZWN0b3IucmFuZ2UsCiAgICAgICAgICBzcmkgPSBfc2VsZWN0b3IkcmFuZ2UyLnNyaSwKICAgICAgICAgIHNjaSA9IF9zZWxlY3RvciRyYW5nZTIuc2NpLAogICAgICAgICAgZXJpID0gX3NlbGVjdG9yJHJhbmdlMi5lcmksCiAgICAgICAgICBlY2kgPSBfc2VsZWN0b3IkcmFuZ2UyLmVjaTsKICAgICAgdmFyIGNyaSA9IHNlbGVjdG9yLnJpOwogICAgICB2YXIgY2NpID0gc2VsZWN0b3IuY2k7CiAgICAgIHZhciBucmkgPSByaSwKICAgICAgICAgIG5jaSA9IGNpOwogICAgICBpZiAocmkgPCAwKSBucmkgPSByb3dzLmxlbiAtIDE7CiAgICAgIGlmIChjaSA8IDApIG5jaSA9IGNvbHMubGVuIC0gMTsKCiAgICAgIGlmIChucmkgPiBjcmkpIHsKICAgICAgICBzcmkgPSBjcmk7CiAgICAgICAgZXJpID0gbnJpOwogICAgICB9IGVsc2UgewogICAgICAgIHNyaSA9IG5yaTsKICAgICAgICBlcmkgPSBjcmk7CiAgICAgIH0KCiAgICAgIGlmIChuY2kgPiBjY2kpIHsKICAgICAgICBzY2kgPSBjY2k7CiAgICAgICAgZWNpID0gbmNpOwogICAgICB9IGVsc2UgewogICAgICAgIHNjaSA9IG5jaTsKICAgICAgICBlY2kgPSBjY2k7CiAgICAgIH0KCiAgICAgIHNlbGVjdG9yLnJhbmdlID0gbWVyZ2VzLnVuaW9uKG5ldyBDZWxsUmFuZ2Uoc3JpLCBzY2ksIGVyaSwgZWNpKSk7CiAgICAgIHNlbGVjdG9yLnJhbmdlID0gbWVyZ2VzLnVuaW9uKHNlbGVjdG9yLnJhbmdlKTsgLy8gY29uc29sZS5sb2coJ3NlbGVjdG9yLnJhbmdlOicsIHNlbGVjdG9yLnJhbmdlKTsKCiAgICAgIHJldHVybiBzZWxlY3Rvci5yYW5nZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYWxTZWxlY3RlZFJhbmdlQnlTdGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FsU2VsZWN0ZWRSYW5nZUJ5U3RhcnQocmksIGNpKSB7CiAgICAgIHZhciBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IsCiAgICAgICAgICByb3dzID0gdGhpcy5yb3dzLAogICAgICAgICAgY29scyA9IHRoaXMuY29scywKICAgICAgICAgIG1lcmdlcyA9IHRoaXMubWVyZ2VzOwogICAgICB2YXIgY2VsbFJhbmdlID0gbWVyZ2VzLmdldEZpcnN0SW5jbHVkZXMocmksIGNpKTsgLy8gY29uc29sZS5sb2coJ2NlbGxSYW5nZTonLCBjZWxsUmFuZ2UsIHJpLCBjaSwgbWVyZ2VzKTsKCiAgICAgIGlmIChjZWxsUmFuZ2UgPT09IG51bGwpIHsKICAgICAgICBjZWxsUmFuZ2UgPSBuZXcgQ2VsbFJhbmdlKHJpLCBjaSwgcmksIGNpKTsKCiAgICAgICAgaWYgKHJpID09PSAtMSkgewogICAgICAgICAgY2VsbFJhbmdlLnNyaSA9IDA7CiAgICAgICAgICBjZWxsUmFuZ2UuZXJpID0gcm93cy5sZW4gLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNpID09PSAtMSkgewogICAgICAgICAgY2VsbFJhbmdlLnNjaSA9IDA7CiAgICAgICAgICBjZWxsUmFuZ2UuZWNpID0gY29scy5sZW4gLSAxOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc2VsZWN0b3IucmFuZ2UgPSBjZWxsUmFuZ2U7CiAgICAgIHJldHVybiBjZWxsUmFuZ2U7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U2VsZWN0ZWRDZWxsQXR0ciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U2VsZWN0ZWRDZWxsQXR0cihwcm9wZXJ0eSwgdmFsdWUpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB0aGlzLmNoYW5nZURhdGEoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RvciA9IF90aGlzOC5zZWxlY3RvciwKICAgICAgICAgICAgc3R5bGVzID0gX3RoaXM4LnN0eWxlcywKICAgICAgICAgICAgcm93cyA9IF90aGlzOC5yb3dzOwoKICAgICAgICBpZiAocHJvcGVydHkgPT09ICdtZXJnZScpIHsKICAgICAgICAgIGlmICh2YWx1ZSkgX3RoaXM4Lm1lcmdlKCk7ZWxzZSBfdGhpczgudW5tZXJnZSgpOwogICAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkgPT09ICdib3JkZXInKSB7CiAgICAgICAgICBzZXRTdHlsZUJvcmRlcnMuY2FsbChfdGhpczgsIHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKHByb3BlcnR5ID09PSAnZm9ybXVsYScpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCc+Pj4nLCBzZWxlY3Rvci5tdWx0aXBsZSgpKTsKICAgICAgICAgIHZhciByaSA9IHNlbGVjdG9yLnJpLAogICAgICAgICAgICAgIGNpID0gc2VsZWN0b3IuY2ksCiAgICAgICAgICAgICAgcmFuZ2UgPSBzZWxlY3Rvci5yYW5nZTsKCiAgICAgICAgICBpZiAoc2VsZWN0b3IubXVsdGlwbGUoKSkgewogICAgICAgICAgICB2YXIgX3NlbGVjdG9yJHNpemUgPSBzZWxlY3Rvci5zaXplKCksCiAgICAgICAgICAgICAgICBfc2VsZWN0b3Ikc2l6ZTIgPSBfc2xpY2VkVG9BcnJheShfc2VsZWN0b3Ikc2l6ZSwgMiksCiAgICAgICAgICAgICAgICBybiA9IF9zZWxlY3RvciRzaXplMlswXSwKICAgICAgICAgICAgICAgIGNuID0gX3NlbGVjdG9yJHNpemUyWzFdOwoKICAgICAgICAgICAgdmFyIHNyaSA9IHJhbmdlLnNyaSwKICAgICAgICAgICAgICAgIHNjaSA9IHJhbmdlLnNjaSwKICAgICAgICAgICAgICAgIGVyaSA9IHJhbmdlLmVyaSwKICAgICAgICAgICAgICAgIGVjaSA9IHJhbmdlLmVjaTsKCiAgICAgICAgICAgIGlmIChybiA+IDEpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gc2NpOyBpIDw9IGVjaTsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHJvd3MuZ2V0Q2VsbE9yTmV3KGVyaSArIDEsIGkpOwogICAgICAgICAgICAgICAgY2VsbC50ZXh0ID0gIj0iLmNvbmNhdCh2YWx1ZSwgIigiKS5jb25jYXQoeHkyZXhwcihpLCBzcmkpLCAiOiIpLmNvbmNhdCh4eTJleHByKGksIGVyaSksICIpIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGNuID4gMSkgewogICAgICAgICAgICAgIHZhciBfY2VsbCA9IHJvd3MuZ2V0Q2VsbE9yTmV3KHJpLCBlY2kgKyAxKTsKCiAgICAgICAgICAgICAgX2NlbGwudGV4dCA9ICI9Ii5jb25jYXQodmFsdWUsICIoIikuY29uY2F0KHh5MmV4cHIoc2NpLCByaSksICI6IikuY29uY2F0KHh5MmV4cHIoZWNpLCByaSksICIpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBfY2VsbDIgPSByb3dzLmdldENlbGxPck5ldyhyaSwgY2kpOwoKICAgICAgICAgICAgX2NlbGwyLnRleHQgPSAiPSIuY29uY2F0KHZhbHVlLCAiKCkiKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZWN0b3IucmFuZ2UuZWFjaChmdW5jdGlvbiAocmksIGNpKSB7CiAgICAgICAgICAgIHZhciBjZWxsID0gcm93cy5nZXRDZWxsT3JOZXcocmksIGNpKTsKICAgICAgICAgICAgdmFyIGNzdHlsZSA9IHt9OwoKICAgICAgICAgICAgaWYgKGNlbGwuc3R5bGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGNzdHlsZSA9IGhlbHBlci5jbG9uZURlZXAoc3R5bGVzW2NlbGwuc3R5bGVdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHByb3BlcnR5ID09PSAnZm9ybWF0JykgewogICAgICAgICAgICAgIGNzdHlsZS5mb3JtYXQgPSB2YWx1ZTsKICAgICAgICAgICAgICBjZWxsLnN0eWxlID0gX3RoaXM4LmFkZFN0eWxlKGNzdHlsZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkgPT09ICdmb250LWJvbGQnIHx8IHByb3BlcnR5ID09PSAnZm9udC1pdGFsaWMnIHx8IHByb3BlcnR5ID09PSAnZm9udC1uYW1lJyB8fCBwcm9wZXJ0eSA9PT0gJ2ZvbnQtc2l6ZScpIHsKICAgICAgICAgICAgICB2YXIgbmZvbnQgPSB7fTsKICAgICAgICAgICAgICBuZm9udFtwcm9wZXJ0eS5zcGxpdCgnLScpWzFdXSA9IHZhbHVlOwogICAgICAgICAgICAgIGNzdHlsZS5mb250ID0gT2JqZWN0LmFzc2lnbihjc3R5bGUuZm9udCB8fCB7fSwgbmZvbnQpOwogICAgICAgICAgICAgIGNlbGwuc3R5bGUgPSBfdGhpczguYWRkU3R5bGUoY3N0eWxlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eSA9PT0gJ3N0cmlrZScgfHwgcHJvcGVydHkgPT09ICd0ZXh0d3JhcCcgfHwgcHJvcGVydHkgPT09ICd1bmRlcmxpbmUnIHx8IHByb3BlcnR5ID09PSAnYWxpZ24nIHx8IHByb3BlcnR5ID09PSAndmFsaWduJyB8fCBwcm9wZXJ0eSA9PT0gJ2NvbG9yJyB8fCBwcm9wZXJ0eSA9PT0gJ2JnY29sb3InKSB7CiAgICAgICAgICAgICAgY3N0eWxlW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICAgICAgICAgIGNlbGwuc3R5bGUgPSBfdGhpczguYWRkU3R5bGUoY3N0eWxlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjZWxsW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSAvLyBzdGF0ZTogaW5wdXQgfCBmaW5pc2hlZAoKICB9LCB7CiAgICBrZXk6ICJzZXRTZWxlY3RlZENlbGxUZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTZWxlY3RlZENlbGxUZXh0KHRleHQpIHsKICAgICAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnaW5wdXQnOwogICAgICB2YXIgYXV0b0ZpbHRlciA9IHRoaXMuYXV0b0ZpbHRlciwKICAgICAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciwKICAgICAgICAgIHJvd3MgPSB0aGlzLnJvd3M7CiAgICAgIHZhciByaSA9IHNlbGVjdG9yLnJpLAogICAgICAgICAgY2kgPSBzZWxlY3Rvci5jaTsKICAgICAgdmFyIG5yaSA9IHJpOwoKICAgICAgaWYgKHRoaXMudW5zb3J0ZWRSb3dNYXAuaGFzKHJpKSkgewogICAgICAgIG5yaSA9IHRoaXMudW5zb3J0ZWRSb3dNYXAuZ2V0KHJpKTsKICAgICAgfQoKICAgICAgdmFyIG9sZENlbGwgPSByb3dzLmdldENlbGwobnJpLCBjaSk7CiAgICAgIHZhciBvbGRUZXh0ID0gb2xkQ2VsbCA/IG9sZENlbGwudGV4dCA6ICcnOwogICAgICB0aGlzLnNldENlbGxUZXh0KG5yaSwgY2ksIHRleHQsIHN0YXRlKTsgLy8gcmVwbGFjZSBmaWx0ZXIudmFsdWUKCiAgICAgIGlmIChhdXRvRmlsdGVyLmFjdGl2ZSgpKSB7CiAgICAgICAgdmFyIGZpbHRlciA9IGF1dG9GaWx0ZXIuZ2V0RmlsdGVyKGNpKTsKCiAgICAgICAgaWYgKGZpbHRlcikgewogICAgICAgICAgdmFyIHZJbmRleCA9IGZpbHRlci52YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgcmV0dXJuIHYgPT09IG9sZFRleHQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodkluZGV4ID49IDApIHsKICAgICAgICAgICAgZmlsdGVyLnZhbHVlLnNwbGljZSh2SW5kZXgsIDEsIHRleHQpOwogICAgICAgICAgfSAvLyBjb25zb2xlLmxvZygnZmlsdGVyOicsIGZpbHRlciwgb2xkQ2VsbCk7CgogICAgICAgIH0KICAgICAgfSAvLyB0aGlzLnJlc2V0QXV0b0ZpbHRlcigpOwoKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3RlZENlbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGVkQ2VsbCgpIHsKICAgICAgdmFyIF90aGlzJHNlbGVjdG9yMyA9IHRoaXMuc2VsZWN0b3IsCiAgICAgICAgICByaSA9IF90aGlzJHNlbGVjdG9yMy5yaSwKICAgICAgICAgIGNpID0gX3RoaXMkc2VsZWN0b3IzLmNpOwogICAgICB2YXIgbnJpID0gcmk7CgogICAgICBpZiAodGhpcy51bnNvcnRlZFJvd01hcC5oYXMocmkpKSB7CiAgICAgICAgbnJpID0gdGhpcy51bnNvcnRlZFJvd01hcC5nZXQocmkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5yb3dzLmdldENlbGwobnJpLCBjaSk7CiAgICB9CiAgfSwgewogICAga2V5OiAieHlJblNlbGVjdGVkUmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24geHlJblNlbGVjdGVkUmVjdCh4LCB5KSB7CiAgICAgIHZhciBfdGhpcyRnZXRTZWxlY3RlZFJlY3QgPSB0aGlzLmdldFNlbGVjdGVkUmVjdCgpLAogICAgICAgICAgbGVmdCA9IF90aGlzJGdldFNlbGVjdGVkUmVjdC5sZWZ0LAogICAgICAgICAgdG9wID0gX3RoaXMkZ2V0U2VsZWN0ZWRSZWN0LnRvcCwKICAgICAgICAgIHdpZHRoID0gX3RoaXMkZ2V0U2VsZWN0ZWRSZWN0LndpZHRoLAogICAgICAgICAgaGVpZ2h0ID0gX3RoaXMkZ2V0U2VsZWN0ZWRSZWN0LmhlaWdodDsKCiAgICAgIHZhciB4MSA9IHggLSB0aGlzLmNvbHMuaW5kZXhXaWR0aDsKICAgICAgdmFyIHkxID0geSAtIHRoaXMucm93cy5oZWlnaHQ7IC8vIGNvbnNvbGUubG9nKCd4OicsIHgsICcseTonLCB5LCAnbGVmdDonLCBsZWZ0LCAndG9wOicsIHRvcCk7CgogICAgICByZXR1cm4geDEgPiBsZWZ0ICYmIHgxIDwgbGVmdCArIHdpZHRoICYmIHkxID4gdG9wICYmIHkxIDwgdG9wICsgaGVpZ2h0OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNlbGVjdGVkUmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2VsZWN0ZWRSZWN0KCkgewogICAgICByZXR1cm4gdGhpcy5nZXRSZWN0KHRoaXMuc2VsZWN0b3IucmFuZ2UpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldENsaXBib2FyZFJlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENsaXBib2FyZFJlY3QoKSB7CiAgICAgIHZhciBjbGlwYm9hcmQgPSB0aGlzLmNsaXBib2FyZDsKCiAgICAgIGlmICghY2xpcGJvYXJkLmlzQ2xlYXIoKSkgewogICAgICAgIHJldHVybiB0aGlzLmdldFJlY3QoY2xpcGJvYXJkLnJhbmdlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBsZWZ0OiAtMTAwLAogICAgICAgIHRvcDogLTEwMAogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFJlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJlY3QoY2VsbFJhbmdlKSB7CiAgICAgIHZhciBzY3JvbGwgPSB0aGlzLnNjcm9sbCwKICAgICAgICAgIHJvd3MgPSB0aGlzLnJvd3MsCiAgICAgICAgICBjb2xzID0gdGhpcy5jb2xzLAogICAgICAgICAgZXhjZXB0Um93U2V0ID0gdGhpcy5leGNlcHRSb3dTZXQ7CiAgICAgIHZhciBzcmkgPSBjZWxsUmFuZ2Uuc3JpLAogICAgICAgICAgc2NpID0gY2VsbFJhbmdlLnNjaSwKICAgICAgICAgIGVyaSA9IGNlbGxSYW5nZS5lcmksCiAgICAgICAgICBlY2kgPSBjZWxsUmFuZ2UuZWNpOyAvLyBjb25zb2xlLmxvZygnc3JpOicsIHNyaSwgJyxzY2k6Jywgc2NpLCAnLCBlcmk6JywgZXJpLCAnLCBlY2k6JywgZWNpKTsKICAgICAgLy8gbm8gc2VsZWN0b3IKCiAgICAgIGlmIChzcmkgPCAwICYmIHNjaSA8IDApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGVmdDogMCwKICAgICAgICAgIGw6IDAsCiAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICB0OiAwLAogICAgICAgICAgc2Nyb2xsOiBzY3JvbGwKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgbGVmdCA9IGNvbHMuc3VtV2lkdGgoMCwgc2NpKTsKICAgICAgdmFyIHRvcCA9IHJvd3Muc3VtSGVpZ2h0KDAsIHNyaSwgZXhjZXB0Um93U2V0KTsKICAgICAgdmFyIGhlaWdodCA9IHJvd3Muc3VtSGVpZ2h0KHNyaSwgZXJpICsgMSwgZXhjZXB0Um93U2V0KTsKICAgICAgdmFyIHdpZHRoID0gY29scy5zdW1XaWR0aChzY2ksIGVjaSArIDEpOyAvLyBjb25zb2xlLmxvZygnc3JpOicsIHNyaSwgJywgc2NpOicsIHNjaSwgJywgZXJpOicsIGVyaSwgJywgZWNpOicsIGVjaSk7CgogICAgICB2YXIgbGVmdDAgPSBsZWZ0IC0gc2Nyb2xsLng7CiAgICAgIHZhciB0b3AwID0gdG9wIC0gc2Nyb2xsLnk7CiAgICAgIHZhciBmc2ggPSB0aGlzLmZyZWV6ZVRvdGFsSGVpZ2h0KCk7CiAgICAgIHZhciBmc3cgPSB0aGlzLmZyZWV6ZVRvdGFsV2lkdGgoKTsKCiAgICAgIGlmIChmc3cgPiAwICYmIGZzdyA+IGxlZnQpIHsKICAgICAgICBsZWZ0MCA9IGxlZnQ7CiAgICAgIH0KCiAgICAgIGlmIChmc2ggPiAwICYmIGZzaCA+IHRvcCkgewogICAgICAgIHRvcDAgPSB0b3A7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgbDogbGVmdCwKICAgICAgICB0OiB0b3AsCiAgICAgICAgbGVmdDogbGVmdDAsCiAgICAgICAgdG9wOiB0b3AwLAogICAgICAgIGhlaWdodDogaGVpZ2h0LAogICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICBzY3JvbGw6IHNjcm9sbAogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldENlbGxSZWN0QnlYWSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2VsbFJlY3RCeVhZKHgsIHkpIHsKICAgICAgdmFyIHNjcm9sbCA9IHRoaXMuc2Nyb2xsLAogICAgICAgICAgbWVyZ2VzID0gdGhpcy5tZXJnZXMsCiAgICAgICAgICByb3dzID0gdGhpcy5yb3dzLAogICAgICAgICAgY29scyA9IHRoaXMuY29sczsKCiAgICAgIHZhciBfZ2V0Q2VsbFJvd0J5WSRjYWxsID0gZ2V0Q2VsbFJvd0J5WS5jYWxsKHRoaXMsIHksIHNjcm9sbC55KSwKICAgICAgICAgIHJpID0gX2dldENlbGxSb3dCeVkkY2FsbC5yaSwKICAgICAgICAgIHRvcCA9IF9nZXRDZWxsUm93QnlZJGNhbGwudG9wLAogICAgICAgICAgaGVpZ2h0ID0gX2dldENlbGxSb3dCeVkkY2FsbC5oZWlnaHQ7CgogICAgICB2YXIgX2dldENlbGxDb2xCeVgkY2FsbCA9IGdldENlbGxDb2xCeVguY2FsbCh0aGlzLCB4LCBzY3JvbGwueCksCiAgICAgICAgICBjaSA9IF9nZXRDZWxsQ29sQnlYJGNhbGwuY2ksCiAgICAgICAgICBsZWZ0ID0gX2dldENlbGxDb2xCeVgkY2FsbC5sZWZ0LAogICAgICAgICAgd2lkdGggPSBfZ2V0Q2VsbENvbEJ5WCRjYWxsLndpZHRoOwoKICAgICAgaWYgKGNpID09PSAtMSkgewogICAgICAgIHdpZHRoID0gY29scy50b3RhbFdpZHRoKCk7CiAgICAgIH0KCiAgICAgIGlmIChyaSA9PT0gLTEpIHsKICAgICAgICBoZWlnaHQgPSByb3dzLnRvdGFsSGVpZ2h0KCk7CiAgICAgIH0KCiAgICAgIGlmIChyaSA+PSAwIHx8IGNpID49IDApIHsKICAgICAgICB2YXIgbWVyZ2UgPSBtZXJnZXMuZ2V0Rmlyc3RJbmNsdWRlcyhyaSwgY2kpOwoKICAgICAgICBpZiAobWVyZ2UpIHsKICAgICAgICAgIHJpID0gbWVyZ2Uuc3JpOwogICAgICAgICAgY2kgPSBtZXJnZS5zY2k7CgogICAgICAgICAgdmFyIF90aGlzJGNlbGxSZWN0ID0gdGhpcy5jZWxsUmVjdChyaSwgY2kpOwoKICAgICAgICAgIGxlZnQgPSBfdGhpcyRjZWxsUmVjdC5sZWZ0OwogICAgICAgICAgdG9wID0gX3RoaXMkY2VsbFJlY3QudG9wOwogICAgICAgICAgd2lkdGggPSBfdGhpcyRjZWxsUmVjdC53aWR0aDsKICAgICAgICAgIGhlaWdodCA9IF90aGlzJGNlbGxSZWN0LmhlaWdodDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgcmk6IHJpLAogICAgICAgIGNpOiBjaSwKICAgICAgICBsZWZ0OiBsZWZ0LAogICAgICAgIHRvcDogdG9wLAogICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICBoZWlnaHQ6IGhlaWdodAogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImlzU2lnbmxlU2VsZWN0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2lnbmxlU2VsZWN0ZWQoKSB7CiAgICAgIHZhciBfdGhpcyRzZWxlY3RvciRyYW5nZSA9IHRoaXMuc2VsZWN0b3IucmFuZ2UsCiAgICAgICAgICBzcmkgPSBfdGhpcyRzZWxlY3RvciRyYW5nZS5zcmksCiAgICAgICAgICBzY2kgPSBfdGhpcyRzZWxlY3RvciRyYW5nZS5zY2ksCiAgICAgICAgICBlcmkgPSBfdGhpcyRzZWxlY3RvciRyYW5nZS5lcmksCiAgICAgICAgICBlY2kgPSBfdGhpcyRzZWxlY3RvciRyYW5nZS5lY2k7CiAgICAgIHZhciBjZWxsID0gdGhpcy5nZXRDZWxsKHNyaSwgc2NpKTsKCiAgICAgIGlmIChjZWxsICYmIGNlbGwubWVyZ2UpIHsKICAgICAgICB2YXIgX2NlbGwkbWVyZ2UzID0gX3NsaWNlZFRvQXJyYXkoY2VsbC5tZXJnZSwgMiksCiAgICAgICAgICAgIHJuID0gX2NlbGwkbWVyZ2UzWzBdLAogICAgICAgICAgICBjbiA9IF9jZWxsJG1lcmdlM1sxXTsKCiAgICAgICAgaWYgKHNyaSArIHJuID09PSBlcmkgJiYgc2NpICsgY24gPT09IGVjaSkgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiAhdGhpcy5zZWxlY3Rvci5tdWx0aXBsZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogImNhblVubWVyZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhblVubWVyZ2UoKSB7CiAgICAgIHZhciBfdGhpcyRzZWxlY3RvciRyYW5nZTIgPSB0aGlzLnNlbGVjdG9yLnJhbmdlLAogICAgICAgICAgc3JpID0gX3RoaXMkc2VsZWN0b3IkcmFuZ2UyLnNyaSwKICAgICAgICAgIHNjaSA9IF90aGlzJHNlbGVjdG9yJHJhbmdlMi5zY2ksCiAgICAgICAgICBlcmkgPSBfdGhpcyRzZWxlY3RvciRyYW5nZTIuZXJpLAogICAgICAgICAgZWNpID0gX3RoaXMkc2VsZWN0b3IkcmFuZ2UyLmVjaTsKICAgICAgdmFyIGNlbGwgPSB0aGlzLmdldENlbGwoc3JpLCBzY2kpOwoKICAgICAgaWYgKGNlbGwgJiYgY2VsbC5tZXJnZSkgewogICAgICAgIHZhciBfY2VsbCRtZXJnZTQgPSBfc2xpY2VkVG9BcnJheShjZWxsLm1lcmdlLCAyKSwKICAgICAgICAgICAgcm4gPSBfY2VsbCRtZXJnZTRbMF0sCiAgICAgICAgICAgIGNuID0gX2NlbGwkbWVyZ2U0WzFdOwoKICAgICAgICBpZiAoc3JpICsgcm4gPT09IGVyaSAmJiBzY2kgKyBjbiA9PT0gZWNpKSByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogIm1lcmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtZXJnZSgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICB2YXIgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yLAogICAgICAgICAgcm93cyA9IHRoaXMucm93czsKICAgICAgaWYgKHRoaXMuaXNTaWdubGVTZWxlY3RlZCgpKSByZXR1cm47CgogICAgICB2YXIgX3NlbGVjdG9yJHNpemUzID0gc2VsZWN0b3Iuc2l6ZSgpLAogICAgICAgICAgX3NlbGVjdG9yJHNpemU0ID0gX3NsaWNlZFRvQXJyYXkoX3NlbGVjdG9yJHNpemUzLCAyKSwKICAgICAgICAgIHJuID0gX3NlbGVjdG9yJHNpemU0WzBdLAogICAgICAgICAgY24gPSBfc2VsZWN0b3Ikc2l6ZTRbMV07IC8vIGNvbnNvbGUubG9nKCdtZXJnZTonLCBybiwgY24pOwoKCiAgICAgIGlmIChybiA+IDEgfHwgY24gPiAxKSB7CiAgICAgICAgdmFyIF9zZWxlY3RvciRyYW5nZTMgPSBzZWxlY3Rvci5yYW5nZSwKICAgICAgICAgICAgc3JpID0gX3NlbGVjdG9yJHJhbmdlMy5zcmksCiAgICAgICAgICAgIHNjaSA9IF9zZWxlY3RvciRyYW5nZTMuc2NpOwogICAgICAgIHRoaXMuY2hhbmdlRGF0YShmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgY2VsbCA9IHJvd3MuZ2V0Q2VsbE9yTmV3KHNyaSwgc2NpKTsKICAgICAgICAgIGNlbGwubWVyZ2UgPSBbcm4gLSAxLCBjbiAtIDFdOwoKICAgICAgICAgIF90aGlzOS5tZXJnZXMuYWRkKHNlbGVjdG9yLnJhbmdlKTsgLy8gZGVsZXRlIG1lcmdlIGNlbGxzCgoKICAgICAgICAgIF90aGlzOS5yb3dzLmRlbGV0ZUNlbGxzKHNlbGVjdG9yLnJhbmdlKTsgLy8gY29uc29sZS5sb2coJ2NlbGw6JywgY2VsbCwgdGhpcy5kKTsKCgogICAgICAgICAgX3RoaXM5LnJvd3Muc2V0Q2VsbChzcmksIHNjaSwgY2VsbCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1bm1lcmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1bm1lcmdlKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB2YXIgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yOwogICAgICBpZiAoIXRoaXMuaXNTaWdubGVTZWxlY3RlZCgpKSByZXR1cm47CiAgICAgIHZhciBfc2VsZWN0b3IkcmFuZ2U0ID0gc2VsZWN0b3IucmFuZ2UsCiAgICAgICAgICBzcmkgPSBfc2VsZWN0b3IkcmFuZ2U0LnNyaSwKICAgICAgICAgIHNjaSA9IF9zZWxlY3RvciRyYW5nZTQuc2NpOwogICAgICB0aGlzLmNoYW5nZURhdGEoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTAucm93cy5kZWxldGVDZWxsKHNyaSwgc2NpLCAnbWVyZ2UnKTsKCiAgICAgICAgX3RoaXMxMC5tZXJnZXMuZGVsZXRlV2l0aGluKHNlbGVjdG9yLnJhbmdlKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2FuQXV0b2ZpbHRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuQXV0b2ZpbHRlcigpIHsKICAgICAgcmV0dXJuICF0aGlzLmF1dG9GaWx0ZXIuYWN0aXZlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYXV0b2ZpbHRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYXV0b2ZpbHRlcigpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIGF1dG9GaWx0ZXIgPSB0aGlzLmF1dG9GaWx0ZXIsCiAgICAgICAgICBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3I7CiAgICAgIHRoaXMuY2hhbmdlRGF0YShmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGF1dG9GaWx0ZXIuYWN0aXZlKCkpIHsKICAgICAgICAgIGF1dG9GaWx0ZXIuY2xlYXIoKTsKICAgICAgICAgIF90aGlzMTEuZXhjZXB0Um93U2V0ID0gbmV3IFNldCgpOwogICAgICAgICAgX3RoaXMxMS5zb3J0ZWRSb3dNYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgICBfdGhpczExLnVuc29ydGVkUm93TWFwID0gbmV3IE1hcCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhdXRvRmlsdGVyLnJlZiA9IHNlbGVjdG9yLnJhbmdlLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRBdXRvRmlsdGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBdXRvRmlsdGVyKGNpLCBvcmRlciwgb3BlcmF0b3IsIHZhbHVlKSB7CiAgICAgIHZhciBhdXRvRmlsdGVyID0gdGhpcy5hdXRvRmlsdGVyOwogICAgICBhdXRvRmlsdGVyLmFkZEZpbHRlcihjaSwgb3BlcmF0b3IsIHZhbHVlKTsKICAgICAgYXV0b0ZpbHRlci5zZXRTb3J0KGNpLCBvcmRlcik7CiAgICAgIHRoaXMucmVzZXRBdXRvRmlsdGVyKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVzZXRBdXRvRmlsdGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldEF1dG9GaWx0ZXIoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHZhciBhdXRvRmlsdGVyID0gdGhpcy5hdXRvRmlsdGVyLAogICAgICAgICAgcm93cyA9IHRoaXMucm93czsKICAgICAgaWYgKCFhdXRvRmlsdGVyLmFjdGl2ZSgpKSByZXR1cm47CiAgICAgIHZhciBzb3J0ID0gYXV0b0ZpbHRlci5zb3J0OwoKICAgICAgdmFyIF9hdXRvRmlsdGVyJGZpbHRlcmVkUiA9IGF1dG9GaWx0ZXIuZmlsdGVyZWRSb3dzKGZ1bmN0aW9uIChyLCBjKSB7CiAgICAgICAgcmV0dXJuIHJvd3MuZ2V0Q2VsbChyLCBjKTsKICAgICAgfSksCiAgICAgICAgICByc2V0ID0gX2F1dG9GaWx0ZXIkZmlsdGVyZWRSLnJzZXQsCiAgICAgICAgICBmc2V0ID0gX2F1dG9GaWx0ZXIkZmlsdGVyZWRSLmZzZXQ7CgogICAgICB2YXIgZmFyeSA9IEFycmF5LmZyb20oZnNldCk7CiAgICAgIHZhciBvbGRBcnkgPSBBcnJheS5mcm9tKGZzZXQpOwoKICAgICAgaWYgKHNvcnQpIHsKICAgICAgICBmYXJ5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGlmIChzb3J0Lm9yZGVyID09PSAnYXNjJykgcmV0dXJuIGEgLSBiOwogICAgICAgICAgaWYgKHNvcnQub3JkZXIgPT09ICdkZXNjJykgcmV0dXJuIGIgLSBhOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZXhjZXB0Um93U2V0ID0gcnNldDsKICAgICAgdGhpcy5zb3J0ZWRSb3dNYXAgPSBuZXcgTWFwKCk7CiAgICAgIHRoaXMudW5zb3J0ZWRSb3dNYXAgPSBuZXcgTWFwKCk7CiAgICAgIGZhcnkuZm9yRWFjaChmdW5jdGlvbiAoaXQsIGluZGV4KSB7CiAgICAgICAgX3RoaXMxMi5zb3J0ZWRSb3dNYXAuc2V0KG9sZEFyeVtpbmRleF0sIGl0KTsKCiAgICAgICAgX3RoaXMxMi51bnNvcnRlZFJvd01hcC5zZXQoaXQsIG9sZEFyeVtpbmRleF0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZWxldGVDZWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWxldGVDZWxsKCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICB2YXIgd2hhdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJ2FsbCc7CiAgICAgIHZhciBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3I7CiAgICAgIHRoaXMuY2hhbmdlRGF0YShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMy5yb3dzLmRlbGV0ZUNlbGxzKHNlbGVjdG9yLnJhbmdlLCB3aGF0KTsKCiAgICAgICAgaWYgKHdoYXQgPT09ICdhbGwnIHx8IHdoYXQgPT09ICdmb3JtYXQnKSB7CiAgICAgICAgICBfdGhpczEzLm1lcmdlcy5kZWxldGVXaXRoaW4oc2VsZWN0b3IucmFuZ2UpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IC8vIHR5cGU6IHJvdyB8IGNvbHVtbgoKICB9LCB7CiAgICBrZXk6ICJpbnNlcnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluc2VydCh0eXBlKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOwogICAgICB0aGlzLmNoYW5nZURhdGEoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfdGhpczE0JHNlbGVjdG9yJHJhbmcgPSBfdGhpczE0LnNlbGVjdG9yLnJhbmdlLAogICAgICAgICAgICBzcmkgPSBfdGhpczE0JHNlbGVjdG9yJHJhbmcuc3JpLAogICAgICAgICAgICBzY2kgPSBfdGhpczE0JHNlbGVjdG9yJHJhbmcuc2NpOwogICAgICAgIHZhciByb3dzID0gX3RoaXMxNC5yb3dzLAogICAgICAgICAgICBtZXJnZXMgPSBfdGhpczE0Lm1lcmdlcywKICAgICAgICAgICAgY29scyA9IF90aGlzMTQuY29sczsKICAgICAgICB2YXIgc2kgPSBzcmk7CgogICAgICAgIGlmICh0eXBlID09PSAncm93JykgewogICAgICAgICAgcm93cy5pbnNlcnQoc3JpLCBuKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjb2x1bW4nKSB7CiAgICAgICAgICByb3dzLmluc2VydENvbHVtbihzY2ksIG4pOwogICAgICAgICAgc2kgPSBzY2k7CiAgICAgICAgICBjb2xzLmxlbiArPSAxOwogICAgICAgIH0KCiAgICAgICAgbWVyZ2VzLnNoaWZ0KHR5cGUsIHNpLCBuLCBmdW5jdGlvbiAocmksIGNpLCBybiwgY24pIHsKICAgICAgICAgIHZhciBjZWxsID0gcm93cy5nZXRDZWxsKHJpLCBjaSk7CiAgICAgICAgICBjZWxsLm1lcmdlWzBdICs9IHJuOwogICAgICAgICAgY2VsbC5tZXJnZVsxXSArPSBjbjsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9IC8vIHR5cGU6IHJvdyB8IGNvbHVtbgoKICB9LCB7CiAgICBrZXk6ICJkZWxldGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUodHlwZSkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICB0aGlzLmNoYW5nZURhdGEoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciByb3dzID0gX3RoaXMxNS5yb3dzLAogICAgICAgICAgICBtZXJnZXMgPSBfdGhpczE1Lm1lcmdlcywKICAgICAgICAgICAgc2VsZWN0b3IgPSBfdGhpczE1LnNlbGVjdG9yLAogICAgICAgICAgICBjb2xzID0gX3RoaXMxNS5jb2xzOwogICAgICAgIHZhciByYW5nZSA9IHNlbGVjdG9yLnJhbmdlOwogICAgICAgIHZhciBfc2VsZWN0b3IkcmFuZ2U1ID0gc2VsZWN0b3IucmFuZ2UsCiAgICAgICAgICAgIHNyaSA9IF9zZWxlY3RvciRyYW5nZTUuc3JpLAogICAgICAgICAgICBzY2kgPSBfc2VsZWN0b3IkcmFuZ2U1LnNjaSwKICAgICAgICAgICAgZXJpID0gX3NlbGVjdG9yJHJhbmdlNS5lcmksCiAgICAgICAgICAgIGVjaSA9IF9zZWxlY3RvciRyYW5nZTUuZWNpOwoKICAgICAgICB2YXIgX3NlbGVjdG9yJHJhbmdlJHNpemUgPSBzZWxlY3Rvci5yYW5nZS5zaXplKCksCiAgICAgICAgICAgIF9zZWxlY3RvciRyYW5nZSRzaXplMiA9IF9zbGljZWRUb0FycmF5KF9zZWxlY3RvciRyYW5nZSRzaXplLCAyKSwKICAgICAgICAgICAgcnNpemUgPSBfc2VsZWN0b3IkcmFuZ2Ukc2l6ZTJbMF0sCiAgICAgICAgICAgIGNzaXplID0gX3NlbGVjdG9yJHJhbmdlJHNpemUyWzFdOwoKICAgICAgICB2YXIgc2kgPSBzcmk7CiAgICAgICAgdmFyIHNpemUgPSByc2l6ZTsKCiAgICAgICAgaWYgKHR5cGUgPT09ICdyb3cnKSB7CiAgICAgICAgICByb3dzLmRlbGV0ZShzcmksIGVyaSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnY29sdW1uJykgewogICAgICAgICAgcm93cy5kZWxldGVDb2x1bW4oc2NpLCBlY2kpOwogICAgICAgICAgc2kgPSByYW5nZS5zY2k7CiAgICAgICAgICBzaXplID0gY3NpemU7CiAgICAgICAgICBjb2xzLmxlbiAtPSAxOwogICAgICAgIH0gLy8gY29uc29sZS5sb2coJ3R5cGU6JywgdHlwZSwgJywgc2k6Jywgc2ksICcsIHNpemU6Jywgc2l6ZSk7CgoKICAgICAgICBtZXJnZXMuc2hpZnQodHlwZSwgc2ksIC1zaXplLCBmdW5jdGlvbiAocmksIGNpLCBybiwgY24pIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdyaTonLCByaSwgJywgY2k6JywgY2ksICcsIHJuOicsIHJuLCAnLCBjbjonLCBjbik7CiAgICAgICAgICB2YXIgY2VsbCA9IHJvd3MuZ2V0Q2VsbChyaSwgY2kpOwogICAgICAgICAgY2VsbC5tZXJnZVswXSArPSBybjsKICAgICAgICAgIGNlbGwubWVyZ2VbMV0gKz0gY247CgogICAgICAgICAgaWYgKGNlbGwubWVyZ2VbMF0gPT09IDAgJiYgY2VsbC5tZXJnZVsxXSA9PT0gMCkgewogICAgICAgICAgICBkZWxldGUgY2VsbC5tZXJnZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2Nyb2xseCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2Nyb2xseCh4LCBjYikgewogICAgICB2YXIgc2Nyb2xsID0gdGhpcy5zY3JvbGwsCiAgICAgICAgICBmcmVlemUgPSB0aGlzLmZyZWV6ZSwKICAgICAgICAgIGNvbHMgPSB0aGlzLmNvbHM7CgogICAgICB2YXIgX2ZyZWV6ZSA9IF9zbGljZWRUb0FycmF5KGZyZWV6ZSwgMiksCiAgICAgICAgICBmY2kgPSBfZnJlZXplWzFdOwoKICAgICAgdmFyIF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjMgPSBoZWxwZXIucmFuZ2VSZWR1Y2VJZihmY2ksIGNvbHMubGVuLCAwLCAwLCB4LCBmdW5jdGlvbiAoaSkgewogICAgICAgIHJldHVybiBjb2xzLmdldFdpZHRoKGkpOwogICAgICB9KSwKICAgICAgICAgIF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjQgPSBfc2xpY2VkVG9BcnJheShfaGVscGVyJHJhbmdlUmVkdWNlSWYzLCAzKSwKICAgICAgICAgIGNpID0gX2hlbHBlciRyYW5nZVJlZHVjZUlmNFswXSwKICAgICAgICAgIGxlZnQgPSBfaGVscGVyJHJhbmdlUmVkdWNlSWY0WzFdLAogICAgICAgICAgd2lkdGggPSBfaGVscGVyJHJhbmdlUmVkdWNlSWY0WzJdOyAvLyBjb25zb2xlLmxvZygnZmNpOicsIGZjaSwgJywgY2k6JywgY2kpOwoKCiAgICAgIHZhciB4MSA9IGxlZnQ7CiAgICAgIGlmICh4ID4gMCkgeDEgKz0gd2lkdGg7CgogICAgICBpZiAoc2Nyb2xsLnggIT09IHgxKSB7CiAgICAgICAgc2Nyb2xsLmNpID0geCA+IDAgPyBjaSA6IDA7CiAgICAgICAgc2Nyb2xsLnggPSB4MTsKICAgICAgICBjYigpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2Nyb2xseSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2Nyb2xseSh5LCBjYikgewogICAgICB2YXIgc2Nyb2xsID0gdGhpcy5zY3JvbGwsCiAgICAgICAgICBmcmVlemUgPSB0aGlzLmZyZWV6ZSwKICAgICAgICAgIHJvd3MgPSB0aGlzLnJvd3M7CgogICAgICB2YXIgX2ZyZWV6ZTIgPSBfc2xpY2VkVG9BcnJheShmcmVlemUsIDEpLAogICAgICAgICAgZnJpID0gX2ZyZWV6ZTJbMF07CgogICAgICB2YXIgX2hlbHBlciRyYW5nZVJlZHVjZUlmNSA9IGhlbHBlci5yYW5nZVJlZHVjZUlmKGZyaSwgcm93cy5sZW4sIDAsIDAsIHksIGZ1bmN0aW9uIChpKSB7CiAgICAgICAgcmV0dXJuIHJvd3MuZ2V0SGVpZ2h0KGkpOwogICAgICB9KSwKICAgICAgICAgIF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjYgPSBfc2xpY2VkVG9BcnJheShfaGVscGVyJHJhbmdlUmVkdWNlSWY1LCAzKSwKICAgICAgICAgIHJpID0gX2hlbHBlciRyYW5nZVJlZHVjZUlmNlswXSwKICAgICAgICAgIHRvcCA9IF9oZWxwZXIkcmFuZ2VSZWR1Y2VJZjZbMV0sCiAgICAgICAgICBoZWlnaHQgPSBfaGVscGVyJHJhbmdlUmVkdWNlSWY2WzJdOwoKICAgICAgdmFyIHkxID0gdG9wOwogICAgICBpZiAoeSA+IDApIHkxICs9IGhlaWdodDsgLy8gY29uc29sZS5sb2coJ3JpOicsIHJpLCAnICx5OicsIHkxKTsKCiAgICAgIGlmIChzY3JvbGwueSAhPT0geTEpIHsKICAgICAgICBzY3JvbGwucmkgPSB5ID4gMCA/IHJpIDogMDsKICAgICAgICBzY3JvbGwueSA9IHkxOwogICAgICAgIGNiKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjZWxsUmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2VsbFJlY3QocmksIGNpKSB7CiAgICAgIHZhciByb3dzID0gdGhpcy5yb3dzLAogICAgICAgICAgY29scyA9IHRoaXMuY29sczsKICAgICAgdmFyIGxlZnQgPSBjb2xzLnN1bVdpZHRoKDAsIGNpKTsKICAgICAgdmFyIHRvcCA9IHJvd3Muc3VtSGVpZ2h0KDAsIHJpKTsKICAgICAgdmFyIGNlbGwgPSByb3dzLmdldENlbGwocmksIGNpKTsKICAgICAgdmFyIHdpZHRoID0gY29scy5nZXRXaWR0aChjaSk7CiAgICAgIHZhciBoZWlnaHQgPSByb3dzLmdldEhlaWdodChyaSk7CgogICAgICBpZiAoY2VsbCAhPT0gbnVsbCkgewogICAgICAgIGlmIChjZWxsLm1lcmdlKSB7CiAgICAgICAgICB2YXIgX2NlbGwkbWVyZ2U1ID0gX3NsaWNlZFRvQXJyYXkoY2VsbC5tZXJnZSwgMiksCiAgICAgICAgICAgICAgcm4gPSBfY2VsbCRtZXJnZTVbMF0sCiAgICAgICAgICAgICAgY24gPSBfY2VsbCRtZXJnZTVbMV07IC8vIGNvbnNvbGUubG9nKCdjZWxsLm1lcmdlOicsIGNlbGwubWVyZ2UpOwoKCiAgICAgICAgICBpZiAocm4gPiAwKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IHJuOyBpICs9IDEpIHsKICAgICAgICAgICAgICBoZWlnaHQgKz0gcm93cy5nZXRIZWlnaHQocmkgKyBpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjbiA+IDApIHsKICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8PSBjbjsgX2kgKz0gMSkgewogICAgICAgICAgICAgIHdpZHRoICs9IGNvbHMuZ2V0V2lkdGgoY2kgKyBfaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gY29uc29sZS5sb2coJ2RhdGE6JywgdGhpcy5kKTsKCgogICAgICByZXR1cm4gewogICAgICAgIGxlZnQ6IGxlZnQsCiAgICAgICAgdG9wOiB0b3AsCiAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgIGhlaWdodDogaGVpZ2h0LAogICAgICAgIGNlbGw6IGNlbGwKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDZWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDZWxsKHJpLCBjaSkgewogICAgICByZXR1cm4gdGhpcy5yb3dzLmdldENlbGwocmksIGNpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDZWxsVGV4dE9yRGVmYXVsdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2VsbFRleHRPckRlZmF1bHQocmksIGNpKSB7CiAgICAgIHZhciBjZWxsID0gdGhpcy5nZXRDZWxsKHJpLCBjaSk7CiAgICAgIHJldHVybiBjZWxsICYmIGNlbGwudGV4dCA/IGNlbGwudGV4dCA6ICcnOwogICAgfQogIH0sIHsKICAgIGtleTogImdldENlbGxTdHlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2VsbFN0eWxlKHJpLCBjaSkgewogICAgICB2YXIgY2VsbCA9IHRoaXMuZ2V0Q2VsbChyaSwgY2kpOwoKICAgICAgaWYgKGNlbGwgJiYgY2VsbC5zdHlsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3R5bGVzW2NlbGwuc3R5bGVdOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDZWxsU3R5bGVPckRlZmF1bHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENlbGxTdHlsZU9yRGVmYXVsdChyaSwgY2kpIHsKICAgICAgdmFyIHN0eWxlcyA9IHRoaXMuc3R5bGVzLAogICAgICAgICAgcm93cyA9IHRoaXMucm93czsKICAgICAgdmFyIGNlbGwgPSByb3dzLmdldENlbGwocmksIGNpKTsKICAgICAgdmFyIGNlbGxTdHlsZSA9IGNlbGwgJiYgY2VsbC5zdHlsZSAhPT0gdW5kZWZpbmVkID8gc3R5bGVzW2NlbGwuc3R5bGVdIDoge307CiAgICAgIHJldHVybiBoZWxwZXIubWVyZ2UodGhpcy5kZWZhdWx0U3R5bGUoKSwgY2VsbFN0eWxlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3RlZENlbGxTdHlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2VsZWN0ZWRDZWxsU3R5bGUoKSB7CiAgICAgIHZhciBfdGhpcyRzZWxlY3RvcjQgPSB0aGlzLnNlbGVjdG9yLAogICAgICAgICAgcmkgPSBfdGhpcyRzZWxlY3RvcjQucmksCiAgICAgICAgICBjaSA9IF90aGlzJHNlbGVjdG9yNC5jaTsKICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2VsbFN0eWxlT3JEZWZhdWx0KHJpLCBjaSk7CiAgICB9IC8vIHN0YXRlOiBpbnB1dCB8IGZpbmlzaGVkCgogIH0sIHsKICAgIGtleTogInNldENlbGxUZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDZWxsVGV4dChyaSwgY2ksIHRleHQsIHN0YXRlKSB7CiAgICAgIHZhciByb3dzID0gdGhpcy5yb3dzLAogICAgICAgICAgaGlzdG9yeSA9IHRoaXMuaGlzdG9yeSwKICAgICAgICAgIHZhbGlkYXRpb25zID0gdGhpcy52YWxpZGF0aW9uczsKCiAgICAgIGlmIChzdGF0ZSA9PT0gJ2ZpbmlzaGVkJykgewogICAgICAgIHJvd3Muc2V0Q2VsbFRleHQocmksIGNpLCAnJyk7CiAgICAgICAgaGlzdG9yeS5hZGQodGhpcy5nZXREYXRhKCkpOwogICAgICAgIHJvd3Muc2V0Q2VsbFRleHQocmksIGNpLCB0ZXh0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByb3dzLnNldENlbGxUZXh0KHJpLCBjaSwgdGV4dCk7CiAgICAgICAgdGhpcy5jaGFuZ2UodGhpcy5nZXREYXRhKCkpOwogICAgICB9IC8vIHZhbGlkYXRvcgoKCiAgICAgIHZhbGlkYXRpb25zLnZhbGlkYXRlKHJpLCBjaSwgdGV4dCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZnJlZXplSXNBY3RpdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZyZWV6ZUlzQWN0aXZlKCkgewogICAgICB2YXIgX3RoaXMkZnJlZXplID0gX3NsaWNlZFRvQXJyYXkodGhpcy5mcmVlemUsIDIpLAogICAgICAgICAgcmkgPSBfdGhpcyRmcmVlemVbMF0sCiAgICAgICAgICBjaSA9IF90aGlzJGZyZWV6ZVsxXTsKCiAgICAgIHJldHVybiByaSA+IDAgfHwgY2kgPiAwOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEZyZWV6ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RnJlZXplKHJpLCBjaSkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICB0aGlzLmNoYW5nZURhdGEoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTYuZnJlZXplID0gW3JpLCBjaV07CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImZyZWV6ZVRvdGFsV2lkdGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZyZWV6ZVRvdGFsV2lkdGgoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbHMuc3VtV2lkdGgoMCwgdGhpcy5mcmVlemVbMV0pOwogICAgfQogIH0sIHsKICAgIGtleTogImZyZWV6ZVRvdGFsSGVpZ2h0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmcmVlemVUb3RhbEhlaWdodCgpIHsKICAgICAgcmV0dXJuIHRoaXMucm93cy5zdW1IZWlnaHQoMCwgdGhpcy5mcmVlemVbMF0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFJvd0hlaWdodCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Um93SGVpZ2h0KHJpLCBoZWlnaHQpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgdGhpcy5jaGFuZ2VEYXRhKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE3LnJvd3Muc2V0SGVpZ2h0KHJpLCBoZWlnaHQpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRDb2xXaWR0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sV2lkdGgoY2ksIHdpZHRoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKCiAgICAgIHRoaXMuY2hhbmdlRGF0YShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOC5jb2xzLnNldFdpZHRoKGNpLCB3aWR0aCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInZpZXdIZWlnaHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZpZXdIZWlnaHQoKSB7CiAgICAgIHZhciBfdGhpcyRzZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3MsCiAgICAgICAgICB2aWV3ID0gX3RoaXMkc2V0dGluZ3MudmlldywKICAgICAgICAgIHNob3dUb29sYmFyID0gX3RoaXMkc2V0dGluZ3Muc2hvd1Rvb2xiYXI7CiAgICAgIHZhciBoID0gdmlldy5oZWlnaHQoKTsKICAgICAgaCAtPSBib3R0b21iYXJIZWlnaHQ7CgogICAgICBpZiAoc2hvd1Rvb2xiYXIpIHsKICAgICAgICBoIC09IHRvb2xiYXJIZWlnaHQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBoOwogICAgfQogIH0sIHsKICAgIGtleTogInZpZXdXaWR0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmlld1dpZHRoKCkgewogICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy52aWV3LndpZHRoKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZnJlZXplVmlld1JhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmcmVlemVWaWV3UmFuZ2UoKSB7CiAgICAgIHZhciBfdGhpcyRmcmVlemUyID0gX3NsaWNlZFRvQXJyYXkodGhpcy5mcmVlemUsIDIpLAogICAgICAgICAgcmkgPSBfdGhpcyRmcmVlemUyWzBdLAogICAgICAgICAgY2kgPSBfdGhpcyRmcmVlemUyWzFdOwoKICAgICAgcmV0dXJuIG5ldyBDZWxsUmFuZ2UoMCwgMCwgcmkgLSAxLCBjaSAtIDEsIHRoaXMuZnJlZXplVG90YWxXaWR0aCgpLCB0aGlzLmZyZWV6ZVRvdGFsSGVpZ2h0KCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbnRlbnRSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29udGVudFJhbmdlKCkgewogICAgICB2YXIgcm93cyA9IHRoaXMucm93cywKICAgICAgICAgIGNvbHMgPSB0aGlzLmNvbHM7CgogICAgICB2YXIgX3Jvd3MkbWF4Q2VsbCA9IHJvd3MubWF4Q2VsbCgpLAogICAgICAgICAgX3Jvd3MkbWF4Q2VsbDIgPSBfc2xpY2VkVG9BcnJheShfcm93cyRtYXhDZWxsLCAyKSwKICAgICAgICAgIHJpID0gX3Jvd3MkbWF4Q2VsbDJbMF0sCiAgICAgICAgICBjaSA9IF9yb3dzJG1heENlbGwyWzFdOwoKICAgICAgdmFyIGggPSByb3dzLnN1bUhlaWdodCgwLCByaSArIDEpOwogICAgICB2YXIgdyA9IGNvbHMuc3VtV2lkdGgoMCwgY2kgKyAxKTsKICAgICAgcmV0dXJuIG5ldyBDZWxsUmFuZ2UoMCwgMCwgcmksIGNpLCB3LCBoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJleGNlcHRSb3dUb3RhbEhlaWdodCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhjZXB0Um93VG90YWxIZWlnaHQoc3JpLCBlcmkpIHsKICAgICAgdmFyIGV4Y2VwdFJvd1NldCA9IHRoaXMuZXhjZXB0Um93U2V0LAogICAgICAgICAgcm93cyA9IHRoaXMucm93czsKICAgICAgdmFyIGV4Y2VwdFJvd3MgPSBBcnJheS5mcm9tKGV4Y2VwdFJvd1NldCk7CiAgICAgIHZhciBleGNlcHRSb3dUSCA9IDA7CiAgICAgIGV4Y2VwdFJvd3MuZm9yRWFjaChmdW5jdGlvbiAocmkpIHsKICAgICAgICBpZiAocmkgPCBzcmkgfHwgcmkgPiBlcmkpIHsKICAgICAgICAgIHZhciBoZWlnaHQgPSByb3dzLmdldEhlaWdodChyaSk7CiAgICAgICAgICBleGNlcHRSb3dUSCArPSBoZWlnaHQ7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGV4Y2VwdFJvd1RIOwogICAgfQogIH0sIHsKICAgIGtleTogInZpZXdSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmlld1JhbmdlKCkgewogICAgICB2YXIgc2Nyb2xsID0gdGhpcy5zY3JvbGwsCiAgICAgICAgICByb3dzID0gdGhpcy5yb3dzLAogICAgICAgICAgY29scyA9IHRoaXMuY29scywKICAgICAgICAgIGZyZWV6ZSA9IHRoaXMuZnJlZXplLAogICAgICAgICAgZXhjZXB0Um93U2V0ID0gdGhpcy5leGNlcHRSb3dTZXQ7IC8vIGNvbnNvbGUubG9nKCdzY3JvbGw6Jywgc2Nyb2xsLCAnLCBmcmVlemU6JywgZnJlZXplKQoKICAgICAgdmFyIHJpID0gc2Nyb2xsLnJpLAogICAgICAgICAgY2kgPSBzY3JvbGwuY2k7CgogICAgICBpZiAocmkgPD0gMCkgewogICAgICAgIHZhciBfZnJlZXplMyA9IF9zbGljZWRUb0FycmF5KGZyZWV6ZSwgMSk7CgogICAgICAgIHJpID0gX2ZyZWV6ZTNbMF07CiAgICAgIH0KCiAgICAgIGlmIChjaSA8PSAwKSB7CiAgICAgICAgdmFyIF9mcmVlemU0ID0gX3NsaWNlZFRvQXJyYXkoZnJlZXplLCAyKTsKCiAgICAgICAgY2kgPSBfZnJlZXplNFsxXTsKICAgICAgfQoKICAgICAgdmFyIHggPSAwLAogICAgICAgICAgeSA9IDA7CiAgICAgIHZhciBfcmVmMiA9IFtyb3dzLmxlbiwgY29scy5sZW5dLAogICAgICAgICAgZXJpID0gX3JlZjJbMF0sCiAgICAgICAgICBlY2kgPSBfcmVmMlsxXTsKCiAgICAgIGZvciAodmFyIGkgPSByaTsgaSA8IHJvd3MubGVuOyBpICs9IDEpIHsKICAgICAgICBpZiAoIWV4Y2VwdFJvd1NldC5oYXMoaSkpIHsKICAgICAgICAgIHkgKz0gcm93cy5nZXRIZWlnaHQoaSk7CiAgICAgICAgICBlcmkgPSBpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiB0aGlzLnZpZXdIZWlnaHQoKSkgYnJlYWs7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGogPSBjaTsgaiA8IGNvbHMubGVuOyBqICs9IDEpIHsKICAgICAgICB4ICs9IGNvbHMuZ2V0V2lkdGgoaik7CiAgICAgICAgZWNpID0gajsKICAgICAgICBpZiAoeCA+IHRoaXMudmlld1dpZHRoKCkpIGJyZWFrOwogICAgICB9IC8vIGNvbnNvbGUubG9nKHJpLCBjaSwgZXJpLCBlY2ksIHgsIHkpOwoKCiAgICAgIHJldHVybiBuZXcgQ2VsbFJhbmdlKHJpLCBjaSwgZXJpLCBlY2ksIHgsIHkpOwogICAgfQogIH0sIHsKICAgIGtleTogImVhY2hNZXJnZXNJblZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVhY2hNZXJnZXNJblZpZXcodmlld1JhbmdlLCBjYikgewogICAgICB0aGlzLm1lcmdlcy5maWx0ZXJJbnRlcnNlY3RzKHZpZXdSYW5nZSkuZm9yRWFjaChmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gY2IoaXQpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoaWRlUm93c09yQ29scyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGlkZVJvd3NPckNvbHMoKSB7CiAgICAgIHZhciByb3dzID0gdGhpcy5yb3dzLAogICAgICAgICAgY29scyA9IHRoaXMuY29scywKICAgICAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvcjsKCiAgICAgIHZhciBfc2VsZWN0b3Ikc2l6ZTUgPSBzZWxlY3Rvci5zaXplKCksCiAgICAgICAgICBfc2VsZWN0b3Ikc2l6ZTYgPSBfc2xpY2VkVG9BcnJheShfc2VsZWN0b3Ikc2l6ZTUsIDIpLAogICAgICAgICAgcmxlbiA9IF9zZWxlY3RvciRzaXplNlswXSwKICAgICAgICAgIGNsZW4gPSBfc2VsZWN0b3Ikc2l6ZTZbMV07CgogICAgICB2YXIgX3NlbGVjdG9yJHJhbmdlNiA9IHNlbGVjdG9yLnJhbmdlLAogICAgICAgICAgc3JpID0gX3NlbGVjdG9yJHJhbmdlNi5zcmksCiAgICAgICAgICBzY2kgPSBfc2VsZWN0b3IkcmFuZ2U2LnNjaSwKICAgICAgICAgIGVyaSA9IF9zZWxlY3RvciRyYW5nZTYuZXJpLAogICAgICAgICAgZWNpID0gX3NlbGVjdG9yJHJhbmdlNi5lY2k7CgogICAgICBpZiAocmxlbiA9PT0gcm93cy5sZW4pIHsKICAgICAgICBmb3IgKHZhciBjaSA9IHNjaTsgY2kgPD0gZWNpOyBjaSArPSAxKSB7CiAgICAgICAgICBjb2xzLnNldEhpZGUoY2ksIHRydWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjbGVuID09PSBjb2xzLmxlbikgewogICAgICAgIGZvciAodmFyIHJpID0gc3JpOyByaSA8PSBlcmk7IHJpICs9IDEpIHsKICAgICAgICAgIHJvd3Muc2V0SGlkZShyaSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIHR5cGU6IHJvdyB8IGNvbAogICAgLy8gaW5kZXggcm93LWluZGV4IHwgY29sLWluZGV4CgogIH0sIHsKICAgIGtleTogInVuaGlkZVJvd3NPckNvbHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVuaGlkZVJvd3NPckNvbHModHlwZSwgaW5kZXgpIHsKICAgICAgdGhpc1siIi5jb25jYXQodHlwZSwgInMiKV0udW5oaWRlKGluZGV4KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyb3dFYWNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3dFYWNoKG1pbiwgbWF4LCBjYikgewogICAgICB2YXIgeSA9IDA7CiAgICAgIHZhciByb3dzID0gdGhpcy5yb3dzOwogICAgICB2YXIgZnJzZXQgPSB0aGlzLmV4Y2VwdFJvd1NldDsKCiAgICAgIHZhciBmcmFyeSA9IF90b0NvbnN1bWFibGVBcnJheShmcnNldCk7CgogICAgICB2YXIgb2Zmc2V0ID0gMDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnJhcnkubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAoZnJhcnlbaV0gPCBtaW4pIHsKICAgICAgICAgIG9mZnNldCArPSAxOwogICAgICAgIH0KICAgICAgfSAvLyBjb25zb2xlLmxvZygnbWluOicsIG1pbiwgJywgbWF4OicsIG1heCwgJywgc2Nyb2xsOicsIHNjcm9sbCk7CgoKICAgICAgZm9yICh2YXIgX2kyID0gbWluICsgb2Zmc2V0OyBfaTIgPD0gbWF4ICsgb2Zmc2V0OyBfaTIgKz0gMSkgewogICAgICAgIGlmIChmcnNldC5oYXMoX2kyKSkgewogICAgICAgICAgb2Zmc2V0ICs9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciByb3dIZWlnaHQgPSByb3dzLmdldEhlaWdodChfaTIpOwoKICAgICAgICAgIGlmIChyb3dIZWlnaHQgPiAwKSB7CiAgICAgICAgICAgIGNiKF9pMiwgeSwgcm93SGVpZ2h0KTsKICAgICAgICAgICAgeSArPSByb3dIZWlnaHQ7CiAgICAgICAgICAgIGlmICh5ID4gdGhpcy52aWV3SGVpZ2h0KCkpIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbEVhY2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbEVhY2gobWluLCBtYXgsIGNiKSB7CiAgICAgIHZhciB4ID0gMDsKICAgICAgdmFyIGNvbHMgPSB0aGlzLmNvbHM7CgogICAgICBmb3IgKHZhciBpID0gbWluOyBpIDw9IG1heDsgaSArPSAxKSB7CiAgICAgICAgdmFyIGNvbFdpZHRoID0gY29scy5nZXRXaWR0aChpKTsKCiAgICAgICAgaWYgKGNvbFdpZHRoID4gMCkgewogICAgICAgICAgY2IoaSwgeCwgY29sV2lkdGgpOwogICAgICAgICAgeCArPSBjb2xXaWR0aDsKICAgICAgICAgIGlmICh4ID4gdGhpcy52aWV3V2lkdGgoKSkgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVmYXVsdFN0eWxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWZhdWx0U3R5bGUoKSB7CiAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnN0eWxlOwogICAgfQogIH0sIHsKICAgIGtleTogImFkZFN0eWxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRTdHlsZShuc3R5bGUpIHsKICAgICAgdmFyIHN0eWxlcyA9IHRoaXMuc3R5bGVzOyAvLyBjb25zb2xlLmxvZygnb2xkLnN0eWxlczonLCBzdHlsZXMsIG5zdHlsZSk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0eWxlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgIHZhciBzdHlsZSA9IHN0eWxlc1tpXTsKICAgICAgICBpZiAoaGVscGVyLmVxdWFscyhzdHlsZSwgbnN0eWxlKSkgcmV0dXJuIGk7CiAgICAgIH0KCiAgICAgIHN0eWxlcy5wdXNoKG5zdHlsZSk7CiAgICAgIHJldHVybiBzdHlsZXMubGVuZ3RoIC0gMTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjaGFuZ2VEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFuZ2VEYXRhKGNiKSB7CiAgICAgIHRoaXMuaGlzdG9yeS5hZGQodGhpcy5nZXREYXRhKCkpOwogICAgICBjYigpOwogICAgICB0aGlzLmNoYW5nZSh0aGlzLmdldERhdGEoKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RGF0YShkKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKCiAgICAgIE9iamVjdC5rZXlzKGQpLmZvckVhY2goZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgICAgaWYgKHByb3BlcnR5ID09PSAnbWVyZ2VzJyB8fCBwcm9wZXJ0eSA9PT0gJ3Jvd3MnIHx8IHByb3BlcnR5ID09PSAnY29scycgfHwgcHJvcGVydHkgPT09ICd2YWxpZGF0aW9ucycpIHsKICAgICAgICAgIF90aGlzMTlbcHJvcGVydHldLnNldERhdGEoZFtwcm9wZXJ0eV0pOwogICAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkgPT09ICdmcmVlemUnKSB7CiAgICAgICAgICB2YXIgX2V4cHIyeHkgPSBleHByMnh5KGRbcHJvcGVydHldKSwKICAgICAgICAgICAgICBfZXhwcjJ4eTIgPSBfc2xpY2VkVG9BcnJheShfZXhwcjJ4eSwgMiksCiAgICAgICAgICAgICAgeCA9IF9leHByMnh5MlswXSwKICAgICAgICAgICAgICB5ID0gX2V4cHIyeHkyWzFdOwoKICAgICAgICAgIF90aGlzMTkuZnJlZXplID0gW3ksIHhdOwogICAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkgPT09ICdhdXRvZmlsdGVyJykgewogICAgICAgICAgX3RoaXMxOS5hdXRvRmlsdGVyLnNldERhdGEoZFtwcm9wZXJ0eV0pOwogICAgICAgIH0gZWxzZSBpZiAoZFtwcm9wZXJ0eV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgX3RoaXMxOVtwcm9wZXJ0eV0gPSBkW3Byb3BlcnR5XTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREYXRhKCkgewogICAgICB2YXIgbmFtZSA9IHRoaXMubmFtZSwKICAgICAgICAgIGZyZWV6ZSA9IHRoaXMuZnJlZXplLAogICAgICAgICAgc3R5bGVzID0gdGhpcy5zdHlsZXMsCiAgICAgICAgICBtZXJnZXMgPSB0aGlzLm1lcmdlcywKICAgICAgICAgIHJvd3MgPSB0aGlzLnJvd3MsCiAgICAgICAgICBjb2xzID0gdGhpcy5jb2xzLAogICAgICAgICAgdmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLAogICAgICAgICAgYXV0b0ZpbHRlciA9IHRoaXMuYXV0b0ZpbHRlcjsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGZyZWV6ZTogeHkyZXhwcihmcmVlemVbMV0sIGZyZWV6ZVswXSksCiAgICAgICAgc3R5bGVzOiBzdHlsZXMsCiAgICAgICAgbWVyZ2VzOiBtZXJnZXMuZ2V0RGF0YSgpLAogICAgICAgIHJvd3M6IHJvd3MuZ2V0RGF0YSgpLAogICAgICAgIGNvbHM6IGNvbHMuZ2V0RGF0YSgpLAogICAgICAgIHZhbGlkYXRpb25zOiB2YWxpZGF0aW9ucy5nZXREYXRhKCksCiAgICAgICAgYXV0b2ZpbHRlcjogYXV0b0ZpbHRlci5nZXREYXRhKCkKICAgICAgfTsKICAgIH0KICB9XSk7CgogIHJldHVybiBEYXRhUHJveHk7Cn0oKTsKCmV4cG9ydCB7IERhdGFQcm94eSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["C:/Users/吴建明/Desktop/VisualizationExcle_Demo/src/components/x-spreadsheet/core/data_proxy.js"],"names":["Selector","Scroll","History","Clipboard","AutoFilter","Merges","helper","Rows","Cols","Validations","CellRange","expr2xy","xy2expr","t","defaultSettings","mode","view","height","document","documentElement","clientHeight","width","clientWidth","showGrid","showToolbar","showContextmenu","row","len","col","indexWidth","minWidth","style","bgcolor","align","valign","textwrap","strike","underline","color","font","name","size","bold","italic","format","toolbarHeight","bottombarHeight","canPaste","src","dst","error","merges","cellRange","clone","srn","scn","drn","dcn","eri","sri","eci","sci","intersects","copyPaste","srcCellRange","dstCellRange","what","autofill","rows","deleteCells","deleteWithin","ri","ci","cell","merge","rn","cn","add","cutPaste","clipboard","move","clear","setStyleBorder","bss","styles","getCellOrNew","cstyle","undefined","cloneDeep","border","addStyle","setStyleBorders","selector","range","multiple","isSignleSelected","call","top","bottom","left","right","each","getCell","ns","mergeIndexes","ii","length","mri","mci","push","forEach","it","splice","mrl","mcl","Object","keys","getCellMerge","getCellRowByY","y","scrollOffsety","fsh","freezeTotalHeight","inits","frset","exceptRowSet","has","getHeight","getCellColByX","x","scrollOffsetx","cols","fsw","freezeTotalWidth","rangeReduceIf","i","getWidth","DataProxy","settings","freeze","validations","hyperlinks","comments","scroll","history","autoFilter","change","Set","sortedRowMap","Map","unsortedRowMap","ref","validator","changeData","remove","v","get","ret","toString","canUndo","canRedo","undo","getData","d","setData","redo","copy","cut","isClear","isCopy","isCut","txt","lines","split","map","replace","paste","srcRange","cri","cci","nri","nci","union","getFirstIncludes","property","value","unmerge","text","nfont","assign","state","oldCell","oldText","setCellText","active","filter","getFilter","vIndex","findIndex","getSelectedRect","x1","y1","getRect","l","sumWidth","sumHeight","left0","top0","totalWidth","totalHeight","cellRect","setCell","deleteCell","order","operator","addFilter","setSort","resetAutoFilter","sort","filteredRows","r","c","rset","fset","fary","Array","from","oldAry","a","b","index","set","type","n","si","insert","insertColumn","shift","rsize","csize","delete","deleteColumn","cb","fci","fri","cellStyle","defaultStyle","getCellStyleOrDefault","validate","setHeight","setWidth","h","maxCell","w","exceptRows","exceptRowTH","viewHeight","j","viewWidth","viewRange","filterIntersects","rlen","clen","setHide","unhide","min","max","frary","offset","rowHeight","colWidth","nstyle","equals","autofilter"],"mappings":"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","sourcesContent":["/* global document */\r\n\r\nimport Selector from './selector';\r\nimport Scroll from './scroll';\r\nimport History from './history';\r\nimport Clipboard from './clipboard';\r\nimport AutoFilter from './auto_filter';\r\nimport { Merges } from './merge';\r\nimport helper from './helper';\r\nimport { Rows } from './row';\r\nimport { Cols } from './col';\r\nimport { Validations } from './validation';\r\nimport { CellRange } from './cell_range';\r\nimport { expr2xy, xy2expr } from './alphabet';\r\nimport { t } from '../locale/locale';\r\n\r\n// private methods\r\n/*\r\n * {\r\n *  name: ''\r\n *  freeze: [0, 0],\r\n *  formats: [],\r\n *  styles: [\r\n *    {\r\n *      bgcolor: '',\r\n *      align: '',\r\n *      valign: '',\r\n *      textwrap: false,\r\n *      strike: false,\r\n *      underline: false,\r\n *      color: '',\r\n *      format: 1,\r\n *      border: {\r\n *        left: [style, color],\r\n *        right: [style, color],\r\n *        top: [style, color],\r\n *        bottom: [style, color],\r\n *      },\r\n *      font: {\r\n *        name: 'Helvetica',\r\n *        size: 10,\r\n *        bold: false,\r\n *        italic: false,\r\n *      }\r\n *    }\r\n *  ],\r\n *  merges: [\r\n *    'A1:F11',\r\n *    ...\r\n *  ],\r\n *  rows: {\r\n *    1: {\r\n *      height: 50,\r\n *      style: 1,\r\n *      cells: {\r\n *        1: {\r\n *          style: 2,\r\n *          type: 'string',\r\n *          text: '',\r\n *          value: '', // cal result\r\n *        }\r\n *      }\r\n *    },\r\n *    ...\r\n *  },\r\n *  cols: {\r\n *    2: { width: 100, style: 1 }\r\n *  }\r\n * }\r\n */\r\nconst defaultSettings = {\r\n  mode: 'edit', // edit | read\r\n  view: {\r\n    height: () => document.documentElement.clientHeight,\r\n    width: () => document.documentElement.clientWidth,\r\n  },\r\n  showGrid: true,\r\n  showToolbar: true,\r\n  showContextmenu: true,\r\n  row: {\r\n    len: 100,\r\n    height: 25,\r\n  },\r\n  col: {\r\n    len: 26,\r\n    width: 100,\r\n    indexWidth: 60,\r\n    minWidth: 60,\r\n  },\r\n  style: {\r\n    bgcolor: '#ffffff',\r\n    align: 'left',\r\n    valign: 'middle',\r\n    textwrap: false,\r\n    strike: false,\r\n    underline: false,\r\n    color: '#0a0a0a',\r\n    font: {\r\n      name: 'Arial',\r\n      size: 10,\r\n      bold: false,\r\n      italic: false,\r\n    },\r\n    format: 'normal',\r\n  },\r\n};\r\n\r\nconst toolbarHeight = 41;\r\nconst bottombarHeight = 41;\r\n\r\n\r\n// src: cellRange\r\n// dst: cellRange\r\nfunction canPaste(src, dst, error = () => {}) {\r\n  const { merges } = this;\r\n  const cellRange = dst.clone();\r\n  const [srn, scn] = src.size();\r\n  const [drn, dcn] = dst.size();\r\n  if (srn > drn) {\r\n    cellRange.eri = dst.sri + srn - 1;\r\n  }\r\n  if (scn > dcn) {\r\n    cellRange.eci = dst.sci + scn - 1;\r\n  }\r\n  if (merges.intersects(cellRange)) {\r\n    error(t('error.pasteForMergedCell'));\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\nfunction copyPaste(srcCellRange, dstCellRange, what, autofill = false) {\r\n  const { rows, merges } = this;\r\n  // delete dest merge\r\n  if (what === 'all' || what === 'format') {\r\n    rows.deleteCells(dstCellRange, what);\r\n    merges.deleteWithin(dstCellRange);\r\n  }\r\n  rows.copyPaste(srcCellRange, dstCellRange, what, autofill, (ri, ci, cell) => {\r\n    if (cell && cell.merge) {\r\n      // console.log('cell:', ri, ci, cell);\r\n      const [rn, cn] = cell.merge;\r\n      if (rn <= 0 && cn <= 0) return;\r\n      merges.add(new CellRange(ri, ci, ri + rn, ci + cn));\r\n    }\r\n  });\r\n}\r\n\r\nfunction cutPaste(srcCellRange, dstCellRange) {\r\n  const { clipboard, rows, merges } = this;\r\n  rows.cutPaste(srcCellRange, dstCellRange);\r\n  merges.move(srcCellRange,\r\n    dstCellRange.sri - srcCellRange.sri,\r\n    dstCellRange.sci - srcCellRange.sci);\r\n  clipboard.clear();\r\n}\r\n\r\n// bss: { top, bottom, left, right }\r\nfunction setStyleBorder(ri, ci, bss) {\r\n  const { styles, rows } = this;\r\n  const cell = rows.getCellOrNew(ri, ci);\r\n  let cstyle = {};\r\n  if (cell.style !== undefined) {\r\n    cstyle = helper.cloneDeep(styles[cell.style]);\r\n  }\r\n  cstyle = helper.merge(cstyle, { border: bss });\r\n  cell.style = this.addStyle(cstyle);\r\n}\r\n\r\nfunction setStyleBorders({ mode, style, color }) {\r\n  const { styles, selector, rows } = this;\r\n  const {\r\n    sri, sci, eri, eci,\r\n  } = selector.range;\r\n  const multiple = !this.isSignleSelected();\r\n  if (!multiple) {\r\n    if (mode === 'inside' || mode === 'horizontal' || mode === 'vertical') {\r\n      return;\r\n    }\r\n  }\r\n  if (mode === 'outside' && !multiple) {\r\n    setStyleBorder.call(this, sri, sci, {\r\n      top: [style, color], bottom: [style, color], left: [style, color], right: [style, color],\r\n    });\r\n  } else if (mode === 'none') {\r\n    selector.range.each((ri, ci) => {\r\n      const cell = rows.getCell(ri, ci);\r\n      if (cell && cell.style !== undefined) {\r\n        const ns = helper.cloneDeep(styles[cell.style]);\r\n        delete ns.border;\r\n        // ['bottom', 'top', 'left', 'right'].forEach((prop) => {\r\n        //   if (ns[prop]) delete ns[prop];\r\n        // });\r\n        cell.style = this.addStyle(ns);\r\n      }\r\n    });\r\n  } else if (mode === 'all' || mode === 'inside' || mode === 'outside'\r\n    || mode === 'horizontal' || mode === 'vertical') {\r\n    const merges = [];\r\n    for (let ri = sri; ri <= eri; ri += 1) {\r\n      for (let ci = sci; ci <= eci; ci += 1) {\r\n        // jump merges -- start\r\n        const mergeIndexes = [];\r\n        for (let ii = 0; ii < merges.length; ii += 1) {\r\n          const [mri, mci, rn, cn] = merges[ii];\r\n          if (ri === mri + rn + 1) mergeIndexes.push(ii);\r\n          if (mri <= ri && ri <= mri + rn) {\r\n            if (ci === mci) {\r\n              ci += cn + 1;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        mergeIndexes.forEach(it => merges.splice(it, 1));\r\n        if (ci > eci) break;\r\n        // jump merges -- end\r\n        const cell = rows.getCell(ri, ci);\r\n        let [rn, cn] = [0, 0];\r\n        if (cell && cell.merge) {\r\n          [rn, cn] = cell.merge;\r\n          merges.push([ri, ci, rn, cn]);\r\n        }\r\n        const mrl = rn > 0 && ri + rn === eri;\r\n        const mcl = cn > 0 && ci + cn === eci;\r\n        let bss = {};\r\n        if (mode === 'all') {\r\n          bss = {\r\n            bottom: [style, color],\r\n            top: [style, color],\r\n            left: [style, color],\r\n            right: [style, color],\r\n          };\r\n        } else if (mode === 'inside') {\r\n          if (!mcl && ci < eci) bss.right = [style, color];\r\n          if (!mrl && ri < eri) bss.bottom = [style, color];\r\n        } else if (mode === 'horizontal') {\r\n          if (!mrl && ri < eri) bss.bottom = [style, color];\r\n        } else if (mode === 'vertical') {\r\n          if (!mcl && ci < eci) bss.right = [style, color];\r\n        } else if (mode === 'outside' && multiple) {\r\n          if (sri === ri) bss.top = [style, color];\r\n          if (mrl || eri === ri) bss.bottom = [style, color];\r\n          if (sci === ci) bss.left = [style, color];\r\n          if (mcl || eci === ci) bss.right = [style, color];\r\n        }\r\n        if (Object.keys(bss).length > 0) {\r\n          setStyleBorder.call(this, ri, ci, bss);\r\n        }\r\n        ci += cn;\r\n      }\r\n    }\r\n  } else if (mode === 'top' || mode === 'bottom') {\r\n    for (let ci = sci; ci <= eci; ci += 1) {\r\n      if (mode === 'top') {\r\n        setStyleBorder.call(this, sri, ci, { top: [style, color] });\r\n        ci += rows.getCellMerge(sri, ci)[1];\r\n      }\r\n      if (mode === 'bottom') {\r\n        setStyleBorder.call(this, eri, ci, { bottom: [style, color] });\r\n        ci += rows.getCellMerge(eri, ci)[1];\r\n      }\r\n    }\r\n  } else if (mode === 'left' || mode === 'right') {\r\n    for (let ri = sri; ri <= eri; ri += 1) {\r\n      if (mode === 'left') {\r\n        setStyleBorder.call(this, ri, sci, { left: [style, color] });\r\n        ri += rows.getCellMerge(ri, sci)[0];\r\n      }\r\n      if (mode === 'right') {\r\n        setStyleBorder.call(this, ri, eci, { right: [style, color] });\r\n        ri += rows.getCellMerge(ri, eci)[0];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getCellRowByY(y, scrollOffsety) {\r\n  const { rows } = this;\r\n  const fsh = this.freezeTotalHeight();\r\n  // console.log('y:', y, ', fsh:', fsh);\r\n  let inits = rows.height;\r\n  if (fsh + rows.height < y) inits -= scrollOffsety;\r\n\r\n  // handle ri in autofilter\r\n  const frset = this.exceptRowSet;\r\n\r\n  let ri = 0;\r\n  let top = inits;\r\n  let { height } = rows;\r\n  for (; ri < rows.len; ri += 1) {\r\n    if (top > y) break;\r\n    if (!frset.has(ri)) {\r\n      height = rows.getHeight(ri);\r\n      top += height;\r\n    }\r\n  }\r\n  top -= height;\r\n  // console.log('ri:', ri, ', top:', top, ', height:', height);\r\n\r\n  if (top <= 0) {\r\n    return { ri: -1, top: 0, height };\r\n  }\r\n\r\n  return { ri: ri - 1, top, height };\r\n}\r\n\r\nfunction getCellColByX(x, scrollOffsetx) {\r\n  const { cols } = this;\r\n  const fsw = this.freezeTotalWidth();\r\n  let inits = cols.indexWidth;\r\n  if (fsw + cols.indexWidth < x) inits -= scrollOffsetx;\r\n  const [ci, left, width] = helper.rangeReduceIf(\r\n    0,\r\n    cols.len,\r\n    inits,\r\n    cols.indexWidth,\r\n    x,\r\n    i => cols.getWidth(i),\r\n  );\r\n  if (left <= 0) {\r\n    return { ci: -1, left: 0, width: cols.indexWidth };\r\n  }\r\n  return { ci: ci - 1, left, width };\r\n}\r\n\r\nexport default class DataProxy {\r\n  constructor(name, settings) {\r\n    this.settings = helper.merge(defaultSettings, settings || {});\r\n    // save data begin\r\n    this.name = name || 'sheet';\r\n    this.freeze = [0, 0];\r\n    this.styles = []; // Array<Style>\r\n    this.merges = new Merges(); // [CellRange, ...]\r\n    this.rows = new Rows(this.settings.row);\r\n    this.cols = new Cols(this.settings.col);\r\n    this.validations = new Validations();\r\n    this.hyperlinks = {};\r\n    this.comments = {};\r\n    // save data end\r\n\r\n    // don't save object\r\n    this.selector = new Selector();\r\n    this.scroll = new Scroll();\r\n    this.history = new History();\r\n    this.clipboard = new Clipboard();\r\n    this.autoFilter = new AutoFilter();\r\n    this.change = () => {};\r\n    this.exceptRowSet = new Set();\r\n    this.sortedRowMap = new Map();\r\n    this.unsortedRowMap = new Map();\r\n  }\r\n\r\n  addValidation(mode, ref, validator) {\r\n    // console.log('mode:', mode, ', ref:', ref, ', validator:', validator);\r\n    this.changeData(() => {\r\n      this.validations.add(mode, ref, validator);\r\n    });\r\n  }\r\n\r\n  removeValidation() {\r\n    const { range } = this.selector;\r\n    this.changeData(() => {\r\n      this.validations.remove(range);\r\n    });\r\n  }\r\n\r\n  getSelectedValidator() {\r\n    const { ri, ci } = this.selector;\r\n    const v = this.validations.get(ri, ci);\r\n    return v ? v.validator : null;\r\n  }\r\n\r\n  getSelectedValidation() {\r\n    const { ri, ci, range } = this.selector;\r\n    const v = this.validations.get(ri, ci);\r\n    const ret = { ref: range.toString() };\r\n    if (v !== null) {\r\n      ret.mode = v.mode;\r\n      ret.validator = v.validator;\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  canUndo() {\r\n    return this.history.canUndo();\r\n  }\r\n\r\n  canRedo() {\r\n    return this.history.canRedo();\r\n  }\r\n\r\n  undo() {\r\n    this.history.undo(this.getData(), (d) => {\r\n      this.setData(d);\r\n    });\r\n  }\r\n\r\n  redo() {\r\n    this.history.redo(this.getData(), (d) => {\r\n      this.setData(d);\r\n    });\r\n  }\r\n\r\n  copy() {\r\n    this.clipboard.copy(this.selector.range);\r\n  }\r\n\r\n  cut() {\r\n    this.clipboard.cut(this.selector.range);\r\n  }\r\n\r\n  // what: all | text | format\r\n  paste(what = 'all', error = () => {}) {\r\n    // console.log('sIndexes:', sIndexes);\r\n    const { clipboard, selector } = this;\r\n    if (clipboard.isClear()) return false;\r\n    if (!canPaste.call(this, clipboard.range, selector.range, error)) return false;\r\n\r\n    this.changeData(() => {\r\n      if (clipboard.isCopy()) {\r\n        copyPaste.call(this, clipboard.range, selector.range, what);\r\n      } else if (clipboard.isCut()) {\r\n        cutPaste.call(this, clipboard.range, selector.range);\r\n      }\r\n    });\r\n    return true;\r\n  }\r\n\r\n  pasteFromText(txt) {\r\n    const lines = txt.split('\\r\\n').map(it => it.replace(/\"/g, '').split('\\t'));\r\n    if (lines.length > 0) lines.length -= 1;\r\n    const { rows, selector } = this;\r\n    this.changeData(() => {\r\n      rows.paste(lines, selector.range);\r\n    });\r\n  }\r\n\r\n  autofill(cellRange, what, error = () => {}) {\r\n    const srcRange = this.selector.range;\r\n    if (!canPaste.call(this, srcRange, cellRange, error)) return false;\r\n    this.changeData(() => {\r\n      copyPaste.call(this, srcRange, cellRange, what, true);\r\n    });\r\n    return true;\r\n  }\r\n\r\n  clearClipboard() {\r\n    this.clipboard.clear();\r\n  }\r\n\r\n  calSelectedRangeByEnd(ri, ci) {\r\n    const {\r\n      selector, rows, cols, merges,\r\n    } = this;\r\n    let {\r\n      sri, sci, eri, eci,\r\n    } = selector.range;\r\n    const cri = selector.ri;\r\n    const cci = selector.ci;\r\n    let [nri, nci] = [ri, ci];\r\n    if (ri < 0) nri = rows.len - 1;\r\n    if (ci < 0) nci = cols.len - 1;\r\n    if (nri > cri) [sri, eri] = [cri, nri];\r\n    else [sri, eri] = [nri, cri];\r\n    if (nci > cci) [sci, eci] = [cci, nci];\r\n    else [sci, eci] = [nci, cci];\r\n    selector.range = merges.union(new CellRange(\r\n      sri, sci, eri, eci,\r\n    ));\r\n    selector.range = merges.union(selector.range);\r\n    // console.log('selector.range:', selector.range);\r\n    return selector.range;\r\n  }\r\n\r\n  calSelectedRangeByStart(ri, ci) {\r\n    const {\r\n      selector, rows, cols, merges,\r\n    } = this;\r\n    let cellRange = merges.getFirstIncludes(ri, ci);\r\n    // console.log('cellRange:', cellRange, ri, ci, merges);\r\n    if (cellRange === null) {\r\n      cellRange = new CellRange(ri, ci, ri, ci);\r\n      if (ri === -1) {\r\n        cellRange.sri = 0;\r\n        cellRange.eri = rows.len - 1;\r\n      }\r\n      if (ci === -1) {\r\n        cellRange.sci = 0;\r\n        cellRange.eci = cols.len - 1;\r\n      }\r\n    }\r\n    selector.range = cellRange;\r\n    return cellRange;\r\n  }\r\n\r\n  setSelectedCellAttr(property, value) {\r\n    this.changeData(() => {\r\n      const { selector, styles, rows } = this;\r\n      if (property === 'merge') {\r\n        if (value) this.merge();\r\n        else this.unmerge();\r\n      } else if (property === 'border') {\r\n        setStyleBorders.call(this, value);\r\n      } else if (property === 'formula') {\r\n        // console.log('>>>', selector.multiple());\r\n        const { ri, ci, range } = selector;\r\n        if (selector.multiple()) {\r\n          const [rn, cn] = selector.size();\r\n          const {\r\n            sri, sci, eri, eci,\r\n          } = range;\r\n          if (rn > 1) {\r\n            for (let i = sci; i <= eci; i += 1) {\r\n              const cell = rows.getCellOrNew(eri + 1, i);\r\n              cell.text = `=${value}(${xy2expr(i, sri)}:${xy2expr(i, eri)})`;\r\n            }\r\n          } else if (cn > 1) {\r\n            const cell = rows.getCellOrNew(ri, eci + 1);\r\n            cell.text = `=${value}(${xy2expr(sci, ri)}:${xy2expr(eci, ri)})`;\r\n          }\r\n        } else {\r\n          const cell = rows.getCellOrNew(ri, ci);\r\n          cell.text = `=${value}()`;\r\n        }\r\n      } else {\r\n        selector.range.each((ri, ci) => {\r\n          const cell = rows.getCellOrNew(ri, ci);\r\n          let cstyle = {};\r\n          if (cell.style !== undefined) {\r\n            cstyle = helper.cloneDeep(styles[cell.style]);\r\n          }\r\n          if (property === 'format') {\r\n            cstyle.format = value;\r\n            cell.style = this.addStyle(cstyle);\r\n          } else if (property === 'font-bold' || property === 'font-italic'\r\n            || property === 'font-name' || property === 'font-size') {\r\n            const nfont = {};\r\n            nfont[property.split('-')[1]] = value;\r\n            cstyle.font = Object.assign(cstyle.font || {}, nfont);\r\n            cell.style = this.addStyle(cstyle);\r\n          } else if (property === 'strike' || property === 'textwrap'\r\n            || property === 'underline'\r\n            || property === 'align' || property === 'valign'\r\n            || property === 'color' || property === 'bgcolor') {\r\n            cstyle[property] = value;\r\n            cell.style = this.addStyle(cstyle);\r\n          } else {\r\n            cell[property] = value;\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // state: input | finished\r\n  setSelectedCellText(text, state = 'input') {\r\n    const { autoFilter, selector, rows } = this;\r\n    const { ri, ci } = selector;\r\n    let nri = ri;\r\n    if (this.unsortedRowMap.has(ri)) {\r\n      nri = this.unsortedRowMap.get(ri);\r\n    }\r\n    const oldCell = rows.getCell(nri, ci);\r\n    const oldText = oldCell ? oldCell.text : '';\r\n    this.setCellText(nri, ci, text, state);\r\n    // replace filter.value\r\n    if (autoFilter.active()) {\r\n      const filter = autoFilter.getFilter(ci);\r\n      if (filter) {\r\n        const vIndex = filter.value.findIndex(v => v === oldText);\r\n        if (vIndex >= 0) {\r\n          filter.value.splice(vIndex, 1, text);\r\n        }\r\n        // console.log('filter:', filter, oldCell);\r\n      }\r\n    }\r\n    // this.resetAutoFilter();\r\n  }\r\n\r\n  getSelectedCell() {\r\n    const { ri, ci } = this.selector;\r\n    let nri = ri;\r\n    if (this.unsortedRowMap.has(ri)) {\r\n      nri = this.unsortedRowMap.get(ri);\r\n    }\r\n    return this.rows.getCell(nri, ci);\r\n  }\r\n\r\n  xyInSelectedRect(x, y) {\r\n    const {\r\n      left, top, width, height,\r\n    } = this.getSelectedRect();\r\n    const x1 = x - this.cols.indexWidth;\r\n    const y1 = y - this.rows.height;\r\n    // console.log('x:', x, ',y:', y, 'left:', left, 'top:', top);\r\n    return x1 > left && x1 < (left + width)\r\n      && y1 > top && y1 < (top + height);\r\n  }\r\n\r\n  getSelectedRect() {\r\n    return this.getRect(this.selector.range);\r\n  }\r\n\r\n  getClipboardRect() {\r\n    const { clipboard } = this;\r\n    if (!clipboard.isClear()) {\r\n      return this.getRect(clipboard.range);\r\n    }\r\n    return { left: -100, top: -100 };\r\n  }\r\n\r\n  getRect(cellRange) {\r\n    const {\r\n      scroll, rows, cols, exceptRowSet,\r\n    } = this;\r\n    const {\r\n      sri, sci, eri, eci,\r\n    } = cellRange;\r\n    // console.log('sri:', sri, ',sci:', sci, ', eri:', eri, ', eci:', eci);\r\n    // no selector\r\n    if (sri < 0 && sci < 0) {\r\n      return {\r\n        left: 0, l: 0, top: 0, t: 0, scroll,\r\n      };\r\n    }\r\n    const left = cols.sumWidth(0, sci);\r\n    const top = rows.sumHeight(0, sri, exceptRowSet);\r\n    const height = rows.sumHeight(sri, eri + 1, exceptRowSet);\r\n    const width = cols.sumWidth(sci, eci + 1);\r\n    // console.log('sri:', sri, ', sci:', sci, ', eri:', eri, ', eci:', eci);\r\n    let left0 = left - scroll.x;\r\n    let top0 = top - scroll.y;\r\n    const fsh = this.freezeTotalHeight();\r\n    const fsw = this.freezeTotalWidth();\r\n    if (fsw > 0 && fsw > left) {\r\n      left0 = left;\r\n    }\r\n    if (fsh > 0 && fsh > top) {\r\n      top0 = top;\r\n    }\r\n    return {\r\n      l: left,\r\n      t: top,\r\n      left: left0,\r\n      top: top0,\r\n      height,\r\n      width,\r\n      scroll,\r\n    };\r\n  }\r\n\r\n  getCellRectByXY(x, y) {\r\n    const {\r\n      scroll, merges, rows, cols,\r\n    } = this;\r\n    let { ri, top, height } = getCellRowByY.call(this, y, scroll.y);\r\n    let { ci, left, width } = getCellColByX.call(this, x, scroll.x);\r\n    if (ci === -1) {\r\n      width = cols.totalWidth();\r\n    }\r\n    if (ri === -1) {\r\n      height = rows.totalHeight();\r\n    }\r\n    if (ri >= 0 || ci >= 0) {\r\n      const merge = merges.getFirstIncludes(ri, ci);\r\n      if (merge) {\r\n        ri = merge.sri;\r\n        ci = merge.sci;\r\n        ({\r\n          left, top, width, height,\r\n        } = this.cellRect(ri, ci));\r\n      }\r\n    }\r\n    return {\r\n      ri, ci, left, top, width, height,\r\n    };\r\n  }\r\n\r\n  isSignleSelected() {\r\n    const {\r\n      sri, sci, eri, eci,\r\n    } = this.selector.range;\r\n    const cell = this.getCell(sri, sci);\r\n    if (cell && cell.merge) {\r\n      const [rn, cn] = cell.merge;\r\n      if (sri + rn === eri && sci + cn === eci) return true;\r\n    }\r\n    return !this.selector.multiple();\r\n  }\r\n\r\n  canUnmerge() {\r\n    const {\r\n      sri, sci, eri, eci,\r\n    } = this.selector.range;\r\n    const cell = this.getCell(sri, sci);\r\n    if (cell && cell.merge) {\r\n      const [rn, cn] = cell.merge;\r\n      if (sri + rn === eri && sci + cn === eci) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  merge() {\r\n    const { selector, rows } = this;\r\n    if (this.isSignleSelected()) return;\r\n    const [rn, cn] = selector.size();\r\n    // console.log('merge:', rn, cn);\r\n    if (rn > 1 || cn > 1) {\r\n      const { sri, sci } = selector.range;\r\n      this.changeData(() => {\r\n        const cell = rows.getCellOrNew(sri, sci);\r\n        cell.merge = [rn - 1, cn - 1];\r\n        this.merges.add(selector.range);\r\n        // delete merge cells\r\n        this.rows.deleteCells(selector.range);\r\n        // console.log('cell:', cell, this.d);\r\n        this.rows.setCell(sri, sci, cell);\r\n      });\r\n    }\r\n  }\r\n\r\n  unmerge() {\r\n    const { selector } = this;\r\n    if (!this.isSignleSelected()) return;\r\n    const { sri, sci } = selector.range;\r\n    this.changeData(() => {\r\n      this.rows.deleteCell(sri, sci, 'merge');\r\n      this.merges.deleteWithin(selector.range);\r\n    });\r\n  }\r\n\r\n  canAutofilter() {\r\n    return !this.autoFilter.active();\r\n  }\r\n\r\n  autofilter() {\r\n    const { autoFilter, selector } = this;\r\n    this.changeData(() => {\r\n      if (autoFilter.active()) {\r\n        autoFilter.clear();\r\n        this.exceptRowSet = new Set();\r\n        this.sortedRowMap = new Map();\r\n        this.unsortedRowMap = new Map();\r\n      } else {\r\n        autoFilter.ref = selector.range.toString();\r\n      }\r\n    });\r\n  }\r\n\r\n  setAutoFilter(ci, order, operator, value) {\r\n    const { autoFilter } = this;\r\n    autoFilter.addFilter(ci, operator, value);\r\n    autoFilter.setSort(ci, order);\r\n    this.resetAutoFilter();\r\n  }\r\n\r\n  resetAutoFilter() {\r\n    const { autoFilter, rows } = this;\r\n    if (!autoFilter.active()) return;\r\n    const { sort } = autoFilter;\r\n    const { rset, fset } = autoFilter.filteredRows((r, c) => rows.getCell(r, c));\r\n    const fary = Array.from(fset);\r\n    const oldAry = Array.from(fset);\r\n    if (sort) {\r\n      fary.sort((a, b) => {\r\n        if (sort.order === 'asc') return a - b;\r\n        if (sort.order === 'desc') return b - a;\r\n        return 0;\r\n      });\r\n    }\r\n    this.exceptRowSet = rset;\r\n    this.sortedRowMap = new Map();\r\n    this.unsortedRowMap = new Map();\r\n    fary.forEach((it, index) => {\r\n      this.sortedRowMap.set(oldAry[index], it);\r\n      this.unsortedRowMap.set(it, oldAry[index]);\r\n    });\r\n  }\r\n\r\n  deleteCell(what = 'all') {\r\n    const { selector } = this;\r\n    this.changeData(() => {\r\n      this.rows.deleteCells(selector.range, what);\r\n      if (what === 'all' || what === 'format') {\r\n        this.merges.deleteWithin(selector.range);\r\n      }\r\n    });\r\n  }\r\n\r\n  // type: row | column\r\n  insert(type, n = 1) {\r\n    this.changeData(() => {\r\n      const { sri, sci } = this.selector.range;\r\n      const { rows, merges, cols } = this;\r\n      let si = sri;\r\n      if (type === 'row') {\r\n        rows.insert(sri, n);\r\n      } else if (type === 'column') {\r\n        rows.insertColumn(sci, n);\r\n        si = sci;\r\n        cols.len += 1;\r\n      }\r\n      merges.shift(type, si, n, (ri, ci, rn, cn) => {\r\n        const cell = rows.getCell(ri, ci);\r\n        cell.merge[0] += rn;\r\n        cell.merge[1] += cn;\r\n      });\r\n    });\r\n  }\r\n\r\n  // type: row | column\r\n  delete(type) {\r\n    this.changeData(() => {\r\n      const {\r\n        rows, merges, selector, cols,\r\n      } = this;\r\n      const { range } = selector;\r\n      const {\r\n        sri, sci, eri, eci,\r\n      } = selector.range;\r\n      const [rsize, csize] = selector.range.size();\r\n      let si = sri;\r\n      let size = rsize;\r\n      if (type === 'row') {\r\n        rows.delete(sri, eri);\r\n      } else if (type === 'column') {\r\n        rows.deleteColumn(sci, eci);\r\n        si = range.sci;\r\n        size = csize;\r\n        cols.len -= 1;\r\n      }\r\n      // console.log('type:', type, ', si:', si, ', size:', size);\r\n      merges.shift(type, si, -size, (ri, ci, rn, cn) => {\r\n        // console.log('ri:', ri, ', ci:', ci, ', rn:', rn, ', cn:', cn);\r\n        const cell = rows.getCell(ri, ci);\r\n        cell.merge[0] += rn;\r\n        cell.merge[1] += cn;\r\n        if (cell.merge[0] === 0 && cell.merge[1] === 0) {\r\n          delete cell.merge;\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  scrollx(x, cb) {\r\n    const { scroll, freeze, cols } = this;\r\n    const [, fci] = freeze;\r\n    const [\r\n      ci, left, width,\r\n    ] = helper.rangeReduceIf(fci, cols.len, 0, 0, x, i => cols.getWidth(i));\r\n    // console.log('fci:', fci, ', ci:', ci);\r\n    let x1 = left;\r\n    if (x > 0) x1 += width;\r\n    if (scroll.x !== x1) {\r\n      scroll.ci = x > 0 ? ci : 0;\r\n      scroll.x = x1;\r\n      cb();\r\n    }\r\n  }\r\n\r\n  scrolly(y, cb) {\r\n    const { scroll, freeze, rows } = this;\r\n    const [fri] = freeze;\r\n    const [\r\n      ri, top, height,\r\n    ] = helper.rangeReduceIf(fri, rows.len, 0, 0, y, i => rows.getHeight(i));\r\n    let y1 = top;\r\n    if (y > 0) y1 += height;\r\n    // console.log('ri:', ri, ' ,y:', y1);\r\n    if (scroll.y !== y1) {\r\n      scroll.ri = y > 0 ? ri : 0;\r\n      scroll.y = y1;\r\n      cb();\r\n    }\r\n  }\r\n\r\n  cellRect(ri, ci) {\r\n    const { rows, cols } = this;\r\n    const left = cols.sumWidth(0, ci);\r\n    const top = rows.sumHeight(0, ri);\r\n    const cell = rows.getCell(ri, ci);\r\n    let width = cols.getWidth(ci);\r\n    let height = rows.getHeight(ri);\r\n    if (cell !== null) {\r\n      if (cell.merge) {\r\n        const [rn, cn] = cell.merge;\r\n        // console.log('cell.merge:', cell.merge);\r\n        if (rn > 0) {\r\n          for (let i = 1; i <= rn; i += 1) {\r\n            height += rows.getHeight(ri + i);\r\n          }\r\n        }\r\n        if (cn > 0) {\r\n          for (let i = 1; i <= cn; i += 1) {\r\n            width += cols.getWidth(ci + i);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // console.log('data:', this.d);\r\n    return {\r\n      left, top, width, height, cell,\r\n    };\r\n  }\r\n\r\n  getCell(ri, ci) {\r\n    return this.rows.getCell(ri, ci);\r\n  }\r\n\r\n  getCellTextOrDefault(ri, ci) {\r\n    const cell = this.getCell(ri, ci);\r\n    return (cell && cell.text) ? cell.text : '';\r\n  }\r\n\r\n  getCellStyle(ri, ci) {\r\n    const cell = this.getCell(ri, ci);\r\n    if (cell && cell.style !== undefined) {\r\n      return this.styles[cell.style];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getCellStyleOrDefault(ri, ci) {\r\n    const { styles, rows } = this;\r\n    const cell = rows.getCell(ri, ci);\r\n    const cellStyle = (cell && cell.style !== undefined) ? styles[cell.style] : {};\r\n    return helper.merge(this.defaultStyle(), cellStyle);\r\n  }\r\n\r\n  getSelectedCellStyle() {\r\n    const { ri, ci } = this.selector;\r\n    return this.getCellStyleOrDefault(ri, ci);\r\n  }\r\n\r\n  // state: input | finished\r\n  setCellText(ri, ci, text, state) {\r\n    const { rows, history, validations } = this;\r\n    if (state === 'finished') {\r\n      rows.setCellText(ri, ci, '');\r\n      history.add(this.getData());\r\n      rows.setCellText(ri, ci, text);\r\n    } else {\r\n      rows.setCellText(ri, ci, text);\r\n      this.change(this.getData());\r\n    }\r\n    // validator\r\n    validations.validate(ri, ci, text);\r\n  }\r\n\r\n  freezeIsActive() {\r\n    const [ri, ci] = this.freeze;\r\n    return ri > 0 || ci > 0;\r\n  }\r\n\r\n  setFreeze(ri, ci) {\r\n    this.changeData(() => {\r\n      this.freeze = [ri, ci];\r\n    });\r\n  }\r\n\r\n  freezeTotalWidth() {\r\n    return this.cols.sumWidth(0, this.freeze[1]);\r\n  }\r\n\r\n  freezeTotalHeight() {\r\n    return this.rows.sumHeight(0, this.freeze[0]);\r\n  }\r\n\r\n  setRowHeight(ri, height) {\r\n    this.changeData(() => {\r\n      this.rows.setHeight(ri, height);\r\n    });\r\n  }\r\n\r\n  setColWidth(ci, width) {\r\n    this.changeData(() => {\r\n      this.cols.setWidth(ci, width);\r\n    });\r\n  }\r\n\r\n  viewHeight() {\r\n    const { view, showToolbar } = this.settings;\r\n    let h = view.height();\r\n    h -= bottombarHeight;\r\n    if (showToolbar) {\r\n      h -= toolbarHeight;\r\n    }\r\n    return h;\r\n  }\r\n\r\n  viewWidth() {\r\n    return this.settings.view.width();\r\n  }\r\n\r\n  freezeViewRange() {\r\n    const [ri, ci] = this.freeze;\r\n    return new CellRange(0, 0, ri - 1, ci - 1, this.freezeTotalWidth(), this.freezeTotalHeight());\r\n  }\r\n\r\n  contentRange() {\r\n    const { rows, cols } = this;\r\n    const [ri, ci] = rows.maxCell();\r\n    const h = rows.sumHeight(0, ri + 1);\r\n    const w = cols.sumWidth(0, ci + 1);\r\n    return new CellRange(0, 0, ri, ci, w, h);\r\n  }\r\n\r\n  exceptRowTotalHeight(sri, eri) {\r\n    const { exceptRowSet, rows } = this;\r\n    const exceptRows = Array.from(exceptRowSet);\r\n    let exceptRowTH = 0;\r\n    exceptRows.forEach((ri) => {\r\n      if (ri < sri || ri > eri) {\r\n        const height = rows.getHeight(ri);\r\n        exceptRowTH += height;\r\n      }\r\n    });\r\n    return exceptRowTH;\r\n  }\r\n\r\n  viewRange() {\r\n    const {\r\n      scroll, rows, cols, freeze, exceptRowSet,\r\n    } = this;\r\n    // console.log('scroll:', scroll, ', freeze:', freeze)\r\n    let { ri, ci } = scroll;\r\n    if (ri <= 0) [ri] = freeze;\r\n    if (ci <= 0) [, ci] = freeze;\r\n\r\n    let [x, y] = [0, 0];\r\n    let [eri, eci] = [rows.len, cols.len];\r\n    for (let i = ri; i < rows.len; i += 1) {\r\n      if (!exceptRowSet.has(i)) {\r\n        y += rows.getHeight(i);\r\n        eri = i;\r\n      }\r\n      if (y > this.viewHeight()) break;\r\n    }\r\n    for (let j = ci; j < cols.len; j += 1) {\r\n      x += cols.getWidth(j);\r\n      eci = j;\r\n      if (x > this.viewWidth()) break;\r\n    }\r\n    // console.log(ri, ci, eri, eci, x, y);\r\n    return new CellRange(ri, ci, eri, eci, x, y);\r\n  }\r\n\r\n  eachMergesInView(viewRange, cb) {\r\n    this.merges.filterIntersects(viewRange)\r\n      .forEach(it => cb(it));\r\n  }\r\n\r\n  hideRowsOrCols() {\r\n    const { rows, cols, selector } = this;\r\n    const [rlen, clen] = selector.size();\r\n    const {\r\n      sri, sci, eri, eci,\r\n    } = selector.range;\r\n    if (rlen === rows.len) {\r\n      for (let ci = sci; ci <= eci; ci += 1) {\r\n        cols.setHide(ci, true);\r\n      }\r\n    } else if (clen === cols.len) {\r\n      for (let ri = sri; ri <= eri; ri += 1) {\r\n        rows.setHide(ri, true);\r\n      }\r\n    }\r\n  }\r\n\r\n  // type: row | col\r\n  // index row-index | col-index\r\n  unhideRowsOrCols(type, index) {\r\n    this[`${type}s`].unhide(index);\r\n  }\r\n\r\n  rowEach(min, max, cb) {\r\n    let y = 0;\r\n    const { rows } = this;\r\n    const frset = this.exceptRowSet;\r\n    const frary = [...frset];\r\n    let offset = 0;\r\n    for (let i = 0; i < frary.length; i += 1) {\r\n      if (frary[i] < min) {\r\n        offset += 1;\r\n      }\r\n    }\r\n    // console.log('min:', min, ', max:', max, ', scroll:', scroll);\r\n    for (let i = min + offset; i <= max + offset; i += 1) {\r\n      if (frset.has(i)) {\r\n        offset += 1;\r\n      } else {\r\n        const rowHeight = rows.getHeight(i);\r\n        if (rowHeight > 0) {\r\n          cb(i, y, rowHeight);\r\n          y += rowHeight;\r\n          if (y > this.viewHeight()) break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  colEach(min, max, cb) {\r\n    let x = 0;\r\n    const { cols } = this;\r\n    for (let i = min; i <= max; i += 1) {\r\n      const colWidth = cols.getWidth(i);\r\n      if (colWidth > 0) {\r\n        cb(i, x, colWidth);\r\n        x += colWidth;\r\n        if (x > this.viewWidth()) break;\r\n      }\r\n    }\r\n  }\r\n\r\n  defaultStyle() {\r\n    return this.settings.style;\r\n  }\r\n\r\n  addStyle(nstyle) {\r\n    const { styles } = this;\r\n    // console.log('old.styles:', styles, nstyle);\r\n    for (let i = 0; i < styles.length; i += 1) {\r\n      const style = styles[i];\r\n      if (helper.equals(style, nstyle)) return i;\r\n    }\r\n    styles.push(nstyle);\r\n    return styles.length - 1;\r\n  }\r\n\r\n  changeData(cb) {\r\n    this.history.add(this.getData());\r\n    cb();\r\n    this.change(this.getData());\r\n  }\r\n\r\n  setData(d) {\r\n    Object.keys(d).forEach((property) => {\r\n      if (property === 'merges' || property === 'rows'\r\n        || property === 'cols' || property === 'validations') {\r\n        this[property].setData(d[property]);\r\n      } else if (property === 'freeze') {\r\n        const [x, y] = expr2xy(d[property]);\r\n        this.freeze = [y, x];\r\n      } else if (property === 'autofilter') {\r\n        this.autoFilter.setData(d[property]);\r\n      } else if (d[property] !== undefined) {\r\n        this[property] = d[property];\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  getData() {\r\n    const {\r\n      name, freeze, styles, merges, rows, cols, validations, autoFilter,\r\n    } = this;\r\n    return {\r\n      name,\r\n      freeze: xy2expr(freeze[1], freeze[0]),\r\n      styles,\r\n      merges: merges.getData(),\r\n      rows: rows.getData(),\r\n      cols: cols.getData(),\r\n      validations: validations.getData(),\r\n      autofilter: autoFilter.getData(),\r\n    };\r\n  }\r\n}\r\n"]}]}